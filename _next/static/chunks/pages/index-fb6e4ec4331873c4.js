(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(t,e,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(3798)}])},3798:function(t,e,i){"use strict";let n,s,a,r,l,o,u,h;i.r(e),i.d(e,{default:function(){return er}});var c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N,R,z,U,$,V,L,H=i(5893),q=i(2083),K=i.n(q),X=i(9008),Z=i.n(X),J=i(7294),Y=Object.create,Q=Object.defineProperty,tt=Object.defineProperties,te=Object.getOwnPropertyDescriptor,ti=Object.getOwnPropertyDescriptors,tn=Object.getOwnPropertyNames,ts=Object.getOwnPropertySymbols,ta=Object.getPrototypeOf,tr=Object.prototype.hasOwnProperty,tl=Object.prototype.propertyIsEnumerable,to=(t,e,i)=>e in t?Q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,tu=(t,e)=>{for(var i in e||(e={}))tr.call(e,i)&&to(t,i,e[i]);if(ts)for(var i of ts(e))tl.call(e,i)&&to(t,i,e[i]);return t},th=(t,e)=>tt(t,ti(e)),tc=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tp=(t,e,i)=>(tc(t,e,"read from private field"),i?i.call(t):e.get(t)),td=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tf=(t,e,i,n)=>(tc(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tm=(t,e,i)=>(tc(t,e,"access private method"),i),ty=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tP=(c={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N=Object.create,R=Object.defineProperty,z=Object.defineProperties,U=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,X=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e)=>{for(var i in e||(e={}))q.call(e,i)&&X(t,i,e[i]);if(L)for(var i of L(e))K.call(e,i)&&X(t,i,e[i]);return t},J=(t,e)=>z(t,$(e)),Y=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of V(e))q.call(t,s)||s===i||R(t,s,{get:()=>e[s],enumerable:!(n=U(e,s))||n.enumerable});return t},Q=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tt=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),te=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},ti=(t,e,i,n)=>(Q(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tn=(t,e,i)=>(Q(t,e,"access private method"),i),ts=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ta=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N=Object.create,R=Object.defineProperty,z=Object.defineProperties,U=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,X=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e)=>{for(var i in e||(e={}))q.call(e,i)&&X(t,i,e[i]);if(L)for(var i of L(e))K.call(e,i)&&X(t,i,e[i]);return t},J=(t,e)=>z(t,$(e)),Y=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of V(e))q.call(t,s)||s===i||R(t,s,{get:()=>e[s],enumerable:!(n=U(e,s))||n.enumerable});return t},Q=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tt=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),te=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},ti=(t,e,i,n)=>(Q(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tn=(t,e,i)=>(Q(t,e,"access private method"),i),ts=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ta=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N=Object.create,R=Object.defineProperty,z=Object.defineProperties,U=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,X=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e)=>{for(var i in e||(e={}))q.call(e,i)&&X(t,i,e[i]);if(L)for(var i of L(e))K.call(e,i)&&X(t,i,e[i]);return t},J=(t,e)=>z(t,$(e)),Y=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of V(e))q.call(t,s)||s===i||R(t,s,{get:()=>e[s],enumerable:!(n=U(e,s))||n.enumerable});return t},Q=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tt=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),te=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},ti=(t,e,i,n)=>(Q(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tn=(t,e,i)=>(Q(t,e,"access private method"),i),ts=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ta=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N=Object.create,R=Object.defineProperty,z=Object.defineProperties,U=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,X=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e)=>{for(var i in e||(e={}))q.call(e,i)&&X(t,i,e[i]);if(L)for(var i of L(e))K.call(e,i)&&X(t,i,e[i]);return t},J=(t,e)=>z(t,$(e)),Y=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of V(e))q.call(t,s)||s===i||R(t,s,{get:()=>e[s],enumerable:!(n=U(e,s))||n.enumerable});return t},Q=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tt=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),te=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},ti=(t,e,i,n)=>(Q(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tn=(t,e,i)=>(Q(t,e,"access private method"),i),ts=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ta=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N=Object.create,R=Object.defineProperty,z=Object.defineProperties,U=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,X=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e)=>{for(var i in e||(e={}))q.call(e,i)&&X(t,i,e[i]);if(L)for(var i of L(e))K.call(e,i)&&X(t,i,e[i]);return t},J=(t,e)=>z(t,$(e)),Y=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of V(e))q.call(t,s)||s===i||R(t,s,{get:()=>e[s],enumerable:!(n=U(e,s))||n.enumerable});return t},Q=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tt=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),te=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},ti=(t,e,i,n)=>(Q(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tn=(t,e,i)=>(Q(t,e,"access private method"),i),ts=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ta=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N=Object.create,R=Object.defineProperty,z=Object.defineProperties,U=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,X=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e)=>{for(var i in e||(e={}))q.call(e,i)&&X(t,i,e[i]);if(L)for(var i of L(e))K.call(e,i)&&X(t,i,e[i]);return t},J=(t,e)=>z(t,$(e)),Y=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of V(e))q.call(t,s)||s===i||R(t,s,{get:()=>e[s],enumerable:!(n=U(e,s))||n.enumerable});return t},Q=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tt=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),te=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},ti=(t,e,i,n)=>(Q(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tn=(t,e,i)=>(Q(t,e,"access private method"),i),ts=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ta=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T,N=Object.create,R=Object.defineProperty,z=Object.defineProperties,U=Object.getOwnPropertyDescriptor,$=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertyNames,L=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,X=(t,e,i)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e)=>{for(var i in e||(e={}))q.call(e,i)&&X(t,i,e[i]);if(L)for(var i of L(e))K.call(e,i)&&X(t,i,e[i]);return t},J=(t,e)=>z(t,$(e)),Y=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of V(e))q.call(t,s)||s===i||R(t,s,{get:()=>e[s],enumerable:!(n=U(e,s))||n.enumerable});return t},Q=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},tt=(t,e,i)=>(Q(t,e,"read from private field"),i?i.call(t):e.get(t)),te=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},ti=(t,e,i,n)=>(Q(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tn=(t,e,i)=>(Q(t,e,"access private method"),i),ts=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ta=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W=Object.create,T=Object.defineProperty,N=Object.defineProperties,R=Object.getOwnPropertyDescriptor,z=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,V=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,q=(t,e,i)=>e in t?T(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,K=(t,e)=>{for(var i in e||(e={}))L.call(e,i)&&q(t,i,e[i]);if($)for(var i of $(e))H.call(e,i)&&q(t,i,e[i]);return t},X=(t,e)=>N(t,z(e)),Z=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of U(e))L.call(t,s)||s===i||T(t,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return t},J=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Y=(t,e,i)=>(J(t,e,"read from private field"),i?i.call(t):e.get(t)),Q=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},tt=(t,e,i,n)=>(J(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),te=(t,e,i)=>(J(t,e,"access private method"),i),ti=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),tn=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I=Object.create,W=Object.defineProperty,T=Object.defineProperties,N=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,$=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,H=(t,e,i)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,q=(t,e)=>{for(var i in e||(e={}))V.call(e,i)&&H(t,i,e[i]);if(U)for(var i of U(e))L.call(e,i)&&H(t,i,e[i]);return t},K=(t,e)=>T(t,R(e)),X=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of z(e))V.call(t,s)||s===i||W(t,s,{get:()=>e[s],enumerable:!(n=N(e,s))||n.enumerable});return t},Z=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},J=(t,e,i)=>(Z(t,e,"read from private field"),i?i.call(t):e.get(t)),Y=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},Q=(t,e,i,n)=>(Z(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tt=(t,e,i)=>(Z(t,e,"access private method"),i),te=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ti=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I=Object.create,W=Object.defineProperty,T=Object.defineProperties,N=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,$=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,H=(t,e,i)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,q=(t,e)=>{for(var i in e||(e={}))V.call(e,i)&&H(t,i,e[i]);if(U)for(var i of U(e))L.call(e,i)&&H(t,i,e[i]);return t},K=(t,e)=>T(t,R(e)),X=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of z(e))V.call(t,s)||s===i||W(t,s,{get:()=>e[s],enumerable:!(n=N(e,s))||n.enumerable});return t},Z=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},J=(t,e,i)=>(Z(t,e,"read from private field"),i?i.call(t):e.get(t)),Y=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},Q=(t,e,i,n)=>(Z(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tt=(t,e,i)=>(Z(t,e,"access private method"),i),te=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ti=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I=Object.create,W=Object.defineProperty,T=Object.defineProperties,N=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,$=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,H=(t,e,i)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,q=(t,e)=>{for(var i in e||(e={}))V.call(e,i)&&H(t,i,e[i]);if(U)for(var i of U(e))L.call(e,i)&&H(t,i,e[i]);return t},K=(t,e)=>T(t,R(e)),X=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of z(e))V.call(t,s)||s===i||W(t,s,{get:()=>e[s],enumerable:!(n=N(e,s))||n.enumerable});return t},Z=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},J=(t,e,i)=>(Z(t,e,"read from private field"),i?i.call(t):e.get(t)),Y=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},Q=(t,e,i,n)=>(Z(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tt=(t,e,i)=>(Z(t,e,"access private method"),i),te=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ti=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I=Object.create,W=Object.defineProperty,T=Object.defineProperties,N=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,$=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,H=(t,e,i)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,q=(t,e)=>{for(var i in e||(e={}))V.call(e,i)&&H(t,i,e[i]);if(U)for(var i of U(e))L.call(e,i)&&H(t,i,e[i]);return t},K=(t,e)=>T(t,R(e)),X=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of z(e))V.call(t,s)||s===i||W(t,s,{get:()=>e[s],enumerable:!(n=N(e,s))||n.enumerable});return t},Z=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},J=(t,e,i)=>(Z(t,e,"read from private field"),i?i.call(t):e.get(t)),Y=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},Q=(t,e,i,n)=>(Z(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tt=(t,e,i)=>(Z(t,e,"access private method"),i),te=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ti=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I=Object.create,W=Object.defineProperty,T=Object.defineProperties,N=Object.getOwnPropertyDescriptor,R=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertyNames,U=Object.getOwnPropertySymbols,$=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,H=(t,e,i)=>e in t?W(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,q=(t,e)=>{for(var i in e||(e={}))V.call(e,i)&&H(t,i,e[i]);if(U)for(var i of U(e))L.call(e,i)&&H(t,i,e[i]);return t},K=(t,e)=>T(t,R(e)),X=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of z(e))V.call(t,s)||s===i||W(t,s,{get:()=>e[s],enumerable:!(n=N(e,s))||n.enumerable});return t},Z=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},J=(t,e,i)=>(Z(t,e,"read from private field"),i?i.call(t):e.get(t)),Y=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},Q=(t,e,i,n)=>(Z(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),tt=(t,e,i)=>(Z(t,e,"access private method"),i),te=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ti=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T=Object.create,N=Object.defineProperty,R=Object.defineProperties,z=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,L=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,K=(t,e,i)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,X=(t,e)=>{for(var i in e||(e={}))H.call(e,i)&&K(t,i,e[i]);if(V)for(var i of V(e))q.call(e,i)&&K(t,i,e[i]);return t},Z=(t,e)=>R(t,U(e)),J=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of $(e))H.call(t,s)||s===i||N(t,s,{get:()=>e[s],enumerable:!(n=z(e,s))||n.enumerable});return t},Y=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Q=(t,e,i)=>(Y(t,e,"read from private field"),i?i.call(t):e.get(t)),tt=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},te=(t,e,i,n)=>(Y(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),ti=(t,e,i)=>(Y(t,e,"access private method"),i),tn=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ts=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T=Object.create,N=Object.defineProperty,R=Object.defineProperties,z=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,L=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,K=(t,e,i)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,X=(t,e)=>{for(var i in e||(e={}))H.call(e,i)&&K(t,i,e[i]);if(V)for(var i of V(e))q.call(e,i)&&K(t,i,e[i]);return t},Z=(t,e)=>R(t,U(e)),J=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of $(e))H.call(t,s)||s===i||N(t,s,{get:()=>e[s],enumerable:!(n=z(e,s))||n.enumerable});return t},Y=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Q=(t,e,i)=>(Y(t,e,"read from private field"),i?i.call(t):e.get(t)),tt=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},te=(t,e,i,n)=>(Y(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),ti=(t,e,i)=>(Y(t,e,"access private method"),i),tn=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ts=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T=Object.create,N=Object.defineProperty,R=Object.defineProperties,z=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,L=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,K=(t,e,i)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,X=(t,e)=>{for(var i in e||(e={}))H.call(e,i)&&K(t,i,e[i]);if(V)for(var i of V(e))q.call(e,i)&&K(t,i,e[i]);return t},Z=(t,e)=>R(t,U(e)),J=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of $(e))H.call(t,s)||s===i||N(t,s,{get:()=>e[s],enumerable:!(n=z(e,s))||n.enumerable});return t},Y=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Q=(t,e,i)=>(Y(t,e,"read from private field"),i?i.call(t):e.get(t)),tt=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},te=(t,e,i,n)=>(Y(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),ti=(t,e,i)=>(Y(t,e,"access private method"),i),tn=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ts=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T=Object.create,N=Object.defineProperty,R=Object.defineProperties,z=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,L=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,K=(t,e,i)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,X=(t,e)=>{for(var i in e||(e={}))H.call(e,i)&&K(t,i,e[i]);if(V)for(var i of V(e))q.call(e,i)&&K(t,i,e[i]);return t},Z=(t,e)=>R(t,U(e)),J=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of $(e))H.call(t,s)||s===i||N(t,s,{get:()=>e[s],enumerable:!(n=z(e,s))||n.enumerable});return t},Y=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Q=(t,e,i)=>(Y(t,e,"read from private field"),i?i.call(t):e.get(t)),tt=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},te=(t,e,i,n)=>(Y(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),ti=(t,e,i)=>(Y(t,e,"access private method"),i),tn=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ts=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E,j,S,B,O,I,W,T=Object.create,N=Object.defineProperty,R=Object.defineProperties,z=Object.getOwnPropertyDescriptor,U=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,L=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,K=(t,e,i)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,X=(t,e)=>{for(var i in e||(e={}))H.call(e,i)&&K(t,i,e[i]);if(V)for(var i of V(e))q.call(e,i)&&K(t,i,e[i]);return t},Z=(t,e)=>R(t,U(e)),J=(t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of $(e))H.call(t,s)||s===i||N(t,s,{get:()=>e[s],enumerable:!(n=z(e,s))||n.enumerable});return t},Y=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},Q=(t,e,i)=>(Y(t,e,"read from private field"),i?i.call(t):e.get(t)),tt=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},te=(t,e,i,n)=>(Y(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),ti=(t,e,i)=>(Y(t,e,"access private method"),i),tn=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),ts=(i={"dist/index.js"(t,e){var i,n,s,a,r,l,o,u,h,c,p,d,f,m,y,P,_,b,g,M,v,D,F,w,A,k,G,x,C,E=Object.defineProperty,j=Object.defineProperties,S=Object.getOwnPropertyDescriptor,B=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertyNames,I=Object.getOwnPropertySymbols,W=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,N=(t,e,i)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,R=(t,e)=>{for(var i in e||(e={}))W.call(e,i)&&N(t,i,e[i]);if(I)for(var i of I(e))T.call(e,i)&&N(t,i,e[i]);return t},z=(t,e)=>j(t,B(e)),U=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},$=(t,e,i)=>(U(t,e,"read from private field"),i?i.call(t):e.get(t)),V=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},L=(t,e,i,n)=>(U(t,e,"write to private field"),n?n.call(t,i):e.set(t,i),i),H=(t,e,i)=>(U(t,e,"access private method"),i),q=(t,e,i)=>new Promise((n,s)=>{var a=t=>{try{l(i.next(t))}catch(t){s(t)}},r=t=>{try{l(i.throw(t))}catch(t){s(t)}},l=t=>t.done?n(t.value):Promise.resolve(t.value).then(a,r);l((i=i.apply(t,e)).next())}),K={};function X(t,e,i){return q(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function Z(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function J(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function Y(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function Q(t){return t*t/16129}function tt(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}function te(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}function ti(t){let e=!1;return()=>{e||(e=!0,t.forEach(t=>null==t?void 0:t()))}}((t,e)=>{for(var i in e)E(t,i,{get:e[i],enumerable:!0})})(K,{CacheStorage:()=>tu,DrumMachine:()=>td,ElectricPiano:()=>tg,HttpStorage:()=>to,LAYERS:()=>tB,Mallet:()=>tv,NAME_TO_PATH:()=>tw,Reverb:()=>tx,Sampler:()=>tA,Soundfont:()=>tC,SplendidGrandPiano:()=>tS,getDrumMachineNames:()=>tc,getElectricPianoNames:()=>t_,getMalletNames:()=>tM,getSoundfontKits:()=>tE,getSoundfontNames:()=>tj}),e.exports=((t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of O(e))W.call(t,i)||void 0===i||E(t,i,{get:()=>e[i],enumerable:!(n=S(e,i))||n.enumerable});return t})(E({},"__esModule",{value:!0}),K);var tn=class{constructor(t,e){var o,u;this.context=t,V(this,i,void 0),V(this,n,void 0),V(this,s,void 0),V(this,a,void 0),V(this,r,void 0),V(this,l,void 0),L(this,l,R({destination:t.destination,volume:100,volumeToGain:Q},e)),this.input=t.createGain(),L(this,i,t.createGain()),L(this,a,J([this.input,$(this,i),$(this,l).destination]));let h=tt(null!=(o=e.volume)?o:100);this.setVolume=h.set;let c=null!=(u=e.volumeToGain)?u:Q;L(this,r,h.subscribe(t=>{$(this,i).gain.value=c(t)}))}addInsert(t){null!=$(this,s)||L(this,s,[]),$(this,s).push(t),$(this,a).call(this),L(this,a,J([this.input,...$(this,s),$(this,i),$(this,l).destination]))}addEffect(t,e,s){let a=new GainNode(this.context);a.gain.value=s;let r="input"in e?e.input:e,l=J([$(this,i),a,r]);null!=$(this,n)||L(this,n,[]),$(this,n).push({name:t,mix:a,disconnect:l})}sendEffect(t,e){var i;let s=null==(i=$(this,n))?void 0:i.find(e=>e.name===t);s?s.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;$(this,a).call(this),$(this,r).call(this),null==(t=$(this,n))||t.forEach(t=>t.disconnect()),L(this,n,void 0)}};i=new WeakMap,n=new WeakMap,s=new WeakMap,a=new WeakMap,r=new WeakMap,l=new WeakMap;var ts=class{constructor(t,e){var i;this.destination=t,this.options=e,V(this,o,void 0),this.context=t.context,this.buffers={},L(this,o,te()),this.velocityToGain=null!=(i=e.velocityToGain)?i:Q}start(t){var e,i,n,s,a,r,l,u,h,c;let{destination:p,context:d}=this,f=this.buffers[t.note];if(!f)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let m=d.createBufferSource();m.buffer=f,m.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let y=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,P=y?new BiquadFilterNode(d,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,_=d.createGain(),b=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;_.gain.value=this.velocityToGain(b);let g=null!=(r=t.decayTime)?r:this.options.decayTime,[M,v]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(d,g);function D(t){if(null!=t||(t=d.currentTime),t<=A)m.stop(t);else{let e=v(t);m.stop(e)}}let F=null!=(l=t.stopId)?l:t.note,w=ti([J([m,P,_,M,p]),null==(u=t.stop)?void 0:u.call(t,D),$(this,o).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==F||D(null==t?void 0:t.time)})]);m.onended=()=>{var e;w(),null==(e=t.onEnded)||e.call(t,t)};let A=Math.max(null!=(h=t.time)?h:0,d.currentTime);m.start(t.time);let k=null!=(c=t.duration)?c:f.duration;return"number"==typeof t.duration&&D(A+k),D}stop(t){$(this,o).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};o=new WeakMap;var ta=class{constructor(t){this.compare=t,V(this,u,[])}push(t){let e=$(this,u).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,$(this,u)[e])?(s=e,n=e-1):i=e+1}$(this,u).splice(s,0,t)}pop(){return $(this,u).shift()}peek(){return $(this,u)[0]}removeAll(t){let e=$(this,u).length;return L(this,u,$(this,u).filter(e=>!t(e))),$(this,u).length!==e}clear(){L(this,u,[])}size(){return $(this,u).length}};u=new WeakMap;var tr=class{constructor(t,e){this.destination=t,V(this,h,void 0),V(this,c,void 0),L(this,h,new ta((t,e)=>t.time-e.time)),this.player=new ts(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==$(this,c)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):($(this,h).push(z(R({},t),{time:s})),$(this,c)||L(this,c,setInterval(()=>{let t=i.currentTime+1;for(;$(this,h).size()&&$(this,h).peek().time<=t;){let t=$(this,h).pop();t&&this.player.start(t)}$(this,h).size()||(clearInterval($(this,c)),L(this,c,void 0))},200)),e=>{(!e||e<s)&&$(this,h).removeAll(e=>e===t)||this.player.stop(z(R({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){$(this,h).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?$(this,h).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):$(this,h).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};h=new WeakMap,c=new WeakMap;var tl=class{constructor(t,e){this.context=t;let i=new tn(t,e);this.player=new tr(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},to={fetch:t=>fetch(t)},tu=class{constructor(t="smplr"){V(this,d),V(this,m),V(this,p,void 0),"undefined"!=typeof window&&"caches"in window?L(this,p,caches.open(t)):L(this,p,Promise.reject("CacheStorage not supported"))}fetch(t){return q(this,null,function*(){let e=new Request(t);try{return yield H(this,d,f).call(this,e)}catch(i){let t=yield fetch(e);return yield H(this,m,y).call(this,e,t),t}})}};p=new WeakMap,d=new WeakSet,f=function(t){return q(this,null,function*(){let e=yield $(this,p),i=yield e.match(t);if(i)return i;throw Error("Not found")})},m=new WeakSet,y=function(t,e){return q(this,null,function*(){try{let i=yield $(this,p);yield i.put(t,e.clone())}catch(t){}})};var th={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tc(){return Object.keys(tp)}var tp={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},td=class{constructor(t,e){var i,n;V(this,P,th),V(this,_,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:to,a=tp[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return q(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tl(t,e),this.output=this.player.output,L(this,_,function(t,e,i,n){var s;let a=null!=(s=Z(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>q(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield X(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{L(this,P,t)})}loaded(){return q(this,null,function*(){return yield $(this,_),this})}get sampleNames(){return $(this,P).sampleNames}getVariations(t){var e;return null!=(e=$(this,P).sampleNameVariations[t])?e:[]}start(t){var e;let i=$(this,P).nameToSample[t.note];return this.player.start(z(R({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tf(t,e){return q(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tm(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}P=new WeakMap,_=new WeakMap;var ty=Object.freeze({meta:{},global:{},groups:[]}),tP=class{constructor(t,e){var i;this.context=t,V(this,M),V(this,b,void 0),V(this,g,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tl(t,e),L(this,b,ty);let n=null!=(i=e.storage)?i:to;L(this,g,(function(t,e){return q(this,null,function*(){if("string"==typeof t)return tf(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tf(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(L(this,b,Object.freeze(e)),function(t,e,i,n){return q(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=Z(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return q(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>q(this,null,function*(){if(e[s])return;let a=yield X(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,$(this,b),n))))}get output(){return this.player.output}loaded(){return q(this,null,function*(){return yield $(this,g),this})}start(t){H(this,M,v).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function t_(){return Object.keys(tb)}b=new WeakMap,g=new WeakMap,M=new WeakSet,v=function(t){var e;let i=Y(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tm(e.midi,n.lokey,n.hikey)&&tm(e.velocity,n.lovel,n.hivel)&&tm(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tm(e.midi,t.lokey,t.hikey)&&tm(e.velocity,t.lovel,t.hivel)&&tm(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}($(this,b),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(z(R({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tb={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tg=class extends tP{constructor(t,e){var i;super(t,z(R({},e),{instrument:null!=(i=tb[e.instrument])?i:e.instrument}));let n=tt(0);this.tremolo={level:t=>n.set(Q(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tM(){return Object.keys(tw)}var tv=class extends tP{constructor(t,e){let i=function(t){if(!tw[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tD+tw[t]+tF}}(e.instrument);super(t,z(R({},e),{instrument:i}))}},tD="https://danigb.github.io/samples/vcsl/",tF=".websfz.json",tw={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tA=class{constructor(t,e={}){var i,n,s,a,r,l,o;this.context=t,V(this,D,void 0),V(this,F,void 0),V(this,w,void 0),V(this,A,void 0),L(this,D,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:Q,noteToSample:null!=(l=e.noteToSample)?l:t=>[t.note.toString(),0]}),this.buffers={},L(this,F,te());let u=null!=(o=e.storage)?o:to,h="function"==typeof $(this,D).buffers?$(this,D).buffers:function(t,e){return(i,n)=>q(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>q(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield X(i,a,e);t&&(n[s]=t)}}))])})}($(this,D).buffers,u);L(this,w,h(t,this.buffers)),L(this,A,new tn(t,$(this,D))),this.output=$(this,A)}loaded(){return q(this,null,function*(){return yield $(this,w),this})}start(t){var e,i,n;let s="object"==typeof t?t:{note:t},[a,r]=$(this,D).noteToSample(s,this.buffers,$(this,D)),l=this.buffers[a];if(!l)return console.warn(`Sample not found: '${a}'`),()=>void 0;let o=s.onEnded;return function(t){var e,i,n;let s=t.destination.context,a=s.createBufferSource();a.buffer=t.buffer,a.detune.value=null!=(e=null==t?void 0:t.detune)?e:0;let r=t.lpfCutoffHz?new BiquadFilterNode(s,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,l=s.createGain();l.gain.value=null!=(i=null==t?void 0:t.gain)?i:1;let[o,u]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(s,t.decayTime),h=ti([J([a,r,l,o,t.destination]),null==(n=t.stop)?void 0:n.call(t,e=>{(void 0===e||void 0===e.stopId||e.stopId===t.stopId)&&p(null==e?void 0:e.time)})]);a.onended=()=>{var e;h(),null==(e=t.onEnded)||e.call(t)};let c=t.time||s.currentTime;function p(t){if(null!=t||(t=s.currentTime),t<=c)a.stop(t);else{let e=u(t);a.stop(e)}}return a.start(c),void 0!==t.duration&&p(c+t.duration),p}({buffer:l,destination:$(this,A).input,time:s.time,duration:s.duration,decayTime:s.decayTime,lpfCutoffHz:s.lpfCutoffHz,detune:r+(null!=(e=s.detune)?e:$(this,D).detune),gain:$(this,D).volumeToGain(null!=(i=s.velocity)?i:$(this,D).velocity),stop:$(this,F).subscribe,stopId:null!=(n=s.stopId)?n:s.note,onEnded:o?()=>o(t):void 0})}stop(t){let e="object"==typeof t?t:{stopId:t};$(this,F).trigger(e)}};D=new WeakMap,F=new WeakMap,w=new WeakMap,A=new WeakMap;var tk=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tG=new WeakMap,tx=class{constructor(t){V(this,k,void 0),V(this,G,void 0),V(this,x,void 0),this.input=t.createGain(),L(this,x,t.destination),L(this,G,(function(t){return q(this,null,function*(){let e=tG.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tG.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect($(this,x)),L(this,k,t),this)))}get paramNames(){return tk}getParam(t){var e;return null==(e=$(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==$(this,k)}ready(){return $(this,G)}connect(t){$(this,k)&&($(this,k).disconnect($(this,x)),$(this,k).connect(t)),L(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tC=class{constructor(t,e){var i,n,s;this.context=t,V(this,C,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=Z(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tl(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>q(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>q(this,null,function*(){var e;let s=Y(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:to);L(this,C,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=Y(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(z(R({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return q(this,null,function*(){return yield $(this,C),this})}};function tE(){return["MusyngKite","FluidR3_GM"]}function tj(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}C=new WeakMap;var tS=class extends tA{constructor(t,e={}){var i,n,s;super(t,{destination:e.destination,detune:e.detune,volume:e.volume,velocity:e.velocity,decayTime:null!=(i=e.decayTime)?i:.5,lpfCutoffHz:e.lpfCutoffHz,buffers:function(t,e){var i;let n=null!=(i=Z(["ogg","m4a"]))?i:"ogg";return(i,s)=>q(this,null,function*(){for(let a of tB)yield Promise.all(a.samples.map(r=>q(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield X(i,o,e);u&&(s[a.name+r]=u)})))})}(null!=(n=e.baseUrl)?n:"https://danigb.github.io/samples/splendid-grand-piano",null!=(s=e.storage)?s:to),noteToSample:(t,e,i)=>{var n;let s=Y(t.note);if(!s)return[t.note,0];let a=null!=(n=t.velocity)?n:i.velocity,r=tB.findIndex(t=>a>=t.vel_range[0]&&a<=t.vel_range[1]),l=tB[r];return l?function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,0]:[t+(e+n),-(100*n)]}(l.name,s,e):["",0]}})}},tB=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[$(i)[0]])((n={exports:{}}).exports,n),n.exports}),ta={};function tr(t,e,i){return tn(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tl(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function to(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tu(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function th(t){return t*t/16129}function tc(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}function tp(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}function td(t){let e=!1;return()=>{e||(e=!0,t.forEach(t=>null==t?void 0:t()))}}((t,e)=>{for(var i in e)N(t,i,{get:e[i],enumerable:!0})})(ta,{CacheStorage:()=>tg,DrumMachine:()=>tF,ElectricPiano:()=>tE,HttpStorage:()=>tb,LAYERS:()=>tH,Mallet:()=>tS,NAME_TO_PATH:()=>tI,Reverb:()=>tR,Sampler:()=>tW,Soundfont:()=>tz,SplendidGrandPiano:()=>tL,getDrumMachineNames:()=>tv,getElectricPianoNames:()=>tx,getMalletNames:()=>tj,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=J(N({},"__esModule",{value:!0}),ta);var tf=class{constructor(t,e){var i,n;this.context=t,tt(this,r,void 0),tt(this,l,void 0),tt(this,o,void 0),tt(this,u,void 0),tt(this,h,void 0),tt(this,c,void 0),te(this,c,X({destination:t.destination,volume:100,volumeToGain:th},e)),this.input=t.createGain(),te(this,r,t.createGain()),te(this,u,to([this.input,Q(this,r),Q(this,c).destination]));let s=tc(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:th;te(this,h,s.subscribe(t=>{Q(this,r).gain.value=a(t)}))}addInsert(t){null!=Q(this,o)||te(this,o,[]),Q(this,o).push(t),Q(this,u).call(this),te(this,u,to([this.input,...Q(this,o),Q(this,r),Q(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=to([Q(this,r),n,s]);null!=Q(this,l)||te(this,l,[]),Q(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Q(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Q(this,u).call(this),Q(this,h).call(this),null==(t=Q(this,l))||t.forEach(t=>t.disconnect()),te(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tm=class{constructor(t,e){var i;this.destination=t,this.options=e,tt(this,p,void 0),this.context=t.context,this.buffers={},te(this,p,tp()),this.velocityToGain=null!=(i=e.velocityToGain)?i:th}start(t){var e,i,n,s,a,r,l,o,u,h;let{destination:c,context:d}=this,f=this.buffers[t.note];if(!f)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let m=d.createBufferSource();m.buffer=f,m.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let y=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,P=y?new BiquadFilterNode(d,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,_=d.createGain(),b=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;_.gain.value=this.velocityToGain(b);let g=null!=(r=t.decayTime)?r:this.options.decayTime,[M,v]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(d,g);function D(t){if(null!=t||(t=d.currentTime),t<=A)m.stop(t);else{let e=v(t);m.stop(e)}}let F=null!=(l=t.stopId)?l:t.note,w=td([to([m,P,_,M,c]),null==(o=t.stop)?void 0:o.call(t,D),Q(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==F||D(null==t?void 0:t.time)})]);m.onended=()=>{var e;w(),null==(e=t.onEnded)||e.call(t,t)};let A=Math.max(null!=(u=t.time)?u:0,d.currentTime);m.start(t.time);let k=null!=(h=t.duration)?h:f.duration;return"number"==typeof t.duration&&D(A+k),D}stop(t){Q(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var ty=class{constructor(t){this.compare=t,tt(this,d,[])}push(t){let e=Q(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Q(this,d)[e])?(s=e,n=e-1):i=e+1}Q(this,d).splice(s,0,t)}pop(){return Q(this,d).shift()}peek(){return Q(this,d)[0]}removeAll(t){let e=Q(this,d).length;return te(this,d,Q(this,d).filter(e=>!t(e))),Q(this,d).length!==e}clear(){te(this,d,[])}size(){return Q(this,d).length}};d=new WeakMap;var tP=class{constructor(t,e){this.destination=t,tt(this,f,void 0),tt(this,m,void 0),te(this,f,new ty((t,e)=>t.time-e.time)),this.player=new tm(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Q(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Q(this,f).push(Z(X({},t),{time:s})),Q(this,m)||te(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Q(this,f).size()&&Q(this,f).peek().time<=t;){let t=Q(this,f).pop();t&&this.player.start(t)}Q(this,f).size()||(clearInterval(Q(this,m)),te(this,m,void 0))},200)),e=>{(!e||e<s)&&Q(this,f).removeAll(e=>e===t)||this.player.stop(Z(X({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Q(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Q(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Q(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var t_=class{constructor(t,e){this.context=t;let i=new tf(t,e);this.player=new tP(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tb={fetch:t=>fetch(t)},tg=class{constructor(t="smplr"){tt(this,P),tt(this,b),tt(this,y,void 0),"undefined"!=typeof window&&"caches"in window?te(this,y,caches.open(t)):te(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return tn(this,null,function*(){let e=new Request(t);try{return yield ti(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield ti(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return tn(this,null,function*(){let e=yield Q(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return tn(this,null,function*(){try{let i=yield Q(this,y);yield i.put(t,e.clone())}catch(t){}})};var tM={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tv(){return Object.keys(tD)}var tD={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tF=class{constructor(t,e){var i,n;tt(this,M,tM),tt(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tb,a=tD[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return tn(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new t_(t,e),this.output=this.player.output,te(this,v,function(t,e,i,n){var s;let a=null!=(s=tl(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>tn(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tr(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{te(this,M,t)})}loaded(){return tn(this,null,function*(){return yield Q(this,v),this})}get sampleNames(){return Q(this,M).sampleNames}getVariations(t){var e;return null!=(e=Q(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Q(this,M).nameToSample[t.note];return this.player.start(Z(X({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tw(t,e){return tn(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tA(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tk=Object.freeze({meta:{},global:{},groups:[]}),tG=class{constructor(t,e){var i;this.context=t,tt(this,w),tt(this,D,void 0),tt(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new t_(t,e),te(this,D,tk);let n=null!=(i=e.storage)?i:tb;te(this,F,(function(t,e){return tn(this,null,function*(){if("string"==typeof t)return tw(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tw(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(te(this,D,Object.freeze(e)),function(t,e,i,n){return tn(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tl(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return tn(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>tn(this,null,function*(){if(e[s])return;let a=yield tr(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Q(this,D),n))))}get output(){return this.player.output}loaded(){return tn(this,null,function*(){return yield Q(this,F),this})}start(t){ti(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tx(){return Object.keys(tC)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tu(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tA(e.midi,n.lokey,n.hikey)&&tA(e.velocity,n.lovel,n.hivel)&&tA(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tA(e.midi,t.lokey,t.hikey)&&tA(e.velocity,t.lovel,t.hivel)&&tA(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Q(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(Z(X({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tC={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tE=class extends tG{constructor(t,e){var i;super(t,Z(X({},e),{instrument:null!=(i=tC[e.instrument])?i:e.instrument}));let n=tc(0);this.tremolo={level:t=>n.set(th(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tj(){return Object.keys(tI)}var tS=class extends tG{constructor(t,e){let i=function(t){if(!tI[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tB+tI[t]+tO}}(e.instrument);super(t,Z(X({},e),{instrument:i}))}},tB="https://danigb.github.io/samples/vcsl/",tO=".websfz.json",tI={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tW=class{constructor(t,e={}){var i,n,s,a,r,l,o;this.context=t,tt(this,k,void 0),tt(this,G,void 0),tt(this,x,void 0),tt(this,C,void 0),te(this,k,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:th,noteToSample:null!=(l=e.noteToSample)?l:t=>[t.note.toString(),0]}),this.buffers={},te(this,G,tp());let u=null!=(o=e.storage)?o:tb,h="function"==typeof Q(this,k).buffers?Q(this,k).buffers:function(t,e){return(i,n)=>tn(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>tn(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tr(i,a,e);t&&(n[s]=t)}}))])})}(Q(this,k).buffers,u);te(this,x,h(t,this.buffers)),te(this,C,new tf(t,Q(this,k))),this.output=Q(this,C)}loaded(){return tn(this,null,function*(){return yield Q(this,x),this})}start(t){var e,i,n;let s="object"==typeof t?t:{note:t},[a,r]=Q(this,k).noteToSample(s,this.buffers,Q(this,k)),l=this.buffers[a];if(!l)return console.warn(`Sample not found: '${a}'`),()=>void 0;let o=s.onEnded;return function(t){var e,i,n;let s=t.destination.context,a=s.createBufferSource();a.buffer=t.buffer,a.detune.value=null!=(e=null==t?void 0:t.detune)?e:0;let r=t.lpfCutoffHz?new BiquadFilterNode(s,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,l=s.createGain();l.gain.value=null!=(i=null==t?void 0:t.gain)?i:1;let[o,u]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(s,t.decayTime),h=td([to([a,r,l,o,t.destination]),null==(n=t.stop)?void 0:n.call(t,e=>{(void 0===e||void 0===e.stopId||e.stopId===t.stopId)&&p(null==e?void 0:e.time)})]);a.onended=()=>{var e;h(),null==(e=t.onEnded)||e.call(t)};let c=t.time||s.currentTime;function p(t){if(null!=t||(t=s.currentTime),t<=c)a.stop(t);else{let e=u(t);a.stop(e)}}return a.start(c),void 0!==t.duration&&p(c+t.duration),p}({buffer:l,destination:Q(this,C).input,time:s.time,duration:s.duration,decayTime:s.decayTime,lpfCutoffHz:s.lpfCutoffHz,detune:r+(null!=(e=s.detune)?e:Q(this,k).detune),gain:Q(this,k).volumeToGain(null!=(i=s.velocity)?i:Q(this,k).velocity),stop:Q(this,G).subscribe,stopId:null!=(n=s.stopId)?n:s.note,onEnded:o?()=>o(t):void 0})}stop(t){let e="object"==typeof t?t:{stopId:t};Q(this,G).trigger(e)}};k=new WeakMap,G=new WeakMap,x=new WeakMap,C=new WeakMap;var tT=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tN=new WeakMap,tR=class{constructor(t){tt(this,E,void 0),tt(this,j,void 0),tt(this,S,void 0),this.input=t.createGain(),te(this,S,t.destination),te(this,j,(function(t){return tn(this,null,function*(){let e=tN.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tN.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Q(this,S)),te(this,E,t),this)))}get paramNames(){return tT}getParam(t){var e;return null==(e=Q(this,E))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Q(this,E)}ready(){return Q(this,j)}connect(t){Q(this,E)&&(Q(this,E).disconnect(Q(this,S)),Q(this,E).connect(t)),te(this,S,t)}};E=new WeakMap,j=new WeakMap,S=new WeakMap;var tz=class{constructor(t,e){var i,n,s;this.context=t,tt(this,B,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tl(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new t_(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>tn(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>tn(this,null,function*(){var e;let s=tu(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:tb);te(this,B,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=tu(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(Z(X({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return tn(this,null,function*(){return yield Q(this,B),this})}};function tU(){return["MusyngKite","FluidR3_GM"]}function t$(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}B=new WeakMap;var tV=(a=null!=(s=ts())?T(L(s)):{},J(s&&s.__esModule?a:N(a,"default",{value:s,enumerable:!0}),s)),tL=class{constructor(t,e){tt(this,I),tt(this,O,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tV.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new t_(t,this.options);let i=function(t,e){var i;let n=null!=(i=tl(["ogg","m4a"]))?i:"ogg";return(i,s)=>tn(this,null,function*(){for(let a of tH)yield Promise.all(a.samples.map(r=>tn(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tr(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);te(this,O,i(t,this.player.buffers))}get buffers(){return this.player.buffers}loaded(){return tn(this,null,function*(){return yield Q(this,O),this})}start(t){var e,i;let n="object"==typeof t?X({},t):{note:t},s=ti(this,I,W).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};O=new WeakMap,I=new WeakSet,W=function(t){var e;let i=tu(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tH.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tH[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e+n,-(100*n)]}(a.name,i,this.player.buffers)};var tH=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[$(i)[0]])((n={exports:{}}).exports,n),n.exports}),ta={};function tr(t,e,i){return tn(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tl(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function to(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tu(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function th(t){return t*t/16129}function tc(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}function tp(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}function td(t){let e=!1;return()=>{e||(e=!0,t.forEach(t=>null==t?void 0:t()))}}((t,e)=>{for(var i in e)N(t,i,{get:e[i],enumerable:!0})})(ta,{CacheStorage:()=>tg,DrumMachine:()=>tF,ElectricPiano:()=>tE,HttpStorage:()=>tb,LAYERS:()=>tH,Mallet:()=>tS,NAME_TO_PATH:()=>tI,Reverb:()=>tR,Sampler:()=>tW,Soundfont:()=>tz,SplendidGrandPiano:()=>tL,getDrumMachineNames:()=>tv,getElectricPianoNames:()=>tx,getMalletNames:()=>tj,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=J(N({},"__esModule",{value:!0}),ta);var tf=class{constructor(t,e){var i,n;this.context=t,tt(this,r,void 0),tt(this,l,void 0),tt(this,o,void 0),tt(this,u,void 0),tt(this,h,void 0),tt(this,c,void 0),te(this,c,X({destination:t.destination,volume:100,volumeToGain:th},e)),this.input=t.createGain(),te(this,r,t.createGain()),te(this,u,to([this.input,Q(this,r),Q(this,c).destination]));let s=tc(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:th;te(this,h,s.subscribe(t=>{Q(this,r).gain.value=a(t)}))}addInsert(t){null!=Q(this,o)||te(this,o,[]),Q(this,o).push(t),Q(this,u).call(this),te(this,u,to([this.input,...Q(this,o),Q(this,r),Q(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=to([Q(this,r),n,s]);null!=Q(this,l)||te(this,l,[]),Q(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Q(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Q(this,u).call(this),Q(this,h).call(this),null==(t=Q(this,l))||t.forEach(t=>t.disconnect()),te(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tm=class{constructor(t,e){var i;this.destination=t,this.options=e,tt(this,p,void 0),this.context=t.context,this.buffers={},te(this,p,tp()),this.velocityToGain=null!=(i=e.velocityToGain)?i:th}start(t){var e,i,n,s,a,r,l,o,u,h;let{destination:c,context:d}=this,f=this.buffers[t.note];if(!f)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let m=d.createBufferSource();m.buffer=f,m.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let y=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,P=y?new BiquadFilterNode(d,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,_=d.createGain(),b=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;_.gain.value=this.velocityToGain(b);let g=null!=(r=t.decayTime)?r:this.options.decayTime,[M,v]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(d,g);function D(t){if(null!=t||(t=d.currentTime),t<=A)m.stop(t);else{let e=v(t);m.stop(e)}}let F=null!=(l=t.stopId)?l:t.note,w=td([to([m,P,_,M,c]),null==(o=t.stop)?void 0:o.call(t,D),Q(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==F||D(null==t?void 0:t.time)})]);m.onended=()=>{var e;w(),null==(e=t.onEnded)||e.call(t,t)};let A=Math.max(null!=(u=t.time)?u:0,d.currentTime);m.start(t.time);let k=null!=(h=t.duration)?h:f.duration;return"number"==typeof t.duration&&D(A+k),D}stop(t){Q(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var ty=class{constructor(t){this.compare=t,tt(this,d,[])}push(t){let e=Q(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Q(this,d)[e])?(s=e,n=e-1):i=e+1}Q(this,d).splice(s,0,t)}pop(){return Q(this,d).shift()}peek(){return Q(this,d)[0]}removeAll(t){let e=Q(this,d).length;return te(this,d,Q(this,d).filter(e=>!t(e))),Q(this,d).length!==e}clear(){te(this,d,[])}size(){return Q(this,d).length}};d=new WeakMap;var tP=class{constructor(t,e){this.destination=t,tt(this,f,void 0),tt(this,m,void 0),te(this,f,new ty((t,e)=>t.time-e.time)),this.player=new tm(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Q(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Q(this,f).push(Z(X({},t),{time:s})),Q(this,m)||te(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Q(this,f).size()&&Q(this,f).peek().time<=t;){let t=Q(this,f).pop();t&&this.player.start(t)}Q(this,f).size()||(clearInterval(Q(this,m)),te(this,m,void 0))},200)),e=>{(!e||e<s)&&Q(this,f).removeAll(e=>e===t)||this.player.stop(Z(X({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Q(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Q(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Q(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var t_=class{constructor(t,e){this.context=t;let i=new tf(t,e);this.player=new tP(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tb={fetch:t=>fetch(t)},tg=class{constructor(t="smplr"){tt(this,P),tt(this,b),tt(this,y,void 0),"undefined"!=typeof window&&"caches"in window?te(this,y,caches.open(t)):te(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return tn(this,null,function*(){let e=new Request(t);try{return yield ti(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield ti(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return tn(this,null,function*(){let e=yield Q(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return tn(this,null,function*(){try{let i=yield Q(this,y);yield i.put(t,e.clone())}catch(t){}})};var tM={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tv(){return Object.keys(tD)}var tD={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tF=class{constructor(t,e){var i,n;tt(this,M,tM),tt(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tb,a=tD[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return tn(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new t_(t,e),this.output=this.player.output,te(this,v,function(t,e,i,n){var s;let a=null!=(s=tl(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>tn(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tr(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{te(this,M,t)})}loaded(){return tn(this,null,function*(){return yield Q(this,v),this})}get sampleNames(){return Q(this,M).sampleNames}getVariations(t){var e;return null!=(e=Q(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Q(this,M).nameToSample[t.note];return this.player.start(Z(X({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tw(t,e){return tn(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tA(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tk=Object.freeze({meta:{},global:{},groups:[]}),tG=class{constructor(t,e){var i;this.context=t,tt(this,w),tt(this,D,void 0),tt(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new t_(t,e),te(this,D,tk);let n=null!=(i=e.storage)?i:tb;te(this,F,(function(t,e){return tn(this,null,function*(){if("string"==typeof t)return tw(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tw(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(te(this,D,Object.freeze(e)),function(t,e,i,n){return tn(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tl(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return tn(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>tn(this,null,function*(){if(e[s])return;let a=yield tr(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Q(this,D),n))))}get output(){return this.player.output}loaded(){return tn(this,null,function*(){return yield Q(this,F),this})}start(t){ti(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tx(){return Object.keys(tC)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tu(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tA(e.midi,n.lokey,n.hikey)&&tA(e.velocity,n.lovel,n.hivel)&&tA(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tA(e.midi,t.lokey,t.hikey)&&tA(e.velocity,t.lovel,t.hivel)&&tA(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Q(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(Z(X({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tC={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tE=class extends tG{constructor(t,e){var i;super(t,Z(X({},e),{instrument:null!=(i=tC[e.instrument])?i:e.instrument}));let n=tc(0);this.tremolo={level:t=>n.set(th(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tj(){return Object.keys(tI)}var tS=class extends tG{constructor(t,e){let i=function(t){if(!tI[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tB+tI[t]+tO}}(e.instrument);super(t,Z(X({},e),{instrument:i}))}},tB="https://danigb.github.io/samples/vcsl/",tO=".websfz.json",tI={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tW=class{constructor(t,e={}){var i,n,s,a,r,l,o;this.context=t,tt(this,k,void 0),tt(this,G,void 0),tt(this,x,void 0),tt(this,C,void 0),te(this,k,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:th,noteToSample:null!=(l=e.noteToSample)?l:t=>[t.note.toString(),0]}),this.buffers={},te(this,G,tp());let u=null!=(o=e.storage)?o:tb,h="function"==typeof Q(this,k).buffers?Q(this,k).buffers:function(t,e){return(i,n)=>tn(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>tn(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tr(i,a,e);t&&(n[s]=t)}}))])})}(Q(this,k).buffers,u);te(this,x,h(t,this.buffers)),te(this,C,new tf(t,Q(this,k))),this.output=Q(this,C)}loaded(){return tn(this,null,function*(){return yield Q(this,x),this})}start(t){var e,i,n;let s="object"==typeof t?t:{note:t},[a,r]=Q(this,k).noteToSample(s,this.buffers,Q(this,k)),l=this.buffers[a];if(!l)return console.warn(`Sample not found: '${a}'`),()=>void 0;let o=s.onEnded;return function(t){var e,i,n;let s=t.destination.context,a=s.createBufferSource();a.buffer=t.buffer,a.detune.value=null!=(e=null==t?void 0:t.detune)?e:0;let r=t.lpfCutoffHz?new BiquadFilterNode(s,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,l=s.createGain();l.gain.value=null!=(i=null==t?void 0:t.gain)?i:1;let[o,u]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(s,t.decayTime),h=td([to([a,r,l,o,t.destination]),null==(n=t.stop)?void 0:n.call(t,e=>{(void 0===e||void 0===e.stopId||e.stopId===t.stopId)&&p(null==e?void 0:e.time)})]);a.onended=()=>{var e;h(),null==(e=t.onEnded)||e.call(t)};let c=t.time||s.currentTime;function p(t){if(null!=t||(t=s.currentTime),t<=c)a.stop(t);else{let e=u(t);a.stop(e)}}return a.start(c),void 0!==t.duration&&p(c+t.duration),p}({buffer:l,destination:Q(this,C).input,time:s.time,duration:s.duration,decayTime:s.decayTime,lpfCutoffHz:s.lpfCutoffHz,detune:r+(null!=(e=s.detune)?e:Q(this,k).detune),gain:Q(this,k).volumeToGain(null!=(i=s.velocity)?i:Q(this,k).velocity),stop:Q(this,G).subscribe,stopId:null!=(n=s.stopId)?n:s.note,onEnded:o?()=>o(t):void 0})}stop(t){let e="object"==typeof t?t:{stopId:t};Q(this,G).trigger(e)}};k=new WeakMap,G=new WeakMap,x=new WeakMap,C=new WeakMap;var tT=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tN=new WeakMap,tR=class{constructor(t){tt(this,E,void 0),tt(this,j,void 0),tt(this,S,void 0),this.input=t.createGain(),te(this,S,t.destination),te(this,j,(function(t){return tn(this,null,function*(){let e=tN.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tN.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Q(this,S)),te(this,E,t),this)))}get paramNames(){return tT}getParam(t){var e;return null==(e=Q(this,E))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Q(this,E)}ready(){return Q(this,j)}connect(t){Q(this,E)&&(Q(this,E).disconnect(Q(this,S)),Q(this,E).connect(t)),te(this,S,t)}};E=new WeakMap,j=new WeakMap,S=new WeakMap;var tz=class{constructor(t,e){var i,n,s;this.context=t,tt(this,B,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tl(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new t_(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>tn(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>tn(this,null,function*(){var e;let s=tu(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:tb);te(this,B,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=tu(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(Z(X({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return tn(this,null,function*(){return yield Q(this,B),this})}};function tU(){return["MusyngKite","FluidR3_GM"]}function t$(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}B=new WeakMap;var tV=(a=null!=(s=ts())?T(L(s)):{},J(s&&s.__esModule?a:N(a,"default",{value:s,enumerable:!0}),s)),tL=class{constructor(t,e){tt(this,I),tt(this,O,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tV.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new t_(t,this.options);let i=function(t,e){var i;let n=null!=(i=tl(["ogg","m4a"]))?i:"ogg";return(i,s)=>tn(this,null,function*(){for(let a of tH)yield Promise.all(a.samples.map(r=>tn(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tr(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);te(this,O,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return tn(this,null,function*(){return yield Q(this,O),this})}start(t){var e,i;let n="object"==typeof t?X({},t):{note:t},s=ti(this,I,W).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};O=new WeakMap,I=new WeakSet,W=function(t){var e;let i=tu(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tH.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tH[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e+n,-(100*n)]}(a.name,i,this.player.buffers)};var tH=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[$(i)[0]])((n={exports:{}}).exports,n),n.exports}),ta={};function tr(t,e,i){return tn(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tl(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function to(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tu(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function th(t){return t*t/16129}function tc(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}function tp(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}function td(t){let e=!1;return()=>{e||(e=!0,t.forEach(t=>null==t?void 0:t()))}}((t,e)=>{for(var i in e)N(t,i,{get:e[i],enumerable:!0})})(ta,{CacheStorage:()=>tg,DrumMachine:()=>tF,ElectricPiano:()=>tE,HttpStorage:()=>tb,LAYERS:()=>tH,Mallet:()=>tS,NAME_TO_PATH:()=>tI,Reverb:()=>tR,Sampler:()=>tW,Soundfont:()=>tz,SplendidGrandPiano:()=>tL,getDrumMachineNames:()=>tv,getElectricPianoNames:()=>tx,getMalletNames:()=>tj,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=J(N({},"__esModule",{value:!0}),ta);var tf=class{constructor(t,e){var i,n;this.context=t,tt(this,r,void 0),tt(this,l,void 0),tt(this,o,void 0),tt(this,u,void 0),tt(this,h,void 0),tt(this,c,void 0),te(this,c,X({destination:t.destination,volume:100,volumeToGain:th},e)),this.input=t.createGain(),te(this,r,t.createGain()),te(this,u,to([this.input,Q(this,r),Q(this,c).destination]));let s=tc(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:th;te(this,h,s.subscribe(t=>{Q(this,r).gain.value=a(t)}))}addInsert(t){null!=Q(this,o)||te(this,o,[]),Q(this,o).push(t),Q(this,u).call(this),te(this,u,to([this.input,...Q(this,o),Q(this,r),Q(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=to([Q(this,r),n,s]);null!=Q(this,l)||te(this,l,[]),Q(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Q(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Q(this,u).call(this),Q(this,h).call(this),null==(t=Q(this,l))||t.forEach(t=>t.disconnect()),te(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tm=class{constructor(t,e){var i;this.destination=t,this.options=e,tt(this,p,void 0),this.context=t.context,this.buffers={},te(this,p,tp()),this.velocityToGain=null!=(i=e.velocityToGain)?i:th}start(t){var e,i,n,s,a,r,l,o,u,h;let{destination:c,context:d}=this,f=this.buffers[t.note];if(!f)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let m=d.createBufferSource();m.buffer=f,m.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let y=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,P=y?new BiquadFilterNode(d,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,_=d.createGain(),b=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;_.gain.value=this.velocityToGain(b);let g=null!=(r=t.decayTime)?r:this.options.decayTime,[M,v]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(d,g);function D(t){if(null!=t||(t=d.currentTime),t<=A)m.stop(t);else{let e=v(t);m.stop(e)}}let F=null!=(l=t.stopId)?l:t.note,w=td([to([m,P,_,M,c]),null==(o=t.stop)?void 0:o.call(t,D),Q(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==F||D(null==t?void 0:t.time)})]);m.onended=()=>{var e;w(),null==(e=t.onEnded)||e.call(t,t)};let A=Math.max(null!=(u=t.time)?u:0,d.currentTime);m.start(t.time);let k=null!=(h=t.duration)?h:f.duration;return"number"==typeof t.duration&&D(A+k),D}stop(t){Q(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var ty=class{constructor(t){this.compare=t,tt(this,d,[])}push(t){let e=Q(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Q(this,d)[e])?(s=e,n=e-1):i=e+1}Q(this,d).splice(s,0,t)}pop(){return Q(this,d).shift()}peek(){return Q(this,d)[0]}removeAll(t){let e=Q(this,d).length;return te(this,d,Q(this,d).filter(e=>!t(e))),Q(this,d).length!==e}clear(){te(this,d,[])}size(){return Q(this,d).length}};d=new WeakMap;var tP=class{constructor(t,e){this.destination=t,tt(this,f,void 0),tt(this,m,void 0),te(this,f,new ty((t,e)=>t.time-e.time)),this.player=new tm(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Q(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Q(this,f).push(Z(X({},t),{time:s})),Q(this,m)||te(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Q(this,f).size()&&Q(this,f).peek().time<=t;){let t=Q(this,f).pop();t&&this.player.start(t)}Q(this,f).size()||(clearInterval(Q(this,m)),te(this,m,void 0))},200)),e=>{(!e||e<s)&&Q(this,f).removeAll(e=>e===t)||this.player.stop(Z(X({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Q(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Q(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Q(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var t_=class{constructor(t,e){this.context=t;let i=new tf(t,e);this.player=new tP(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tb={fetch:t=>fetch(t)},tg=class{constructor(t="smplr"){tt(this,P),tt(this,b),tt(this,y,void 0),"undefined"!=typeof window&&"caches"in window?te(this,y,caches.open(t)):te(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return tn(this,null,function*(){let e=new Request(t);try{return yield ti(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield ti(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return tn(this,null,function*(){let e=yield Q(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return tn(this,null,function*(){try{let i=yield Q(this,y);yield i.put(t,e.clone())}catch(t){}})};var tM={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tv(){return Object.keys(tD)}var tD={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tF=class{constructor(t,e){var i,n;tt(this,M,tM),tt(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tb,a=tD[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return tn(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new t_(t,e),this.output=this.player.output,te(this,v,function(t,e,i,n){var s;let a=null!=(s=tl(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>tn(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tr(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{te(this,M,t)})}loaded(){return tn(this,null,function*(){return yield Q(this,v),this})}get sampleNames(){return Q(this,M).sampleNames}getVariations(t){var e;return null!=(e=Q(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Q(this,M).nameToSample[t.note];return this.player.start(Z(X({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tw(t,e){return tn(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tA(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tk=Object.freeze({meta:{},global:{},groups:[]}),tG=class{constructor(t,e){var i;this.context=t,tt(this,w),tt(this,D,void 0),tt(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new t_(t,e),te(this,D,tk);let n=null!=(i=e.storage)?i:tb;te(this,F,(function(t,e){return tn(this,null,function*(){if("string"==typeof t)return tw(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tw(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(te(this,D,Object.freeze(e)),function(t,e,i,n){return tn(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tl(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return tn(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>tn(this,null,function*(){if(e[s])return;let a=yield tr(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Q(this,D),n))))}get output(){return this.player.output}loaded(){return tn(this,null,function*(){return yield Q(this,F),this})}start(t){ti(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tx(){return Object.keys(tC)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tu(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tA(e.midi,n.lokey,n.hikey)&&tA(e.velocity,n.lovel,n.hivel)&&tA(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tA(e.midi,t.lokey,t.hikey)&&tA(e.velocity,t.lovel,t.hivel)&&tA(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Q(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(Z(X({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tC={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tE=class extends tG{constructor(t,e){var i;super(t,Z(X({},e),{instrument:null!=(i=tC[e.instrument])?i:e.instrument}));let n=tc(0);this.tremolo={level:t=>n.set(th(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tj(){return Object.keys(tI)}var tS=class extends tG{constructor(t,e){let i=function(t){if(!tI[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tB+tI[t]+tO}}(e.instrument);super(t,Z(X({},e),{instrument:i}))}},tB="https://danigb.github.io/samples/vcsl/",tO=".websfz.json",tI={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tW=class{constructor(t,e={}){var i,n,s,a,r,l,o;this.context=t,tt(this,k,void 0),tt(this,G,void 0),tt(this,x,void 0),tt(this,C,void 0),te(this,k,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:th,noteToSample:null!=(l=e.noteToSample)?l:t=>[t.note.toString(),0]}),this.buffers={},te(this,G,tp());let u=null!=(o=e.storage)?o:tb,h="function"==typeof Q(this,k).buffers?Q(this,k).buffers:function(t,e){return(i,n)=>tn(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>tn(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tr(i,a,e);t&&(n[s]=t)}}))])})}(Q(this,k).buffers,u);te(this,x,h(t,this.buffers)),te(this,C,new tf(t,Q(this,k))),this.output=Q(this,C)}loaded(){return tn(this,null,function*(){return yield Q(this,x),this})}start(t){var e,i,n;let s="object"==typeof t?t:{note:t},[a,r]=Q(this,k).noteToSample(s,this.buffers,Q(this,k)),l=this.buffers[a];if(!l)return console.warn(`Sample not found: '${a}'`),()=>void 0;let o=s.onEnded;return function(t){var e,i,n;let s=t.destination.context,a=s.createBufferSource();a.buffer=t.buffer,a.detune.value=null!=(e=null==t?void 0:t.detune)?e:0;let r=t.lpfCutoffHz?new BiquadFilterNode(s,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,l=s.createGain();l.gain.value=null!=(i=null==t?void 0:t.gain)?i:1;let[o,u]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(s,t.decayTime),h=td([to([a,r,l,o,t.destination]),null==(n=t.stop)?void 0:n.call(t,e=>{(void 0===e||void 0===e.stopId||e.stopId===t.stopId)&&p(null==e?void 0:e.time)})]);a.onended=()=>{var e;h(),null==(e=t.onEnded)||e.call(t)};let c=t.time||s.currentTime;function p(t){if(null!=t||(t=s.currentTime),t<=c)a.stop(t);else{let e=u(t);a.stop(e)}}return a.start(c),void 0!==t.duration&&p(c+t.duration),p}({buffer:l,destination:Q(this,C).input,time:s.time,duration:s.duration,decayTime:s.decayTime,lpfCutoffHz:s.lpfCutoffHz,detune:r+(null!=(e=s.detune)?e:Q(this,k).detune),gain:Q(this,k).volumeToGain(null!=(i=s.velocity)?i:Q(this,k).velocity),stop:Q(this,G).subscribe,stopId:null!=(n=s.stopId)?n:s.note,onEnded:o?()=>o(t):void 0})}stop(t){let e="object"==typeof t?t:{stopId:t};Q(this,G).trigger(e)}};k=new WeakMap,G=new WeakMap,x=new WeakMap,C=new WeakMap;var tT=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tN=new WeakMap,tR=class{constructor(t){tt(this,E,void 0),tt(this,j,void 0),tt(this,S,void 0),this.input=t.createGain(),te(this,S,t.destination),te(this,j,(function(t){return tn(this,null,function*(){let e=tN.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tN.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Q(this,S)),te(this,E,t),this)))}get paramNames(){return tT}getParam(t){var e;return null==(e=Q(this,E))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Q(this,E)}ready(){return Q(this,j)}connect(t){Q(this,E)&&(Q(this,E).disconnect(Q(this,S)),Q(this,E).connect(t)),te(this,S,t)}};E=new WeakMap,j=new WeakMap,S=new WeakMap;var tz=class{constructor(t,e){var i,n,s;this.context=t,tt(this,B,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tl(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new t_(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>tn(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>tn(this,null,function*(){var e;let s=tu(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:tb);te(this,B,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=tu(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(Z(X({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return tn(this,null,function*(){return yield Q(this,B),this})}};function tU(){return["MusyngKite","FluidR3_GM"]}function t$(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}B=new WeakMap;var tV=(a=null!=(s=ts())?T(L(s)):{},J(s&&s.__esModule?a:N(a,"default",{value:s,enumerable:!0}),s)),tL=class{constructor(t,e){this.context=t,tt(this,I),tt(this,O,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tV.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new t_(t,this.options);let i=function(t,e){var i;let n=null!=(i=tl(["ogg","m4a"]))?i:"ogg";return(i,s)=>tn(this,null,function*(){for(let a of tH)yield Promise.all(a.samples.map(r=>tn(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tr(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);te(this,O,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return tn(this,null,function*(){return yield Q(this,O),this})}start(t){var e,i;let n="object"==typeof t?X({},t):{note:t},s=ti(this,I,W).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};O=new WeakMap,I=new WeakSet,W=function(t){var e;let i=tu(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tH.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tH[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e+n,-(100*n)]}(a.name,i,this.player.buffers)};var tH=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[$(i)[0]])((n={exports:{}}).exports,n),n.exports}),ta={};function tr(t,e,i){return tn(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tl(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function to(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tu(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function th(t){return t*t/16129}function tc(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}function tp(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}function td(t){let e=!1;return()=>{e||(e=!0,t.forEach(t=>null==t?void 0:t()))}}((t,e)=>{for(var i in e)N(t,i,{get:e[i],enumerable:!0})})(ta,{CacheStorage:()=>tg,DrumMachine:()=>tF,ElectricPiano:()=>tE,HttpStorage:()=>tb,LAYERS:()=>tH,Mallet:()=>tS,NAME_TO_PATH:()=>tI,Reverb:()=>tR,Sampler:()=>tW,Soundfont:()=>tz,SplendidGrandPiano:()=>tL,getDrumMachineNames:()=>tv,getElectricPianoNames:()=>tx,getMalletNames:()=>tj,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=J(N({},"__esModule",{value:!0}),ta);var tf=class{constructor(t,e){var i,n;this.context=t,tt(this,r,void 0),tt(this,l,void 0),tt(this,o,void 0),tt(this,u,void 0),tt(this,h,void 0),tt(this,c,void 0),te(this,c,X({destination:t.destination,volume:100,volumeToGain:th},e)),this.input=t.createGain(),te(this,r,t.createGain()),te(this,u,to([this.input,Q(this,r),Q(this,c).destination]));let s=tc(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:th;te(this,h,s.subscribe(t=>{Q(this,r).gain.value=a(t)}))}addInsert(t){null!=Q(this,o)||te(this,o,[]),Q(this,o).push(t),Q(this,u).call(this),te(this,u,to([this.input,...Q(this,o),Q(this,r),Q(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=to([Q(this,r),n,s]);null!=Q(this,l)||te(this,l,[]),Q(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Q(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Q(this,u).call(this),Q(this,h).call(this),null==(t=Q(this,l))||t.forEach(t=>t.disconnect()),te(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tm=class{constructor(t,e){var i;this.destination=t,this.options=e,tt(this,p,void 0),this.context=t.context,this.buffers={},te(this,p,tp()),this.velocityToGain=null!=(i=e.velocityToGain)?i:th}start(t){var e,i,n,s,a,r,l,o,u,h;let{destination:c,context:d}=this,f=this.buffers[t.note];if(!f)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let m=d.createBufferSource();m.buffer=f,m.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let y=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,P=y?new BiquadFilterNode(d,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,_=d.createGain(),b=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;_.gain.value=this.velocityToGain(b);let g=null!=(r=t.decayTime)?r:this.options.decayTime,[M,v]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(d,g);function D(t){if(null!=t||(t=d.currentTime),t<=A)m.stop(t);else{let e=v(t);m.stop(e)}}let F=null!=(l=t.stopId)?l:t.note,w=td([to([m,P,_,M,c]),null==(o=t.stop)?void 0:o.call(t,D),Q(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==F||D(null==t?void 0:t.time)})]);m.onended=()=>{var e;w(),null==(e=t.onEnded)||e.call(t,t)};let A=Math.max(null!=(u=t.time)?u:0,d.currentTime);m.start(t.time);let k=null!=(h=t.duration)?h:f.duration;return"number"==typeof t.duration&&D(A+k),D}stop(t){Q(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var ty=class{constructor(t){this.compare=t,tt(this,d,[])}push(t){let e=Q(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Q(this,d)[e])?(s=e,n=e-1):i=e+1}Q(this,d).splice(s,0,t)}pop(){return Q(this,d).shift()}peek(){return Q(this,d)[0]}removeAll(t){let e=Q(this,d).length;return te(this,d,Q(this,d).filter(e=>!t(e))),Q(this,d).length!==e}clear(){te(this,d,[])}size(){return Q(this,d).length}};d=new WeakMap;var tP=class{constructor(t,e){this.destination=t,tt(this,f,void 0),tt(this,m,void 0),te(this,f,new ty((t,e)=>t.time-e.time)),this.player=new tm(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Q(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Q(this,f).push(Z(X({},t),{time:s})),Q(this,m)||te(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Q(this,f).size()&&Q(this,f).peek().time<=t;){let t=Q(this,f).pop();t&&this.player.start(t)}Q(this,f).size()||(clearInterval(Q(this,m)),te(this,m,void 0))},200)),e=>{(!e||e<s)&&Q(this,f).removeAll(e=>e===t)||this.player.stop(Z(X({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Q(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Q(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Q(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var t_=class{constructor(t,e){this.context=t;let i=new tf(t,e);this.player=new tP(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tb={fetch:t=>fetch(t)},tg=class{constructor(t="smplr"){tt(this,P),tt(this,b),tt(this,y,void 0),"undefined"!=typeof window&&"caches"in window?te(this,y,caches.open(t)):te(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return tn(this,null,function*(){let e=new Request(t);try{return yield ti(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield ti(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return tn(this,null,function*(){let e=yield Q(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return tn(this,null,function*(){try{let i=yield Q(this,y);yield i.put(t,e.clone())}catch(t){}})};var tM={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tv(){return Object.keys(tD)}var tD={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tF=class{constructor(t,e){var i,n;tt(this,M,tM),tt(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tb,a=tD[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return tn(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new t_(t,e),this.output=this.player.output,te(this,v,function(t,e,i,n){var s;let a=null!=(s=tl(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>tn(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tr(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{te(this,M,t)})}loaded(){return tn(this,null,function*(){return yield Q(this,v),this})}get sampleNames(){return Q(this,M).sampleNames}getVariations(t){var e;return null!=(e=Q(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Q(this,M).nameToSample[t.note];return this.player.start(Z(X({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tw(t,e){return tn(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tA(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tk=Object.freeze({meta:{},global:{},groups:[]}),tG=class{constructor(t,e){var i;this.context=t,tt(this,w),tt(this,D,void 0),tt(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new t_(t,e),te(this,D,tk);let n=null!=(i=e.storage)?i:tb;te(this,F,(function(t,e){return tn(this,null,function*(){if("string"==typeof t)return tw(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tw(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(te(this,D,Object.freeze(e)),function(t,e,i,n){return tn(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tl(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return tn(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>tn(this,null,function*(){if(e[s])return;let a=yield tr(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Q(this,D),n))))}get output(){return this.player.output}loaded(){return tn(this,null,function*(){return yield Q(this,F),this})}start(t){ti(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tx(){return Object.keys(tC)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tu(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tA(e.midi,n.lokey,n.hikey)&&tA(e.velocity,n.lovel,n.hivel)&&tA(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tA(e.midi,t.lokey,t.hikey)&&tA(e.velocity,t.lovel,t.hivel)&&tA(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Q(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(Z(X({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tC={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tE=class extends tG{constructor(t,e){var i;super(t,Z(X({},e),{instrument:null!=(i=tC[e.instrument])?i:e.instrument}));let n=tc(0);this.tremolo={level:t=>n.set(th(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tj(){return Object.keys(tI)}var tS=class extends tG{constructor(t,e){let i=function(t){if(!tI[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tB+tI[t]+tO}}(e.instrument);super(t,Z(X({},e),{instrument:i}))}},tB="https://danigb.github.io/samples/vcsl/",tO=".websfz.json",tI={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tW=class{constructor(t,e={}){var i,n,s,a,r,l,o;this.context=t,tt(this,k,void 0),tt(this,G,void 0),tt(this,x,void 0),tt(this,C,void 0),te(this,k,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:th,noteToSample:null!=(l=e.noteToSample)?l:t=>[t.note.toString(),0]}),this.buffers={},te(this,G,tp());let u=null!=(o=e.storage)?o:tb,h="function"==typeof Q(this,k).buffers?Q(this,k).buffers:function(t,e){return(i,n)=>tn(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>tn(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tr(i,a,e);t&&(n[s]=t)}}))])})}(Q(this,k).buffers,u);te(this,x,h(t,this.buffers)),te(this,C,new tf(t,Q(this,k))),this.output=Q(this,C)}loaded(){return tn(this,null,function*(){return yield Q(this,x),this})}start(t){var e,i,n;let s="object"==typeof t?t:{note:t},[a,r]=Q(this,k).noteToSample(s,this.buffers,Q(this,k)),l=this.buffers[a];if(!l)return console.warn(`Sample not found: '${a}'`),()=>void 0;let o=s.onEnded;return function(t){var e,i,n;let s=t.destination.context,a=s.createBufferSource();a.buffer=t.buffer,a.detune.value=null!=(e=null==t?void 0:t.detune)?e:0;let r=t.lpfCutoffHz?new BiquadFilterNode(s,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,l=s.createGain();l.gain.value=null!=(i=null==t?void 0:t.gain)?i:1;let[o,u]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(s,t.decayTime),h=td([to([a,r,l,o,t.destination]),null==(n=t.stop)?void 0:n.call(t,e=>{(void 0===e||void 0===e.stopId||e.stopId===t.stopId)&&p(null==e?void 0:e.time)})]);a.onended=()=>{var e;h(),null==(e=t.onEnded)||e.call(t)};let c=t.time||s.currentTime;function p(t){if(null!=t||(t=s.currentTime),t<=c)a.stop(t);else{let e=u(t);a.stop(e)}}return a.start(c),void 0!==t.duration&&p(c+t.duration),p}({buffer:l,destination:Q(this,C).input,time:s.time,duration:s.duration,decayTime:s.decayTime,lpfCutoffHz:s.lpfCutoffHz,detune:r+(null!=(e=s.detune)?e:Q(this,k).detune),gain:Q(this,k).volumeToGain(null!=(i=s.velocity)?i:Q(this,k).velocity),stop:Q(this,G).subscribe,stopId:null!=(n=s.stopId)?n:s.note,onEnded:o?()=>o(t):void 0})}stop(t){let e="object"==typeof t?t:{stopId:t};Q(this,G).trigger(e)}};k=new WeakMap,G=new WeakMap,x=new WeakMap,C=new WeakMap;var tT=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tN=new WeakMap,tR=class{constructor(t){tt(this,E,void 0),tt(this,j,void 0),tt(this,S,void 0),this.input=t.createGain(),te(this,S,t.destination),te(this,j,(function(t){return tn(this,null,function*(){let e=tN.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tN.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Q(this,S)),te(this,E,t),this)))}get paramNames(){return tT}getParam(t){var e;return null==(e=Q(this,E))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Q(this,E)}ready(){return Q(this,j)}connect(t){Q(this,E)&&(Q(this,E).disconnect(Q(this,S)),Q(this,E).connect(t)),te(this,S,t)}};E=new WeakMap,j=new WeakMap,S=new WeakMap;var tz=class{constructor(t,e){var i,n,s;this.context=t,tt(this,B,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tl(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new t_(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>tn(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>tn(this,null,function*(){var e;let s=tu(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:tb);te(this,B,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=tu(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(Z(X({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return tn(this,null,function*(){return yield Q(this,B),this})}};function tU(){return["MusyngKite","FluidR3_GM"]}function t$(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}B=new WeakMap;var tV=(a=null!=(s=ts())?T(L(s)):{},J(s&&s.__esModule?a:N(a,"default",{value:s,enumerable:!0}),s)),tL=class{constructor(t,e){this.context=t,tt(this,I),tt(this,O,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tV.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new t_(t,this.options);let i=function(t,e){var i;let n=null!=(i=tl(["ogg","m4a"]))?i:"ogg";return(i,s)=>tn(this,null,function*(){for(let a of tH)yield Promise.all(a.samples.map(r=>tn(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tr(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);te(this,O,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return tn(this,null,function*(){return yield Q(this,O),this})}start(t){var e,i;let n="object"==typeof t?X({},t):{note:t},s=ti(this,I,W).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};O=new WeakMap,I=new WeakSet,W=function(t){var e;let i=tu(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tH.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tH[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tH=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[$(i)[0]])((n={exports:{}}).exports,n),n.exports}),ta={};function tr(t,e,i){return tn(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tl(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function to(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tu(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function th(t){return t*t/16129}function tc(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}function tp(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}function td(t){let e=!1;return()=>{e||(e=!0,t.forEach(t=>null==t?void 0:t()))}}((t,e)=>{for(var i in e)N(t,i,{get:e[i],enumerable:!0})})(ta,{CacheStorage:()=>tg,DrumMachine:()=>tF,ElectricPiano:()=>tE,HttpStorage:()=>tb,LAYERS:()=>tH,Mallet:()=>tS,NAME_TO_PATH:()=>tI,Reverb:()=>tR,Sampler:()=>tW,Soundfont:()=>tz,SplendidGrandPiano:()=>tL,getDrumMachineNames:()=>tv,getElectricPianoNames:()=>tx,getMalletNames:()=>tj,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=J(N({},"__esModule",{value:!0}),ta);var tf=class{constructor(t,e){var i,n;this.context=t,tt(this,r,void 0),tt(this,l,void 0),tt(this,o,void 0),tt(this,u,void 0),tt(this,h,void 0),tt(this,c,void 0),te(this,c,X({destination:t.destination,volume:100,volumeToGain:th},e)),this.input=t.createGain(),te(this,r,t.createGain()),te(this,u,to([this.input,Q(this,r),Q(this,c).destination]));let s=tc(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:th;te(this,h,s.subscribe(t=>{Q(this,r).gain.value=a(t)}))}addInsert(t){null!=Q(this,o)||te(this,o,[]),Q(this,o).push(t),Q(this,u).call(this),te(this,u,to([this.input,...Q(this,o),Q(this,r),Q(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=to([Q(this,r),n,s]);null!=Q(this,l)||te(this,l,[]),Q(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Q(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Q(this,u).call(this),Q(this,h).call(this),null==(t=Q(this,l))||t.forEach(t=>t.disconnect()),te(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tm=class{constructor(t,e){var i;this.destination=t,this.options=e,tt(this,p,void 0),this.context=t.context,this.buffers={},te(this,p,tp()),this.velocityToGain=null!=(i=e.velocityToGain)?i:th}start(t){var e,i,n,s,a,r,l,o,u,h;let{destination:c,context:d}=this,f=this.buffers[t.note];if(!f)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let m=d.createBufferSource();m.buffer=f,m.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let y=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,P=y?new BiquadFilterNode(d,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,_=d.createGain(),b=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;_.gain.value=this.velocityToGain(b);let g=null!=(r=t.decayTime)?r:this.options.decayTime,[M,v]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(d,g);function D(t){if(null!=t||(t=d.currentTime),t<=A)m.stop(t);else{let e=v(t);m.stop(e)}}let F=null!=(l=t.stopId)?l:t.note,w=td([to([m,P,_,M,c]),null==(o=t.stop)?void 0:o.call(t,D),Q(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==F||D(null==t?void 0:t.time)})]);m.onended=()=>{var e;w(),null==(e=t.onEnded)||e.call(t,t)};let A=Math.max(null!=(u=t.time)?u:0,d.currentTime);m.start(t.time);let k=null!=(h=t.duration)?h:f.duration;return"number"==typeof t.duration&&D(A+k),D}stop(t){Q(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var ty=class{constructor(t){this.compare=t,tt(this,d,[])}push(t){let e=Q(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Q(this,d)[e])?(s=e,n=e-1):i=e+1}Q(this,d).splice(s,0,t)}pop(){return Q(this,d).shift()}peek(){return Q(this,d)[0]}removeAll(t){let e=Q(this,d).length;return te(this,d,Q(this,d).filter(e=>!t(e))),Q(this,d).length!==e}clear(){te(this,d,[])}size(){return Q(this,d).length}};d=new WeakMap;var tP=class{constructor(t,e){this.destination=t,tt(this,f,void 0),tt(this,m,void 0),te(this,f,new ty((t,e)=>t.time-e.time)),this.player=new tm(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Q(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Q(this,f).push(Z(X({},t),{time:s})),Q(this,m)||te(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Q(this,f).size()&&Q(this,f).peek().time<=t;){let t=Q(this,f).pop();t&&this.player.start(t)}Q(this,f).size()||(clearInterval(Q(this,m)),te(this,m,void 0))},200)),e=>{(!e||e<s)&&Q(this,f).removeAll(e=>e===t)||this.player.stop(Z(X({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Q(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Q(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Q(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var t_=class{constructor(t,e){this.context=t;let i=new tf(t,e);this.player=new tP(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tb={fetch:t=>fetch(t)},tg=class{constructor(t="smplr"){tt(this,P),tt(this,b),tt(this,y,void 0),"undefined"!=typeof window&&"caches"in window?te(this,y,caches.open(t)):te(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return tn(this,null,function*(){let e=new Request(t);try{return yield ti(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield ti(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return tn(this,null,function*(){let e=yield Q(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return tn(this,null,function*(){try{let i=yield Q(this,y);yield i.put(t,e.clone())}catch(t){}})};var tM={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tv(){return Object.keys(tD)}var tD={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tF=class{constructor(t,e){var i,n;tt(this,M,tM),tt(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tb,a=tD[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return tn(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new t_(t,e),this.output=this.player.output,te(this,v,function(t,e,i,n){var s;let a=null!=(s=tl(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>tn(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tr(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{te(this,M,t)})}loaded(){return tn(this,null,function*(){return yield Q(this,v),this})}get sampleNames(){return Q(this,M).sampleNames}getVariations(t){var e;return null!=(e=Q(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Q(this,M).nameToSample[t.note];return this.player.start(Z(X({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tw(t,e){return tn(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tA(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tk=Object.freeze({meta:{},global:{},groups:[]}),tG=class{constructor(t,e){var i;this.context=t,tt(this,w),tt(this,D,void 0),tt(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new t_(t,e),te(this,D,tk);let n=null!=(i=e.storage)?i:tb;te(this,F,(function(t,e){return tn(this,null,function*(){if("string"==typeof t)return tw(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tw(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(te(this,D,Object.freeze(e)),function(t,e,i,n){return tn(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tl(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return tn(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>tn(this,null,function*(){if(e[s])return;let a=yield tr(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Q(this,D),n))))}get output(){return this.player.output}loaded(){return tn(this,null,function*(){return yield Q(this,F),this})}start(t){ti(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tx(){return Object.keys(tC)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tu(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tA(e.midi,n.lokey,n.hikey)&&tA(e.velocity,n.lovel,n.hivel)&&tA(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tA(e.midi,t.lokey,t.hikey)&&tA(e.velocity,t.lovel,t.hivel)&&tA(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Q(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(Z(X({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tC={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tE=class extends tG{constructor(t,e){var i;super(t,Z(X({},e),{instrument:null!=(i=tC[e.instrument])?i:e.instrument}));let n=tc(0);this.tremolo={level:t=>n.set(th(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tj(){return Object.keys(tI)}var tS=class extends tG{constructor(t,e){let i=function(t){if(!tI[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tB+tI[t]+tO}}(e.instrument);super(t,Z(X({},e),{instrument:i}))}},tB="https://danigb.github.io/samples/vcsl/",tO=".websfz.json",tI={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tW=class{constructor(t,e={}){var i,n,s,a,r,l,o;this.context=t,tt(this,k,void 0),tt(this,G,void 0),tt(this,x,void 0),tt(this,C,void 0),te(this,k,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:th,noteToSample:null!=(l=e.noteToSample)?l:t=>[t.note.toString(),0]}),this.buffers={},te(this,G,tp());let u=null!=(o=e.storage)?o:tb,h="function"==typeof Q(this,k).buffers?Q(this,k).buffers:function(t,e){return(i,n)=>tn(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>tn(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tr(i,a,e);t&&(n[s]=t)}}))])})}(Q(this,k).buffers,u);te(this,x,h(t,this.buffers)),te(this,C,new tf(t,Q(this,k))),this.output=Q(this,C)}loaded(){return tn(this,null,function*(){return yield Q(this,x),this})}start(t){var e,i,n;let s="object"==typeof t?t:{note:t},[a,r]=Q(this,k).noteToSample(s,this.buffers,Q(this,k)),l=this.buffers[a];if(!l)return console.warn(`Sample not found: '${a}'`),()=>void 0;let o=s.onEnded;return function(t){var e,i,n;let s=t.destination.context,a=s.createBufferSource();a.buffer=t.buffer,a.detune.value=null!=(e=null==t?void 0:t.detune)?e:0;let r=t.lpfCutoffHz?new BiquadFilterNode(s,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,l=s.createGain();l.gain.value=null!=(i=null==t?void 0:t.gain)?i:1;let[o,u]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(s,t.decayTime),h=td([to([a,r,l,o,t.destination]),null==(n=t.stop)?void 0:n.call(t,e=>{(void 0===e||void 0===e.stopId||e.stopId===t.stopId)&&p(null==e?void 0:e.time)})]);a.onended=()=>{var e;h(),null==(e=t.onEnded)||e.call(t)};let c=t.time||s.currentTime;function p(t){if(null!=t||(t=s.currentTime),t<=c)a.stop(t);else{let e=u(t);a.stop(e)}}return a.start(c),void 0!==t.duration&&p(c+t.duration),p}({buffer:l,destination:Q(this,C).input,time:s.time,duration:s.duration,decayTime:s.decayTime,lpfCutoffHz:s.lpfCutoffHz,detune:r+(null!=(e=s.detune)?e:Q(this,k).detune),gain:Q(this,k).volumeToGain(null!=(i=s.velocity)?i:Q(this,k).velocity),stop:Q(this,G).subscribe,stopId:null!=(n=s.stopId)?n:s.note,onEnded:o?()=>o(t):void 0})}stop(t){let e="object"==typeof t?t:{stopId:t};Q(this,G).trigger(e)}};k=new WeakMap,G=new WeakMap,x=new WeakMap,C=new WeakMap;var tT=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tN=new WeakMap,tR=class{constructor(t){tt(this,E,void 0),tt(this,j,void 0),tt(this,S,void 0),this.input=t.createGain(),te(this,S,t.destination),te(this,j,(function(t){return tn(this,null,function*(){let e=tN.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tN.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Q(this,S)),te(this,E,t),this)))}get paramNames(){return tT}getParam(t){var e;return null==(e=Q(this,E))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Q(this,E)}ready(){return Q(this,j)}connect(t){Q(this,E)&&(Q(this,E).disconnect(Q(this,S)),Q(this,E).connect(t)),te(this,S,t)}};E=new WeakMap,j=new WeakMap,S=new WeakMap;var tz=class{constructor(t,e){var i,n,s;this.context=t,tt(this,B,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tl(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new t_(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>tn(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>tn(this,null,function*(){var e;let s=tu(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:tb);te(this,B,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=tu(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(Z(X({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return tn(this,null,function*(){return yield Q(this,B),this})}};function tU(){return["MusyngKite","FluidR3_GM"]}function t$(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}B=new WeakMap;var tV=(a=null!=(s=ts())?T(L(s)):{},J(s&&s.__esModule?a:N(a,"default",{value:s,enumerable:!0}),s)),tL=class{constructor(t,e){this.context=t,tt(this,I),tt(this,O,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tV.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.1},e),this.player=new t_(t,this.options);let i=function(t,e){var i;let n=null!=(i=tl(["ogg","m4a"]))?i:"ogg";return(i,s)=>tn(this,null,function*(){for(let a of tH)yield Promise.all(a.samples.map(r=>tn(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tr(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);te(this,O,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return tn(this,null,function*(){return yield Q(this,O),this})}start(t){var e,i;let n="object"==typeof t?X({},t):{note:t},s=ti(this,I,W).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};O=new WeakMap,I=new WeakSet,W=function(t){var e;let i=tu(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tH.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tH[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tH=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[z(i)[0]])((n={exports:{}}).exports,n),n.exports}),tn={};function ts(t,e,i){return te(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function ta(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tr(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tl(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function to(t){return t*t/16129}function tu(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)W(t,i,{get:e[i],enumerable:!0})})(tn,{CacheStorage:()=>ty,DrumMachine:()=>tg,ElectricPiano:()=>tk,HttpStorage:()=>tm,LAYERS:()=>tU,Mallet:()=>tx,NAME_TO_PATH:()=>tj,Reverb:()=>tI,Sampler:()=>tS,Soundfont:()=>tW,SplendidGrandPiano:()=>tz,getDrumMachineNames:()=>t_,getElectricPianoNames:()=>tw,getMalletNames:()=>tG,getSoundfontKits:()=>tT,getSoundfontNames:()=>tN}),e.exports=X(W({},"__esModule",{value:!0}),tn);var th=class{constructor(t,e){var i,n;this.context=t,Y(this,r,void 0),Y(this,l,void 0),Y(this,o,void 0),Y(this,u,void 0),Y(this,h,void 0),Y(this,c,void 0),Q(this,c,q({destination:t.destination,volume:100,volumeToGain:to},e)),this.input=t.createGain(),Q(this,r,t.createGain()),Q(this,u,tr([this.input,J(this,r),J(this,c).destination]));let s=tu(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:to;Q(this,h,s.subscribe(t=>{J(this,r).gain.value=a(t)}))}addInsert(t){null!=J(this,o)||Q(this,o,[]),J(this,o).push(t),J(this,u).call(this),Q(this,u,tr([this.input,...J(this,o),J(this,r),J(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tr([J(this,r),n,s]);null!=J(this,l)||Q(this,l,[]),J(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=J(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;J(this,u).call(this),J(this,h).call(this),null==(t=J(this,l))||t.forEach(t=>t.disconnect()),Q(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tc=class{constructor(t,e){var i;this.destination=t,this.options=e,Y(this,p,void 0),this.context=t.context,this.buffers={},Q(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:to}start(t){var e,i,n,s,a,r,l,o,u,h,c;let d;let{destination:f,context:m}=this,y=this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let P=m.createBufferSource();P.buffer=y,P.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let _=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,b=_?new BiquadFilterNode(m,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,g=m.createGain(),M=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;g.gain.value=this.velocityToGain(M);let v=null!=(r=t.decayTime)?r:this.options.decayTime,[D,F]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(m,v);function w(t){if(null!=t||(t=m.currentTime),t<=G)P.stop(t);else{let e=F(t);P.stop(e)}}let A=null!=(l=t.stopId)?l:t.note,k=(c=[tr([P,b,g,D,f]),null==(o=t.stop)?void 0:o.call(t,w),J(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==A||w(null==t?void 0:t.time)})],d=!1,()=>{d||(d=!0,c.forEach(t=>null==t?void 0:t()))});P.onended=()=>{var e;k(),null==(e=t.onEnded)||e.call(t,t)};let G=Math.max(null!=(u=t.time)?u:0,m.currentTime);P.start(t.time);let x=null!=(h=t.duration)?h:y.duration;return"number"==typeof t.duration&&w(G+x),w}stop(t){J(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var tp=class{constructor(t){this.compare=t,Y(this,d,[])}push(t){let e=J(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,J(this,d)[e])?(s=e,n=e-1):i=e+1}J(this,d).splice(s,0,t)}pop(){return J(this,d).shift()}peek(){return J(this,d)[0]}removeAll(t){let e=J(this,d).length;return Q(this,d,J(this,d).filter(e=>!t(e))),J(this,d).length!==e}clear(){Q(this,d,[])}size(){return J(this,d).length}};d=new WeakMap;var td=class{constructor(t,e){this.destination=t,Y(this,f,void 0),Y(this,m,void 0),Q(this,f,new tp((t,e)=>t.time-e.time)),this.player=new tc(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==J(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(J(this,f).push(K(q({},t),{time:s})),J(this,m)||Q(this,m,setInterval(()=>{let t=i.currentTime+1;for(;J(this,f).size()&&J(this,f).peek().time<=t;){let t=J(this,f).pop();t&&this.player.start(t)}J(this,f).size()||(clearInterval(J(this,m)),Q(this,m,void 0))},200)),e=>{(!e||e<s)&&J(this,f).removeAll(e=>e===t)||this.player.stop(K(q({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){J(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?J(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):J(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tf=class{constructor(t,e){this.context=t;let i=new th(t,e);this.player=new td(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tm={fetch:t=>fetch(t)},ty=class{constructor(t="smplr"){Y(this,P),Y(this,b),Y(this,y,void 0),"undefined"!=typeof window&&"caches"in window?Q(this,y,caches.open(t)):Q(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return te(this,null,function*(){let e=new Request(t);try{return yield tt(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield tt(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return te(this,null,function*(){let e=yield J(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return te(this,null,function*(){try{let i=yield J(this,y);yield i.put(t,e.clone())}catch(t){}})};var tP={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function t_(){return Object.keys(tb)}var tb={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tg=class{constructor(t,e){var i,n;Y(this,M,tP),Y(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tm,a=tb[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return te(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tf(t,e),this.output=this.player.output,Q(this,v,function(t,e,i,n){var s;let a=null!=(s=ta(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>te(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ts(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{Q(this,M,t)})}loaded(){return te(this,null,function*(){return yield J(this,v),this})}get sampleNames(){return J(this,M).sampleNames}getVariations(t){var e;return null!=(e=J(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=J(this,M).nameToSample[t.note];return this.player.start(K(q({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tM(t,e){return te(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tv(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tD=Object.freeze({meta:{},global:{},groups:[]}),tF=class{constructor(t,e){var i;this.context=t,Y(this,w),Y(this,D,void 0),Y(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tf(t,e),Q(this,D,tD);let n=null!=(i=e.storage)?i:tm;Q(this,F,(function(t,e){return te(this,null,function*(){if("string"==typeof t)return tM(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tM(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(Q(this,D,Object.freeze(e)),function(t,e,i,n){return te(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=ta(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return te(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>te(this,null,function*(){if(e[s])return;let a=yield ts(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,J(this,D),n))))}get output(){return this.player.output}loaded(){return te(this,null,function*(){return yield J(this,F),this})}start(t){tt(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tw(){return Object.keys(tA)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tl(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tv(e.midi,n.lokey,n.hikey)&&tv(e.velocity,n.lovel,n.hivel)&&tv(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tv(e.midi,t.lokey,t.hikey)&&tv(e.velocity,t.lovel,t.hivel)&&tv(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(J(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(K(q({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tA={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tk=class extends tF{constructor(t,e){var i;super(t,K(q({},e),{instrument:null!=(i=tA[e.instrument])?i:e.instrument}));let n=tu(0);this.tremolo={level:t=>n.set(to(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tG(){return Object.keys(tj)}var tx=class extends tF{constructor(t,e){let i=function(t){if(!tj[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tC+tj[t]+tE}}(e.instrument);super(t,K(q({},e),{instrument:i}))}},tC="https://danigb.github.io/samples/vcsl/",tE=".websfz.json",tj={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tS=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Y(this,k,void 0),Y(this,G,void 0),Q(this,k,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:to}),this.player=new tf(t,J(this,k));let o=null!=(l=e.storage)?l:tm,u="function"==typeof J(this,k).buffers?J(this,k).buffers:function(t,e){return(i,n)=>te(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>te(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ts(i,a,e);t&&(n[s]=t)}}))])})}(J(this,k).buffers,o);Q(this,G,u(t,this.player.buffers))}loaded(){return te(this,null,function*(){return yield J(this,G),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};k=new WeakMap,G=new WeakMap;var tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Y(this,x,void 0),Y(this,C,void 0),Y(this,E,void 0),this.input=t.createGain(),Q(this,E,t.destination),Q(this,C,(function(t){return te(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(J(this,E)),Q(this,x,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=J(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==J(this,x)}ready(){return J(this,C)}connect(t){J(this,x)&&(J(this,x).disconnect(J(this,E)),J(this,x).connect(t)),Q(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tW=class{constructor(t,e){var i,n,s;this.context=t,Y(this,j,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=ta(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tf(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>te(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>te(this,null,function*(){var e;let s=tl(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:tm);Q(this,j,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=tl(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(K(q({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return te(this,null,function*(){return yield J(this,j),this})}};function tT(){return["MusyngKite","FluidR3_GM"]}function tN(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap;var tR=(a=null!=(s=ti())?I($(s)):{},X(s&&s.__esModule?a:W(a,"default",{value:s,enumerable:!0}),s)),tz=class{constructor(t,e){this.context=t,Y(this,B),Y(this,S,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tR.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tf(t,this.options);let i=function(t,e){var i;let n=null!=(i=ta(["ogg","m4a"]))?i:"ogg";return(i,s)=>te(this,null,function*(){for(let a of tU)yield Promise.all(a.samples.map(r=>te(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ts(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);Q(this,S,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return te(this,null,function*(){return yield J(this,S),this})}start(t){var e,i;let n="object"==typeof t?q({},t):{note:t},s=tt(this,B,O).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};S=new WeakMap,B=new WeakSet,O=function(t){var e;let i=tl(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tU.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tU[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tU=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[z(i)[0]])((n={exports:{}}).exports,n),n.exports}),tn={};function ts(t,e,i){return te(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function ta(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tr(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tl(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function to(t){return t*t/16129}function tu(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)W(t,i,{get:e[i],enumerable:!0})})(tn,{CacheStorage:()=>ty,DrumMachine:()=>tg,ElectricPiano:()=>tk,HttpStorage:()=>tm,LAYERS:()=>tU,Mallet:()=>tx,NAME_TO_PATH:()=>tj,Reverb:()=>tI,Sampler:()=>tS,Soundfont:()=>tW,SplendidGrandPiano:()=>tz,getDrumMachineNames:()=>t_,getElectricPianoNames:()=>tw,getMalletNames:()=>tG,getSoundfontKits:()=>tT,getSoundfontNames:()=>tN}),e.exports=X(W({},"__esModule",{value:!0}),tn);var th=class{constructor(t,e){var i,n;this.context=t,Y(this,r,void 0),Y(this,l,void 0),Y(this,o,void 0),Y(this,u,void 0),Y(this,h,void 0),Y(this,c,void 0),Q(this,c,q({destination:t.destination,volume:100,volumeToGain:to},e)),this.input=t.createGain(),Q(this,r,t.createGain()),Q(this,u,tr([this.input,J(this,r),J(this,c).destination]));let s=tu(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:to;Q(this,h,s.subscribe(t=>{J(this,r).gain.value=a(t)}))}addInsert(t){null!=J(this,o)||Q(this,o,[]),J(this,o).push(t),J(this,u).call(this),Q(this,u,tr([this.input,...J(this,o),J(this,r),J(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tr([J(this,r),n,s]);null!=J(this,l)||Q(this,l,[]),J(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=J(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;J(this,u).call(this),J(this,h).call(this),null==(t=J(this,l))||t.forEach(t=>t.disconnect()),Q(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tc=class{constructor(t,e){var i;this.destination=t,this.options=e,Y(this,p,void 0),this.context=t.context,this.buffers={},Q(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:to}start(t){var e,i,n,s,a,r,l,o,u,h,c;let d;let{destination:f,context:m}=this,y=this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let P=m.createBufferSource();P.buffer=y,P.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let _=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,b=_?new BiquadFilterNode(m,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,g=m.createGain(),M=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;g.gain.value=this.velocityToGain(M);let v=null!=(r=t.decayTime)?r:this.options.decayTime,[D,F]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(m,v);function w(t){if(null!=t||(t=m.currentTime),t<=G)P.stop(t);else{let e=F(t);P.stop(e)}}let A=null!=(l=t.stopId)?l:t.note,k=(c=[tr([P,b,g,D,f]),null==(o=t.stop)?void 0:o.call(t,w),J(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==A||w(null==t?void 0:t.time)})],d=!1,()=>{d||(d=!0,c.forEach(t=>null==t?void 0:t()))});P.onended=()=>{var e;k(),null==(e=t.onEnded)||e.call(t,t)};let G=Math.max(null!=(u=t.time)?u:0,m.currentTime);P.start(t.time);let x=null!=(h=t.duration)?h:y.duration;return"number"==typeof t.duration&&w(G+x),w}stop(t){J(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var tp=class{constructor(t){this.compare=t,Y(this,d,[])}push(t){let e=J(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,J(this,d)[e])?(s=e,n=e-1):i=e+1}J(this,d).splice(s,0,t)}pop(){return J(this,d).shift()}peek(){return J(this,d)[0]}removeAll(t){let e=J(this,d).length;return Q(this,d,J(this,d).filter(e=>!t(e))),J(this,d).length!==e}clear(){Q(this,d,[])}size(){return J(this,d).length}};d=new WeakMap;var td=class{constructor(t,e){this.destination=t,Y(this,f,void 0),Y(this,m,void 0),Q(this,f,new tp((t,e)=>t.time-e.time)),this.player=new tc(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==J(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(J(this,f).push(K(q({},t),{time:s})),J(this,m)||Q(this,m,setInterval(()=>{let t=i.currentTime+1;for(;J(this,f).size()&&J(this,f).peek().time<=t;){let t=J(this,f).pop();t&&this.player.start(t)}J(this,f).size()||(clearInterval(J(this,m)),Q(this,m,void 0))},200)),e=>{(!e||e<s)&&J(this,f).removeAll(e=>e===t)||this.player.stop(K(q({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){J(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?J(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):J(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tf=class{constructor(t,e){this.context=t;let i=new th(t,e);this.player=new td(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tm={fetch:t=>fetch(t)},ty=class{constructor(t="smplr"){Y(this,P),Y(this,b),Y(this,y,void 0),"undefined"!=typeof window&&"caches"in window?Q(this,y,caches.open(t)):Q(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return te(this,null,function*(){let e=new Request(t);try{return yield tt(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield tt(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return te(this,null,function*(){let e=yield J(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return te(this,null,function*(){try{let i=yield J(this,y);yield i.put(t,e.clone())}catch(t){}})};var tP={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function t_(){return Object.keys(tb)}var tb={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tg=class{constructor(t,e){var i,n;Y(this,M,tP),Y(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tm,a=tb[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return te(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tf(t,e),this.output=this.player.output,Q(this,v,function(t,e,i,n){var s;let a=null!=(s=ta(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>te(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ts(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{Q(this,M,t)})}loaded(){return te(this,null,function*(){return yield J(this,v),this})}get sampleNames(){return J(this,M).sampleNames}getVariations(t){var e;return null!=(e=J(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=J(this,M).nameToSample[t.note];return this.player.start(K(q({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tM(t,e){return te(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tv(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tD=Object.freeze({meta:{},global:{},groups:[]}),tF=class{constructor(t,e){var i;this.context=t,Y(this,w),Y(this,D,void 0),Y(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tf(t,e),Q(this,D,tD);let n=null!=(i=e.storage)?i:tm;Q(this,F,(function(t,e){return te(this,null,function*(){if("string"==typeof t)return tM(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tM(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(Q(this,D,Object.freeze(e)),function(t,e,i,n){return te(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=ta(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return te(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>te(this,null,function*(){if(e[s])return;let a=yield ts(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,J(this,D),n))))}get output(){return this.player.output}loaded(){return te(this,null,function*(){return yield J(this,F),this})}start(t){tt(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tw(){return Object.keys(tA)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tl(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tv(e.midi,n.lokey,n.hikey)&&tv(e.velocity,n.lovel,n.hivel)&&tv(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tv(e.midi,t.lokey,t.hikey)&&tv(e.velocity,t.lovel,t.hivel)&&tv(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(J(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(K(q({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tA={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tk=class extends tF{constructor(t,e){var i;super(t,K(q({},e),{instrument:null!=(i=tA[e.instrument])?i:e.instrument}));let n=tu(0);this.tremolo={level:t=>n.set(to(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tG(){return Object.keys(tj)}var tx=class extends tF{constructor(t,e){let i=function(t){if(!tj[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tC+tj[t]+tE}}(e.instrument);super(t,K(q({},e),{instrument:i}))}},tC="https://danigb.github.io/samples/vcsl/",tE=".websfz.json",tj={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tS=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Y(this,k,void 0),Y(this,G,void 0),Q(this,k,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:to}),this.player=new tf(t,J(this,k));let o=null!=(l=e.storage)?l:tm,u="function"==typeof J(this,k).buffers?J(this,k).buffers:function(t,e){return(i,n)=>te(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>te(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ts(i,a,e);t&&(n[s]=t)}}))])})}(J(this,k).buffers,o);Q(this,G,u(t,this.player.buffers))}loaded(){return te(this,null,function*(){return yield J(this,G),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};k=new WeakMap,G=new WeakMap;var tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Y(this,x,void 0),Y(this,C,void 0),Y(this,E,void 0),this.input=t.createGain(),Q(this,E,t.destination),Q(this,C,(function(t){return te(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(J(this,E)),Q(this,x,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=J(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==J(this,x)}ready(){return J(this,C)}connect(t){J(this,x)&&(J(this,x).disconnect(J(this,E)),J(this,x).connect(t)),Q(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tW=class{constructor(t,e){var i,n,s;this.context=t,Y(this,j,void 0),this.options=Object.freeze(Object.assign({},e));let a=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=ta(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tf(t,e),this.output=this.player.output;let r=function(t,e){return(i,n)=>te(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>te(this,null,function*(){var e;let s=tl(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(a,null!=(n=e.storage)?n:tm);Q(this,j,r(t,this.player.buffers));let l=null!=(s=e.extraGain)?s:5,o=new GainNode(t,{gain:l});this.output.addInsert(o)}start(t){let e=tl(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(K(q({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return te(this,null,function*(){return yield J(this,j),this})}};function tT(){return["MusyngKite","FluidR3_GM"]}function tN(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap;var tR=(a=null!=(s=ti())?I($(s)):{},X(s&&s.__esModule?a:W(a,"default",{value:s,enumerable:!0}),s)),tz=class{constructor(t,e){this.context=t,Y(this,B),Y(this,S,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tR.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tf(t,this.options);let i=function(t,e){var i;let n=null!=(i=ta(["ogg","m4a"]))?i:"ogg";return(i,s)=>te(this,null,function*(){for(let a of tU)yield Promise.all(a.samples.map(r=>te(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ts(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);Q(this,S,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return te(this,null,function*(){return yield J(this,S),this})}start(t){var e,i;let n="object"==typeof t?q({},t):{note:t},s=tt(this,B,O).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};S=new WeakMap,B=new WeakSet,O=function(t){var e;let i=tl(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tU.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tU[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tU=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[z(i)[0]])((n={exports:{}}).exports,n),n.exports}),tn={};function ts(t,e,i){return te(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function ta(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tr(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tl(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function to(t){return t*t/16129}function tu(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)W(t,i,{get:e[i],enumerable:!0})})(tn,{CacheStorage:()=>ty,DrumMachine:()=>tg,ElectricPiano:()=>tk,HttpStorage:()=>tm,LAYERS:()=>tU,Mallet:()=>tx,NAME_TO_PATH:()=>tj,Reverb:()=>tO,Sampler:()=>tI,Soundfont:()=>tW,SplendidGrandPiano:()=>tz,getDrumMachineNames:()=>t_,getElectricPianoNames:()=>tw,getMalletNames:()=>tG,getSoundfontKits:()=>tT,getSoundfontNames:()=>tN}),e.exports=X(W({},"__esModule",{value:!0}),tn);var th=class{constructor(t,e){var i,n;this.context=t,Y(this,r,void 0),Y(this,l,void 0),Y(this,o,void 0),Y(this,u,void 0),Y(this,h,void 0),Y(this,c,void 0),Q(this,c,q({destination:t.destination,volume:100,volumeToGain:to},e)),this.input=t.createGain(),Q(this,r,t.createGain()),Q(this,u,tr([this.input,J(this,r),J(this,c).destination]));let s=tu(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:to;Q(this,h,s.subscribe(t=>{J(this,r).gain.value=a(t)}))}addInsert(t){null!=J(this,o)||Q(this,o,[]),J(this,o).push(t),J(this,u).call(this),Q(this,u,tr([this.input,...J(this,o),J(this,r),J(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tr([J(this,r),n,s]);null!=J(this,l)||Q(this,l,[]),J(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=J(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;J(this,u).call(this),J(this,h).call(this),null==(t=J(this,l))||t.forEach(t=>t.disconnect()),Q(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tc=class{constructor(t,e){var i;this.destination=t,this.options=e,Y(this,p,void 0),this.context=t.context,this.buffers={},Q(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:to}start(t){var e,i,n,s,a,r,l,o,u,h,c;let d;let{destination:f,context:m}=this,y=this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let P=m.createBufferSource();P.buffer=y,P.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let _=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,b=_?new BiquadFilterNode(m,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,g=m.createGain(),M=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;g.gain.value=this.velocityToGain(M);let v=null!=(r=t.decayTime)?r:this.options.decayTime,[D,F]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(m,v);function w(t){if(null!=t||(t=m.currentTime),t<=G)P.stop(t);else{let e=F(t);P.stop(e)}}let A=null!=(l=t.stopId)?l:t.note,k=(c=[tr([P,b,g,D,f]),null==(o=t.stop)?void 0:o.call(t,w),J(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==A||w(null==t?void 0:t.time)})],d=!1,()=>{d||(d=!0,c.forEach(t=>null==t?void 0:t()))});P.onended=()=>{var e;k(),null==(e=t.onEnded)||e.call(t,t)};let G=Math.max(null!=(u=t.time)?u:0,m.currentTime);P.start(t.time);let x=null!=(h=t.duration)?h:y.duration;return"number"==typeof t.duration&&w(G+x),w}stop(t){J(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var tp=class{constructor(t){this.compare=t,Y(this,d,[])}push(t){let e=J(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,J(this,d)[e])?(s=e,n=e-1):i=e+1}J(this,d).splice(s,0,t)}pop(){return J(this,d).shift()}peek(){return J(this,d)[0]}removeAll(t){let e=J(this,d).length;return Q(this,d,J(this,d).filter(e=>!t(e))),J(this,d).length!==e}clear(){Q(this,d,[])}size(){return J(this,d).length}};d=new WeakMap;var td=class{constructor(t,e){this.destination=t,Y(this,f,void 0),Y(this,m,void 0),Q(this,f,new tp((t,e)=>t.time-e.time)),this.player=new tc(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==J(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(J(this,f).push(K(q({},t),{time:s})),J(this,m)||Q(this,m,setInterval(()=>{let t=i.currentTime+1;for(;J(this,f).size()&&J(this,f).peek().time<=t;){let t=J(this,f).pop();t&&this.player.start(t)}J(this,f).size()||(clearInterval(J(this,m)),Q(this,m,void 0))},200)),e=>{(!e||e<s)&&J(this,f).removeAll(e=>e===t)||this.player.stop(K(q({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){J(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?J(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):J(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tf=class{constructor(t,e){this.context=t;let i=new th(t,e);this.player=new td(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tm={fetch:t=>fetch(t)},ty=class{constructor(t="smplr"){Y(this,P),Y(this,b),Y(this,y,void 0),"undefined"!=typeof window&&"caches"in window?Q(this,y,caches.open(t)):Q(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return te(this,null,function*(){let e=new Request(t);try{return yield tt(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield tt(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return te(this,null,function*(){let e=yield J(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return te(this,null,function*(){try{let i=yield J(this,y);yield i.put(t,e.clone())}catch(t){}})};var tP={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function t_(){return Object.keys(tb)}var tb={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tg=class{constructor(t,e){var i,n;Y(this,M,tP),Y(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tm,a=tb[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return te(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tf(t,e),this.output=this.player.output,Q(this,v,function(t,e,i,n){var s;let a=null!=(s=ta(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>te(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ts(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{Q(this,M,t)})}loaded(){return te(this,null,function*(){return yield J(this,v),this})}get sampleNames(){return J(this,M).sampleNames}getVariations(t){var e;return null!=(e=J(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=J(this,M).nameToSample[t.note];return this.player.start(K(q({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tM(t,e){return te(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tv(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tD=Object.freeze({meta:{},global:{},groups:[]}),tF=class{constructor(t,e){var i;this.context=t,Y(this,w),Y(this,D,void 0),Y(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tf(t,e),Q(this,D,tD);let n=null!=(i=e.storage)?i:tm;Q(this,F,(function(t,e){return te(this,null,function*(){if("string"==typeof t)return tM(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tM(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(Q(this,D,Object.freeze(e)),function(t,e,i,n){return te(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=ta(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return te(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>te(this,null,function*(){if(e[s])return;let a=yield ts(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,J(this,D),n))))}get output(){return this.player.output}loaded(){return te(this,null,function*(){return yield J(this,F),this})}start(t){tt(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tw(){return Object.keys(tA)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tl(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tv(e.midi,n.lokey,n.hikey)&&tv(e.velocity,n.lovel,n.hivel)&&tv(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tv(e.midi,t.lokey,t.hikey)&&tv(e.velocity,t.lovel,t.hivel)&&tv(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(J(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(K(q({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tA={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tk=class extends tF{constructor(t,e){var i;super(t,K(q({},e),{instrument:null!=(i=tA[e.instrument])?i:e.instrument}));let n=tu(0);this.tremolo={level:t=>n.set(to(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tG(){return Object.keys(tj)}var tx=class extends tF{constructor(t,e){let i=function(t){if(!tj[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tC+tj[t]+tE}}(e.instrument);super(t,K(q({},e),{instrument:i}))}},tC="https://danigb.github.io/samples/vcsl/",tE=".websfz.json",tj={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tS=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tB=new WeakMap,tO=class{constructor(t){Y(this,k,void 0),Y(this,G,void 0),Y(this,x,void 0),this.input=t.createGain(),Q(this,x,t.destination),Q(this,G,(function(t){return te(this,null,function*(){let e=tB.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tB.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(J(this,x)),Q(this,k,t),this)))}get paramNames(){return tS}getParam(t){var e;return null==(e=J(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==J(this,k)}ready(){return J(this,G)}connect(t){J(this,k)&&(J(this,k).disconnect(J(this,x)),J(this,k).connect(t)),Q(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tI=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Y(this,C,void 0),Y(this,E,void 0),Q(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:to}),this.player=new tf(t,J(this,C));let o=null!=(l=e.storage)?l:tm,u="function"==typeof J(this,C).buffers?J(this,C).buffers:function(t,e){return(i,n)=>te(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>te(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ts(i,a,e);t&&(n[s]=t)}}))])})}(J(this,C).buffers,o);Q(this,E,u(t,this.player.buffers))}loaded(){return te(this,null,function*(){return yield J(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tW=class{constructor(t,e){var i,n,s,a;this.context=t,Y(this,j,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=ta(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tf(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>te(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>te(this,null,function*(){var e;let s=tl(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:tm);Q(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),function(t,e){te(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)throw Error(`Failed to fetch soundfont loops. Response with status ${t.status}`);let e=yield t.json();return console.log(e),e}catch(t){throw Error(`Failed to fetch soundfont loops: ${t}`)}})}(null!=(a=e.kit)?a:"MusyngKite",e.instrument)}start(t){let e=tl(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(K(q({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return te(this,null,function*(){return yield J(this,j),this})}};function tT(){return["MusyngKite","FluidR3_GM"]}function tN(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap;var tR=(a=null!=(s=ti())?I($(s)):{},X(s&&s.__esModule?a:W(a,"default",{value:s,enumerable:!0}),s)),tz=class{constructor(t,e){this.context=t,Y(this,B),Y(this,S,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tR.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tf(t,this.options);let i=function(t,e){var i;let n=null!=(i=ta(["ogg","m4a"]))?i:"ogg";return(i,s)=>te(this,null,function*(){for(let a of tU)yield Promise.all(a.samples.map(r=>te(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ts(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);Q(this,S,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return te(this,null,function*(){return yield J(this,S),this})}start(t){var e,i;let n="object"==typeof t?q({},t):{note:t},s=tt(this,B,O).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};S=new WeakMap,B=new WeakSet,O=function(t){var e;let i=tl(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tU.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tU[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tU=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[z(i)[0]])((n={exports:{}}).exports,n),n.exports}),tn={};function ts(t,e,i){return te(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function ta(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tr(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tl(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function to(t){return t*t/16129}function tu(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)W(t,i,{get:e[i],enumerable:!0})})(tn,{CacheStorage:()=>ty,DrumMachine:()=>tg,ElectricPiano:()=>tk,HttpStorage:()=>tm,LAYERS:()=>tU,Mallet:()=>tx,NAME_TO_PATH:()=>tj,Reverb:()=>tO,Sampler:()=>tI,Soundfont:()=>tW,SplendidGrandPiano:()=>tz,getDrumMachineNames:()=>t_,getElectricPianoNames:()=>tw,getMalletNames:()=>tG,getSoundfontKits:()=>tT,getSoundfontNames:()=>tN}),e.exports=X(W({},"__esModule",{value:!0}),tn);var th=class{constructor(t,e){var i,n;this.context=t,Y(this,r,void 0),Y(this,l,void 0),Y(this,o,void 0),Y(this,u,void 0),Y(this,h,void 0),Y(this,c,void 0),Q(this,c,q({destination:t.destination,volume:100,volumeToGain:to},e)),this.input=t.createGain(),Q(this,r,t.createGain()),Q(this,u,tr([this.input,J(this,r),J(this,c).destination]));let s=tu(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:to;Q(this,h,s.subscribe(t=>{J(this,r).gain.value=a(t)}))}addInsert(t){null!=J(this,o)||Q(this,o,[]),J(this,o).push(t),J(this,u).call(this),Q(this,u,tr([this.input,...J(this,o),J(this,r),J(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tr([J(this,r),n,s]);null!=J(this,l)||Q(this,l,[]),J(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=J(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;J(this,u).call(this),J(this,h).call(this),null==(t=J(this,l))||t.forEach(t=>t.disconnect()),Q(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tc=class{constructor(t,e){var i;this.destination=t,this.options=e,Y(this,p,void 0),this.context=t.context,this.buffers={},Q(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:to}start(t){var e,i,n,s,a,r,l,o,u,h,c;let d;let{destination:f,context:m}=this,y=this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let P=m.createBufferSource();P.buffer=y,P.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let _=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,b=_?new BiquadFilterNode(m,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,g=m.createGain(),M=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;g.gain.value=this.velocityToGain(M);let v=null!=(r=t.decayTime)?r:this.options.decayTime,[D,F]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(m,v);function w(t){if(null!=t||(t=m.currentTime),t<=G)P.stop(t);else{let e=F(t);P.stop(e)}}let A=null!=(l=t.stopId)?l:t.note,k=(c=[tr([P,b,g,D,f]),null==(o=t.stop)?void 0:o.call(t,w),J(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==A||w(null==t?void 0:t.time)})],d=!1,()=>{d||(d=!0,c.forEach(t=>null==t?void 0:t()))});P.onended=()=>{var e;k(),null==(e=t.onEnded)||e.call(t,t)};let G=Math.max(null!=(u=t.time)?u:0,m.currentTime);P.start(t.time);let x=null!=(h=t.duration)?h:y.duration;return"number"==typeof t.duration&&w(G+x),w}stop(t){J(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var tp=class{constructor(t){this.compare=t,Y(this,d,[])}push(t){let e=J(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,J(this,d)[e])?(s=e,n=e-1):i=e+1}J(this,d).splice(s,0,t)}pop(){return J(this,d).shift()}peek(){return J(this,d)[0]}removeAll(t){let e=J(this,d).length;return Q(this,d,J(this,d).filter(e=>!t(e))),J(this,d).length!==e}clear(){Q(this,d,[])}size(){return J(this,d).length}};d=new WeakMap;var td=class{constructor(t,e){this.destination=t,Y(this,f,void 0),Y(this,m,void 0),Q(this,f,new tp((t,e)=>t.time-e.time)),this.player=new tc(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==J(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(J(this,f).push(K(q({},t),{time:s})),J(this,m)||Q(this,m,setInterval(()=>{let t=i.currentTime+1;for(;J(this,f).size()&&J(this,f).peek().time<=t;){let t=J(this,f).pop();t&&this.player.start(t)}J(this,f).size()||(clearInterval(J(this,m)),Q(this,m,void 0))},200)),e=>{(!e||e<s)&&J(this,f).removeAll(e=>e===t)||this.player.stop(K(q({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){J(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?J(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):J(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tf=class{constructor(t,e){this.context=t;let i=new th(t,e);this.player=new td(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tm={fetch:t=>fetch(t)},ty=class{constructor(t="smplr"){Y(this,P),Y(this,b),Y(this,y,void 0),"undefined"!=typeof window&&"caches"in window?Q(this,y,caches.open(t)):Q(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return te(this,null,function*(){let e=new Request(t);try{return yield tt(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield tt(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return te(this,null,function*(){let e=yield J(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return te(this,null,function*(){try{let i=yield J(this,y);yield i.put(t,e.clone())}catch(t){}})};var tP={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function t_(){return Object.keys(tb)}var tb={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tg=class{constructor(t,e){var i,n;Y(this,M,tP),Y(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tm,a=tb[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return te(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tf(t,e),this.output=this.player.output,Q(this,v,function(t,e,i,n){var s;let a=null!=(s=ta(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>te(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ts(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{Q(this,M,t)})}loaded(){return te(this,null,function*(){return yield J(this,v),this})}get sampleNames(){return J(this,M).sampleNames}getVariations(t){var e;return null!=(e=J(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=J(this,M).nameToSample[t.note];return this.player.start(K(q({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tM(t,e){return te(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tv(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tD=Object.freeze({meta:{},global:{},groups:[]}),tF=class{constructor(t,e){var i;this.context=t,Y(this,w),Y(this,D,void 0),Y(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tf(t,e),Q(this,D,tD);let n=null!=(i=e.storage)?i:tm;Q(this,F,(function(t,e){return te(this,null,function*(){if("string"==typeof t)return tM(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tM(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(Q(this,D,Object.freeze(e)),function(t,e,i,n){return te(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=ta(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return te(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>te(this,null,function*(){if(e[s])return;let a=yield ts(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,J(this,D),n))))}get output(){return this.player.output}loaded(){return te(this,null,function*(){return yield J(this,F),this})}start(t){tt(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tw(){return Object.keys(tA)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tl(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tv(e.midi,n.lokey,n.hikey)&&tv(e.velocity,n.lovel,n.hivel)&&tv(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tv(e.midi,t.lokey,t.hikey)&&tv(e.velocity,t.lovel,t.hivel)&&tv(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(J(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(K(q({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tA={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tk=class extends tF{constructor(t,e){var i;super(t,K(q({},e),{instrument:null!=(i=tA[e.instrument])?i:e.instrument}));let n=tu(0);this.tremolo={level:t=>n.set(to(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tG(){return Object.keys(tj)}var tx=class extends tF{constructor(t,e){let i=function(t){if(!tj[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tC+tj[t]+tE}}(e.instrument);super(t,K(q({},e),{instrument:i}))}},tC="https://danigb.github.io/samples/vcsl/",tE=".websfz.json",tj={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tS=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tB=new WeakMap,tO=class{constructor(t){Y(this,k,void 0),Y(this,G,void 0),Y(this,x,void 0),this.input=t.createGain(),Q(this,x,t.destination),Q(this,G,(function(t){return te(this,null,function*(){let e=tB.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tB.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(J(this,x)),Q(this,k,t),this)))}get paramNames(){return tS}getParam(t){var e;return null==(e=J(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==J(this,k)}ready(){return J(this,G)}connect(t){J(this,k)&&(J(this,k).disconnect(J(this,x)),J(this,k).connect(t)),Q(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tI=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Y(this,C,void 0),Y(this,E,void 0),Q(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:to}),this.player=new tf(t,J(this,C));let o=null!=(l=e.storage)?l:tm,u="function"==typeof J(this,C).buffers?J(this,C).buffers:function(t,e){return(i,n)=>te(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>te(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ts(i,a,e);t&&(n[s]=t)}}))])})}(J(this,C).buffers,o);Q(this,E,u(t,this.player.buffers))}loaded(){return te(this,null,function*(){return yield J(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tW=class{constructor(t,e){var i,n,s,a;this.context=t,Y(this,j,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=ta(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tf(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>te(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>te(this,null,function*(){var e;let s=tl(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:tm);Q(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),function(t,e){te(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)throw Error(`Failed to fetch soundfont loops. Response with status ${t.status}`);let e=yield t.json();return console.log({loopData:e}),e}catch(t){throw Error(`Failed to fetch soundfont loops: ${t}`)}})}(null!=(a=e.kit)?a:"MusyngKite",e.instrument)}start(t){let e=tl(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(K(q({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return te(this,null,function*(){return yield J(this,j),this})}};function tT(){return["MusyngKite","FluidR3_GM"]}function tN(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap;var tR=(a=null!=(s=ti())?I($(s)):{},X(s&&s.__esModule?a:W(a,"default",{value:s,enumerable:!0}),s)),tz=class{constructor(t,e){this.context=t,Y(this,B),Y(this,S,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tR.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tf(t,this.options);let i=function(t,e){var i;let n=null!=(i=ta(["ogg","m4a"]))?i:"ogg";return(i,s)=>te(this,null,function*(){for(let a of tU)yield Promise.all(a.samples.map(r=>te(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ts(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);Q(this,S,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return te(this,null,function*(){return yield J(this,S),this})}start(t){var e,i;let n="object"==typeof t?q({},t):{note:t},s=tt(this,B,O).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};S=new WeakMap,B=new WeakSet,O=function(t){var e;let i=tl(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tU.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tU[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tU=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[z(i)[0]])((n={exports:{}}).exports,n),n.exports}),tn={};function ts(t,e,i){return te(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function ta(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tr(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tl(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function to(t){return t*t/16129}function tu(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)W(t,i,{get:e[i],enumerable:!0})})(tn,{CacheStorage:()=>ty,DrumMachine:()=>tg,ElectricPiano:()=>tk,HttpStorage:()=>tm,LAYERS:()=>tU,Mallet:()=>tx,NAME_TO_PATH:()=>tj,Reverb:()=>tO,Sampler:()=>tI,Soundfont:()=>tW,SplendidGrandPiano:()=>tz,getDrumMachineNames:()=>t_,getElectricPianoNames:()=>tw,getMalletNames:()=>tG,getSoundfontKits:()=>tT,getSoundfontNames:()=>tN}),e.exports=X(W({},"__esModule",{value:!0}),tn);var th=class{constructor(t,e){var i,n;this.context=t,Y(this,r,void 0),Y(this,l,void 0),Y(this,o,void 0),Y(this,u,void 0),Y(this,h,void 0),Y(this,c,void 0),Q(this,c,q({destination:t.destination,volume:100,volumeToGain:to},e)),this.input=t.createGain(),Q(this,r,t.createGain()),Q(this,u,tr([this.input,J(this,r),J(this,c).destination]));let s=tu(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:to;Q(this,h,s.subscribe(t=>{J(this,r).gain.value=a(t)}))}addInsert(t){null!=J(this,o)||Q(this,o,[]),J(this,o).push(t),J(this,u).call(this),Q(this,u,tr([this.input,...J(this,o),J(this,r),J(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tr([J(this,r),n,s]);null!=J(this,l)||Q(this,l,[]),J(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=J(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;J(this,u).call(this),J(this,h).call(this),null==(t=J(this,l))||t.forEach(t=>t.disconnect()),Q(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tc=class{constructor(t,e){var i;this.destination=t,this.options=e,Y(this,p,void 0),this.context=t.context,this.buffers={},Q(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:to}start(t){var e,i,n,s,a,r,l,o,u,h,c;let d;let{destination:f,context:m}=this,y=this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let P=m.createBufferSource();P.buffer=y,P.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let _=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,b=_?new BiquadFilterNode(m,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,g=m.createGain(),M=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;g.gain.value=this.velocityToGain(M);let v=null!=(r=t.decayTime)?r:this.options.decayTime,[D,F]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(m,v);function w(t){if(null!=t||(t=m.currentTime),t<=G)P.stop(t);else{let e=F(t);P.stop(e)}}let A=null!=(l=t.stopId)?l:t.note,k=(c=[tr([P,b,g,D,f]),null==(o=t.stop)?void 0:o.call(t,w),J(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==A||w(null==t?void 0:t.time)})],d=!1,()=>{d||(d=!0,c.forEach(t=>null==t?void 0:t()))});P.onended=()=>{var e;k(),null==(e=t.onEnded)||e.call(t,t)};let G=Math.max(null!=(u=t.time)?u:0,m.currentTime);P.start(t.time);let x=null!=(h=t.duration)?h:y.duration;return"number"==typeof t.duration&&w(G+x),w}stop(t){J(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var tp=class{constructor(t){this.compare=t,Y(this,d,[])}push(t){let e=J(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,J(this,d)[e])?(s=e,n=e-1):i=e+1}J(this,d).splice(s,0,t)}pop(){return J(this,d).shift()}peek(){return J(this,d)[0]}removeAll(t){let e=J(this,d).length;return Q(this,d,J(this,d).filter(e=>!t(e))),J(this,d).length!==e}clear(){Q(this,d,[])}size(){return J(this,d).length}};d=new WeakMap;var td=class{constructor(t,e){this.destination=t,Y(this,f,void 0),Y(this,m,void 0),Q(this,f,new tp((t,e)=>t.time-e.time)),this.player=new tc(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==J(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(J(this,f).push(K(q({},t),{time:s})),J(this,m)||Q(this,m,setInterval(()=>{let t=i.currentTime+1;for(;J(this,f).size()&&J(this,f).peek().time<=t;){let t=J(this,f).pop();t&&this.player.start(t)}J(this,f).size()||(clearInterval(J(this,m)),Q(this,m,void 0))},200)),e=>{(!e||e<s)&&J(this,f).removeAll(e=>e===t)||this.player.stop(K(q({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){J(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?J(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):J(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tf=class{constructor(t,e){this.context=t;let i=new th(t,e);this.player=new td(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tm={fetch:t=>fetch(t)},ty=class{constructor(t="smplr"){Y(this,P),Y(this,b),Y(this,y,void 0),"undefined"!=typeof window&&"caches"in window?Q(this,y,caches.open(t)):Q(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return te(this,null,function*(){let e=new Request(t);try{return yield tt(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield tt(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return te(this,null,function*(){let e=yield J(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return te(this,null,function*(){try{let i=yield J(this,y);yield i.put(t,e.clone())}catch(t){}})};var tP={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function t_(){return Object.keys(tb)}var tb={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tg=class{constructor(t,e){var i,n;Y(this,M,tP),Y(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tm,a=tb[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return te(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tf(t,e),this.output=this.player.output,Q(this,v,function(t,e,i,n){var s;let a=null!=(s=ta(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>te(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ts(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{Q(this,M,t)})}loaded(){return te(this,null,function*(){return yield J(this,v),this})}get sampleNames(){return J(this,M).sampleNames}getVariations(t){var e;return null!=(e=J(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=J(this,M).nameToSample[t.note];return this.player.start(K(q({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tM(t,e){return te(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tv(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tD=Object.freeze({meta:{},global:{},groups:[]}),tF=class{constructor(t,e){var i;this.context=t,Y(this,w),Y(this,D,void 0),Y(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tf(t,e),Q(this,D,tD);let n=null!=(i=e.storage)?i:tm;Q(this,F,(function(t,e){return te(this,null,function*(){if("string"==typeof t)return tM(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tM(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(Q(this,D,Object.freeze(e)),function(t,e,i,n){return te(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=ta(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return te(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>te(this,null,function*(){if(e[s])return;let a=yield ts(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,J(this,D),n))))}get output(){return this.player.output}loaded(){return te(this,null,function*(){return yield J(this,F),this})}start(t){tt(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tw(){return Object.keys(tA)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=tl(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tv(e.midi,n.lokey,n.hikey)&&tv(e.velocity,n.lovel,n.hivel)&&tv(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tv(e.midi,t.lokey,t.hikey)&&tv(e.velocity,t.lovel,t.hivel)&&tv(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(J(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(K(q({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tA={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tk=class extends tF{constructor(t,e){var i;super(t,K(q({},e),{instrument:null!=(i=tA[e.instrument])?i:e.instrument}));let n=tu(0);this.tremolo={level:t=>n.set(to(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tG(){return Object.keys(tj)}var tx=class extends tF{constructor(t,e){let i=function(t){if(!tj[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tC+tj[t]+tE}}(e.instrument);super(t,K(q({},e),{instrument:i}))}},tC="https://danigb.github.io/samples/vcsl/",tE=".websfz.json",tj={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tS=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tB=new WeakMap,tO=class{constructor(t){Y(this,k,void 0),Y(this,G,void 0),Y(this,x,void 0),this.input=t.createGain(),Q(this,x,t.destination),Q(this,G,(function(t){return te(this,null,function*(){let e=tB.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tB.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(J(this,x)),Q(this,k,t),this)))}get paramNames(){return tS}getParam(t){var e;return null==(e=J(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==J(this,k)}ready(){return J(this,G)}connect(t){J(this,k)&&(J(this,k).disconnect(J(this,x)),J(this,k).connect(t)),Q(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tI=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Y(this,C,void 0),Y(this,E,void 0),Q(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:to}),this.player=new tf(t,J(this,C));let o=null!=(l=e.storage)?l:tm,u="function"==typeof J(this,C).buffers?J(this,C).buffers:function(t,e){return(i,n)=>te(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>te(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ts(i,a,e);t&&(n[s]=t)}}))])})}(J(this,C).buffers,o);Q(this,E,u(t,this.player.buffers))}loaded(){return te(this,null,function*(){return yield J(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tW=class{constructor(t,e){var i,n,s,a;this.context=t,Y(this,j,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=ta(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tf(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>te(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>te(this,null,function*(){var e;let s=tl(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:tm);Q(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),(function(t,e){return te(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)throw Error(`Failed to fetch soundfont loops. Response with status ${t.status}`);let e=yield t.json();return console.log({loopData:e}),e}catch(t){throw Error(`Failed to fetch soundfont loops: ${t}`)}})})(null!=(a=e.kit)?a:"MusyngKite",e.instrument).then(t=>{console.log({loopData:t})}).catch(t=>{console.warn(t)})}start(t){let e=tl(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(K(q({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return te(this,null,function*(){return yield J(this,j),this})}};function tT(){return["MusyngKite","FluidR3_GM"]}function tN(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap;var tR=(a=null!=(s=ti())?I($(s)):{},X(s&&s.__esModule?a:W(a,"default",{value:s,enumerable:!0}),s)),tz=class{constructor(t,e){this.context=t,Y(this,B),Y(this,S,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tR.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tf(t,this.options);let i=function(t,e){var i;let n=null!=(i=ta(["ogg","m4a"]))?i:"ogg";return(i,s)=>te(this,null,function*(){for(let a of tU)yield Promise.all(a.samples.map(r=>te(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ts(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);Q(this,S,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return te(this,null,function*(){return yield J(this,S),this})}start(t){var e,i;let n="object"==typeof t?q({},t):{note:t},s=tt(this,B,O).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};S=new WeakMap,B=new WeakSet,O=function(t){var e;let i=tl(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tU.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tU[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tU=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c;let d;let{destination:f,context:m}=this,y=this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let P=m.createBufferSource();P.buffer=y,P.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let _=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,b=_?new BiquadFilterNode(m,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,g=m.createGain(),M=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;g.gain.value=this.velocityToGain(M);let v=null!=(r=t.decayTime)?r:this.options.decayTime,[D,F]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(m,v);function w(t){if(null!=t||(t=m.currentTime),t<=G)P.stop(t);else{let e=F(t);P.stop(e)}}let A=null!=(l=t.stopId)?l:t.note,k=(c=[tl([P,b,g,D,f]),null==(o=t.stop)?void 0:o.call(t,w),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==A||w(null==t?void 0:t.time)})],d=!1,()=>{d||(d=!0,c.forEach(t=>null==t?void 0:t()))});P.onended=()=>{var e;k(),null==(e=t.onEnded)||e.call(t,t)};let G=Math.max(null!=(u=t.time)?u:0,m.currentTime);P.start(t.time);let x=null!=(h=t.duration)?h:y.duration;return"number"==typeof t.duration&&w(G+x),w}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){var i,n,s,a;this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tm(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:ty);tt(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),tt(this,S,{status:"loading"}),(function(t,e){return ti(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)return{status:"error",code:t.status};let e=yield t.json(),n={status:"loaded",data:{}};return Object.keys(e).forEach(t=>{let i=to(t);i&&(n.data[i]=e[t])}),n}catch(t){return{status:"error",code:0}}})})(null!=(a=e.kit)?a:"MusyngKite",e.instrument).then(t=>{tt(this,S,t)})}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers);return this.player.start(X(K({},t),{note:i,detune:n}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){var i,n,s,a;this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tm(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:ty);tt(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),tt(this,S,{status:"loading"}),(function(t,e){return ti(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)return{status:"error",code:t.status};let e=yield t.json(),n={status:"loaded",data:{}};return Object.keys(e).forEach(t=>{let i=to(t);i&&(n.data[i]=e[t])}),n}catch(t){return{status:"error",code:0}}})})(null!=(a=e.kit)?a:"MusyngKite",e.instrument).then(t=>{console.log({loopData:t}),tt(this,S,t)})}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return s&&console.log({sample:t,midi:e,loop:s}),this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration),console.log({sample:t});let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){var i,n,s,a;this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tm(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:ty);tt(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),tt(this,S,{status:"loading"}),(function(t,e){return ti(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)return{status:"error",code:t.status};let e=yield t.json(),n={status:"loaded",data:{}};return Object.keys(e).forEach(t=>{let i=to(t);i&&(n.data[i]=e[t])}),n}catch(t){return{status:"error",code:0}}})})(null!=(a=e.kit)?a:"MusyngKite",e.instrument).then(t=>{console.log({loopData:t}),tt(this,S,t)})}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return s&&console.log({sample:t,midi:e,loop:s}),this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c;let d;let{destination:f,context:m}=this,y=this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let P=m.createBufferSource();P.buffer=y,P.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let _=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,b=_?new BiquadFilterNode(m,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,g=m.createGain(),M=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;g.gain.value=this.velocityToGain(M);let v=null!=(r=t.decayTime)?r:this.options.decayTime,[D,F]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(m,v);function w(t){if(null!=t||(t=m.currentTime),t<=G)P.stop(t);else{let e=F(t);P.stop(e)}}let A=null!=(l=t.stopId)?l:t.note,k=(c=[tl([P,b,g,D,f]),null==(o=t.stop)?void 0:o.call(t,w),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==A||w(null==t?void 0:t.time)})],d=!1,()=>{d||(d=!0,c.forEach(t=>null==t?void 0:t()))});P.onended=()=>{var e;k(),null==(e=t.onEnded)||e.call(t,t)};let G=Math.max(null!=(u=t.time)?u:0,m.currentTime);P.start(t.time);let x=null!=(h=t.duration)?h:y.duration;return"number"==typeof t.duration&&w(G+x),w}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){var i,n,s,a;this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tm(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:ty);tt(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),tt(this,S,{status:"loading"}),(function(t,e){return ti(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)return{status:"error",code:t.status};let e=yield t.json(),n={status:"loaded",data:{}};return Object.keys(e).forEach(t=>{let i=to(t);i&&(n.data[i]=e[t])}),n}catch(t){return{status:"error",code:0}}})})(null!=(a=e.kit)?a:"MusyngKite",e.instrument).then(t=>{console.log({loopData:t}),tt(this,S,t)})}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return s&&console.log({sample:t,midi:e,loop:s}),this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){var i,n,s,a;this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.options=Object.freeze(Object.assign({},e));let r=e.instrument.startsWith("http")?e.instrument:function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(e.instrument,null!=(i=e.kit)?i:"MusyngKite");this.player=new tm(t,e),this.output=this.player.output;let l=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(r,null!=(n=e.storage)?n:ty);tt(this,j,l(t,this.player.buffers));let o=null!=(s=e.extraGain)?s:5,u=new GainNode(t,{gain:o});this.output.addInsert(u),tt(this,S,{status:"loading"}),(function(t,e){return ti(this,null,function*(){let i=`https://goldst.dev/midi-js-soundfonts/${t}/${e}-loop.json`;try{let t=yield fetch(i);if(200!==t.status)return{status:"error",code:t.status};let e=yield t.json(),n={status:"loaded",data:{}};return Object.keys(e).forEach(t=>{let i=to(t);if(i){let s=e[t];n.data[i]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(null!=(a=e.kit)?a:"MusyngKite",e.instrument).then(t=>{console.log({loopData:t}),tt(this,S,t)})}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return s&&console.log({sample:t,midi:e,loop:s}),this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e),this.output=this.player.output;let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([this.loaded,(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.output.addInsert(n)}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return s&&console.log({sample:t,midi:e,loop:s}),this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e),this.output=this.player.output;let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([this.loaded,(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.output.addInsert(n)}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return s&&console.log({sample:t,midi:e,loop:s}),this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>t$,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tT,SplendidGrandPiano:()=>tU,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tN,getSoundfontNames:()=>tR}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e),this.output=this.player.output;let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([this.loaded,(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.output.addInsert(n)}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return s&&console.log({sample:t,midi:e,loop:s}),this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}};function tN(){return["MusyngKite","FluidR3_GM"]}function tR(){return["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"]}j=new WeakMap,S=new WeakMap;var tz=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tU=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tz.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of t$)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=t$.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=t$[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var t$=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e),this.output=this.player.output;let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([this.loaded,(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.output.addInsert(n)}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e);let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([Y(this,j),(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e);let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([Y(this,j),(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}disconnect(){this.player.disconnect()}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reverse(),e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e);let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([Y(this,j),(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}disconnect(){this.player.disconnect()}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("connect",i,n),i.connect(n),e}),()=>{e.reverse(),e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("disconnect",i,n),i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e);let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([Y(this,j),(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}disconnect(){this.player.disconnect()}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("connect",i,n),i.connect(n),e}),()=>{e.reverse(),e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("disconnect",i,n),i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e);let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([Y(this,j),(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}disconnect(){this.player.disconnect()}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("connect",i,n),i.connect(n),e}),()=>{e.reverse(),e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("disconnect",i,n),i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e);let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([Y(this,j),(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[U(i)[0]])((n={exports:{}}).exports,n),n.exports}),ts={};function ta(t,e,i){return ti(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tr(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tl(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("connect",i,n),i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("disconnect",i,n),i.disconnect(n),e})}}function to(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tu(t){return t*t/16129}function th(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)T(t,i,{get:e[i],enumerable:!0})})(ts,{CacheStorage:()=>tP,DrumMachine:()=>tM,ElectricPiano:()=>tG,HttpStorage:()=>ty,LAYERS:()=>tL,Mallet:()=>tC,NAME_TO_PATH:()=>tS,Reverb:()=>tI,Sampler:()=>tW,Soundfont:()=>tU,SplendidGrandPiano:()=>tV,getDrumMachineNames:()=>tb,getElectricPianoNames:()=>tA,getMalletNames:()=>tx,getSoundfontKits:()=>tR,getSoundfontNames:()=>tz}),e.exports=Z(T({},"__esModule",{value:!0}),ts);var tc=class{constructor(t,e){var i,n;this.context=t,Q(this,r,void 0),Q(this,l,void 0),Q(this,o,void 0),Q(this,u,void 0),Q(this,h,void 0),Q(this,c,void 0),tt(this,c,K({destination:t.destination,volume:100,volumeToGain:tu},e)),this.input=t.createGain(),tt(this,r,t.createGain()),tt(this,u,tl([this.input,Y(this,r),Y(this,c).destination]));let s=th(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tu;tt(this,h,s.subscribe(t=>{Y(this,r).gain.value=a(t)}))}addInsert(t){null!=Y(this,o)||tt(this,o,[]),Y(this,o).push(t),Y(this,u).call(this),tt(this,u,tl([this.input,...Y(this,o),Y(this,r),Y(this,c).destination]))}addEffect(t,e,i){let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tl([Y(this,r),n,s]);null!=Y(this,l)||tt(this,l,[]),Y(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;let n=null==(i=Y(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;Y(this,u).call(this),Y(this,h).call(this),null==(t=Y(this,l))||t.forEach(t=>t.disconnect()),tt(this,l,void 0)}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap;var tp=class{constructor(t,e){var i;this.destination=t,this.options=e,Q(this,p,void 0),this.context=t.context,this.buffers={},tt(this,p,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tu}start(t){var e,i,n,s,a,r,l,o,u,h,c,d,f;let m;let{destination:y,context:P}=this,_=this.buffers[t.note];if(!_)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let b=P.createBufferSource();b.buffer=_,b.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let g=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,M=g?new BiquadFilterNode(P,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,v=P.createGain(),D=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;v.gain.value=this.velocityToGain(D),t.loop&&(b.loop=!0,b.loopStart=null!=(r=t.loopStart)?r:0,b.loopEnd=null!=(l=t.loopEnd)?l:_.duration);let F=null!=(o=t.decayTime)?o:this.options.decayTime,[w,A]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(P,F);function k(t){if(null!=t||(t=P.currentTime),t<=C)b.stop(t);else{let e=A(t);b.stop(e)}}let G=null!=(u=t.stopId)?u:t.note,x=(f=[tl([b,M,v,w,y]),null==(h=t.stop)?void 0:h.call(t,k),Y(this,p).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==G||k(null==t?void 0:t.time)})],m=!1,()=>{m||(m=!0,f.forEach(t=>null==t?void 0:t()))});b.onended=()=>{var e;x(),null==(e=t.onEnded)||e.call(t,t)};let C=Math.max(null!=(c=t.time)?c:0,P.currentTime);b.start(t.time);let E=null!=(d=t.duration)?d:_.duration;return"number"==typeof t.duration&&k(C+E),k}stop(t){Y(this,p).trigger(t)}disconnect(){this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]})}};p=new WeakMap;var td=class{constructor(t){this.compare=t,Q(this,d,[])}push(t){let e=Y(this,d).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,Y(this,d)[e])?(s=e,n=e-1):i=e+1}Y(this,d).splice(s,0,t)}pop(){return Y(this,d).shift()}peek(){return Y(this,d)[0]}removeAll(t){let e=Y(this,d).length;return tt(this,d,Y(this,d).filter(e=>!t(e))),Y(this,d).length!==e}clear(){tt(this,d,[])}size(){return Y(this,d).length}};d=new WeakMap;var tf=class{constructor(t,e){this.destination=t,Q(this,f,void 0),Q(this,m,void 0),tt(this,f,new td((t,e)=>t.time-e.time)),this.player=new tp(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==Y(this,m)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(Y(this,f).push(X(K({},t),{time:s})),Y(this,m)||tt(this,m,setInterval(()=>{let t=i.currentTime+1;for(;Y(this,f).size()&&Y(this,f).peek().time<=t;){let t=Y(this,f).pop();t&&this.player.start(t)}Y(this,f).size()||(clearInterval(Y(this,m)),tt(this,m,void 0))},200)),e=>{(!e||e<s)&&Y(this,f).removeAll(e=>e===t)||this.player.stop(X(K({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){Y(this,f).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?Y(this,f).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):Y(this,f).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};f=new WeakMap,m=new WeakMap;var tm=class{constructor(t,e){this.context=t;let i=new tc(t,e);this.player=new tf(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},ty={fetch:t=>fetch(t)},tP=class{constructor(t="smplr"){Q(this,P),Q(this,b),Q(this,y,void 0),"undefined"!=typeof window&&"caches"in window?tt(this,y,caches.open(t)):tt(this,y,Promise.reject("CacheStorage not supported"))}fetch(t){return ti(this,null,function*(){let e=new Request(t);try{return yield te(this,P,_).call(this,e)}catch(i){let t=yield fetch(e);return yield te(this,b,g).call(this,e,t),t}})}};y=new WeakMap,P=new WeakSet,_=function(t){return ti(this,null,function*(){let e=yield Y(this,y),i=yield e.match(t);if(i)return i;throw Error("Not found")})},b=new WeakSet,g=function(t,e){return ti(this,null,function*(){try{let i=yield Y(this,y);yield i.put(t,e.clone())}catch(t){}})};var t_={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tb(){return Object.keys(tg)}var tg={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tM=class{constructor(t,e){var i,n;Q(this,M,t_),Q(this,v,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:ty,a=tg[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ti(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tm(t,e),this.output=this.player.output,tt(this,v,function(t,e,i,n){var s;let a=null!=(s=tr(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ti(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield ta(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tt(this,M,t)})}loaded(){return ti(this,null,function*(){return yield Y(this,v),this})}get sampleNames(){return Y(this,M).sampleNames}getVariations(t){var e;return null!=(e=Y(this,M).sampleNameVariations[t])?e:[]}start(t){var e;let i=Y(this,M).nameToSample[t.note];return this.player.start(X(K({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tv(t,e){return ti(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tD(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}M=new WeakMap,v=new WeakMap;var tF=Object.freeze({meta:{},global:{},groups:[]}),tw=class{constructor(t,e){var i;this.context=t,Q(this,w),Q(this,D,void 0),Q(this,F,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tm(t,e),tt(this,D,tF);let n=null!=(i=e.storage)?i:ty;tt(this,F,(function(t,e){return ti(this,null,function*(){if("string"==typeof t)return tv(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tv(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tt(this,D,Object.freeze(e)),function(t,e,i,n){return ti(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tr(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ti(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ti(this,null,function*(){if(e[s])return;let a=yield ta(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,Y(this,D),n))))}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,F),this})}start(t){te(this,w,A).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tA(){return Object.keys(tk)}D=new WeakMap,F=new WeakMap,w=new WeakSet,A=function(t){var e;let i=to(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tD(e.midi,n.lokey,n.hikey)&&tD(e.velocity,n.lovel,n.hivel)&&tD(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tD(e.midi,t.lokey,t.hikey)&&tD(e.velocity,t.lovel,t.hivel)&&tD(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(Y(this,D),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(X(K({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tk={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tG=class extends tw{constructor(t,e){var i;super(t,X(K({},e),{instrument:null!=(i=tk[e.instrument])?i:e.instrument}));let n=th(0);this.tremolo={level:t=>n.set(tu(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tx(){return Object.keys(tS)}var tC=class extends tw{constructor(t,e){let i=function(t){if(!tS[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tE+tS[t]+tj}}(e.instrument);super(t,X(K({},e),{instrument:i}))}},tE="https://danigb.github.io/samples/vcsl/",tj=".websfz.json",tS={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tB=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tO=new WeakMap,tI=class{constructor(t){Q(this,k,void 0),Q(this,G,void 0),Q(this,x,void 0),this.input=t.createGain(),tt(this,x,t.destination),tt(this,G,(function(t){return ti(this,null,function*(){let e=tO.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tO.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(Y(this,x)),tt(this,k,t),this)))}get paramNames(){return tB}getParam(t){var e;return null==(e=Y(this,k))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==Y(this,k)}ready(){return Y(this,G)}connect(t){Y(this,k)&&(Y(this,k).disconnect(Y(this,x)),Y(this,k).connect(t)),tt(this,x,t)}};k=new WeakMap,G=new WeakMap,x=new WeakMap;var tW=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,Q(this,C,void 0),Q(this,E,void 0),tt(this,C,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tu}),this.player=new tm(t,Y(this,C));let o=null!=(l=e.storage)?l:ty,u="function"==typeof Y(this,C).buffers?Y(this,C).buffers:function(t,e){return(i,n)=>ti(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ti(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield ta(i,a,e);t&&(n[s]=t)}}))])})}(Y(this,C).buffers,o);tt(this,E,u(t,this.player.buffers))}loaded(){return ti(this,null,function*(){return yield Y(this,E),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};C=new WeakMap,E=new WeakMap;var tT=["MusyngKite","FluidR3_GM"],tN=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tR(){return tT}function tz(){return tN}var tU=class{constructor(t,e){this.context=t,Q(this,j,void 0),Q(this,S,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:ty,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tr(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tm(t,e);let i=function(t,e){return(i,n)=>ti(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ti(this,null,function*(){var e;let s=to(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tt(this,j,i(t,this.player.buffers)),tt(this,S,{status:"not-loaded"}),this.config.loopDataUrl&&(tt(this,S,{status:"loading"}),tt(this,j,Promise.all([Y(this,j),(function(t){return ti(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=to(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tt(this,S,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ti(this,null,function*(){return yield Y(this,j),this})}get hasLoops(){return"loaded"===Y(this,S).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=to(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===Y(this,S).status?Y(this,S).data[e]:void 0;return this.player.start(X(K({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};j=new WeakMap,S=new WeakMap;var t$=(a=null!=(s=tn())?W(V(s)):{},Z(s&&s.__esModule?a:T(a,"default",{value:s,enumerable:!0}),s)),tV=class{constructor(t,e){this.context=t,Q(this,O),Q(this,B,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:t$.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tm(t,this.options);let i=function(t,e){var i;let n=null!=(i=tr(["ogg","m4a"]))?i:"ogg";return(i,s)=>ti(this,null,function*(){for(let a of tL)yield Promise.all(a.samples.map(r=>ti(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield ta(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tt(this,B,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ti(this,null,function*(){return yield Y(this,B),this})}start(t){var e,i;let n="object"==typeof t?K({},t):{note:t},s=te(this,O,I).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakSet,I=function(t){var e;let i=to(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tL.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tL[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tL=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[V(i)[0]])((n={exports:{}}).exports,n),n.exports}),tr={};function tl(t,e,i){return ts(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function to(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tu(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("connect",i,n),i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("disconnect",i,n),i.disconnect(n),e})}}function th(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tc(t){return t*t/16129}function tp(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)R(t,i,{get:e[i],enumerable:!0})})(tr,{CacheStorage:()=>tb,DrumMachine:()=>tD,ElectricPiano:()=>tC,HttpStorage:()=>t_,LAYERS:()=>tq,Mallet:()=>tj,NAME_TO_PATH:()=>tO,Reverb:()=>tT,Sampler:()=>tN,Soundfont:()=>tV,SplendidGrandPiano:()=>tH,getDrumMachineNames:()=>tM,getElectricPianoNames:()=>tG,getMalletNames:()=>tE,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=Y(R({},"__esModule",{value:!0}),tr);var td=class{constructor(t,e){var i,n;this.context=t,te(this,r,void 0),te(this,l,void 0),te(this,o,void 0),te(this,u,void 0),te(this,h,void 0),te(this,c,void 0),te(this,p,!1),ti(this,c,Z({destination:t.destination,volume:100,volumeToGain:tc},e)),this.input=t.createGain(),ti(this,r,t.createGain()),ti(this,u,tu([this.input,tt(this,r),tt(this,c).destination]));let s=tp(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tc;ti(this,h,s.subscribe(t=>{tt(this,r).gain.value=a(t)}))}addInsert(t){if(tt(this,p))throw Error("Can't add insert to disconnected channel");null!=tt(this,o)||ti(this,o,[]),tt(this,o).push(t),tt(this,u).call(this),ti(this,u,tu([this.input,...tt(this,o),tt(this,r),tt(this,c).destination]))}addEffect(t,e,i){if(tt(this,p))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tu([tt(this,r),n,s]);null!=tt(this,l)||ti(this,l,[]),tt(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tt(this,p))throw Error("Can't send effect to disconnected channel");let n=null==(i=tt(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tt(this,p)||(ti(this,p,!0),tt(this,u).call(this),tt(this,h).call(this),null==(t=tt(this,l))||t.forEach(t=>t.disconnect()),ti(this,l,void 0))}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,p=new WeakMap;var tf=class{constructor(t,e){var i;this.destination=t,this.options=e,te(this,d,!1),te(this,f,void 0),this.context=t.context,this.buffers={},ti(this,f,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tc}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,m;let y;if(tt(this,d))throw Error("Can't start a sample on disconnected player");let{destination:P,context:_}=this,b=this.buffers[t.note];if(!b)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let g=_.createBufferSource();g.buffer=b,g.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let M=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,v=M?new BiquadFilterNode(_,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,D=_.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;D.gain.value=this.velocityToGain(F),t.loop&&(g.loop=!0,g.loopStart=null!=(r=t.loopStart)?r:0,g.loopEnd=null!=(l=t.loopEnd)?l:b.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(_,w);function G(t){if(null!=t||(t=_.currentTime),t<=E)g.stop(t);else{let e=k(t);g.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(m=[tu([g,v,D,A,P]),null==(h=t.stop)?void 0:h.call(t,G),tt(this,f).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],y=!1,()=>{y||(y=!0,m.forEach(t=>null==t?void 0:t()))});g.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,_.currentTime);g.start(t.time);let j=null!=(p=t.duration)?p:b.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tt(this,f).trigger(t)}disconnect(){tt(this,d)||(ti(this,d,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tt(this,d)}};d=new WeakMap,f=new WeakMap;var tm=class{constructor(t){this.compare=t,te(this,m,[])}push(t){let e=tt(this,m).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tt(this,m)[e])?(s=e,n=e-1):i=e+1}tt(this,m).splice(s,0,t)}pop(){return tt(this,m).shift()}peek(){return tt(this,m)[0]}removeAll(t){let e=tt(this,m).length;return ti(this,m,tt(this,m).filter(e=>!t(e))),tt(this,m).length!==e}clear(){ti(this,m,[])}size(){return tt(this,m).length}};m=new WeakMap;var ty=class{constructor(t,e){this.destination=t,te(this,y,void 0),te(this,P,void 0),ti(this,y,new tm((t,e)=>t.time-e.time)),this.player=new tf(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tt(this,P)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tt(this,y).push(J(Z({},t),{time:s})),tt(this,P)||ti(this,P,setInterval(()=>{let t=i.currentTime+1;for(;tt(this,y).size()&&tt(this,y).peek().time<=t;){let t=tt(this,y).pop();t&&this.player.start(t)}tt(this,y).size()||(clearInterval(tt(this,P)),ti(this,P,void 0))},200)),e=>{(!e||e<s)&&tt(this,y).removeAll(e=>e===t)||this.player.stop(J(Z({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tt(this,y).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tt(this,y).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tt(this,y).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};y=new WeakMap,P=new WeakMap;var tP=class{constructor(t,e){this.context=t;let i=new td(t,e);this.player=new ty(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},t_={fetch:t=>fetch(t)},tb=class{constructor(t="smplr"){te(this,b),te(this,M),te(this,_,void 0),"undefined"!=typeof window&&"caches"in window?ti(this,_,caches.open(t)):ti(this,_,Promise.reject("CacheStorage not supported"))}fetch(t){return ts(this,null,function*(){let e=new Request(t);try{return yield tn(this,b,g).call(this,e)}catch(i){let t=yield fetch(e);return yield tn(this,M,v).call(this,e,t),t}})}};_=new WeakMap,b=new WeakSet,g=function(t){return ts(this,null,function*(){let e=yield tt(this,_),i=yield e.match(t);if(i)return i;throw Error("Not found")})},M=new WeakSet,v=function(t,e){return ts(this,null,function*(){try{let i=yield tt(this,_);yield i.put(t,e.clone())}catch(t){}})};var tg={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tM(){return Object.keys(tv)}var tv={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tD=class{constructor(t,e){var i,n;te(this,D,tg),te(this,F,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:t_,a=tv[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ts(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tP(t,e),this.output=this.player.output,ti(this,F,function(t,e,i,n){var s;let a=null!=(s=to(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ts(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tl(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{ti(this,D,t)})}loaded(){return ts(this,null,function*(){return yield tt(this,F),this})}get sampleNames(){return tt(this,D).sampleNames}getVariations(t){var e;return null!=(e=tt(this,D).sampleNameVariations[t])?e:[]}start(t){var e;let i=tt(this,D).nameToSample[t.note];return this.player.start(J(Z({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tF(t,e){return ts(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tw(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}D=new WeakMap,F=new WeakMap;var tA=Object.freeze({meta:{},global:{},groups:[]}),tk=class{constructor(t,e){var i;this.context=t,te(this,k),te(this,w,void 0),te(this,A,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tP(t,e),ti(this,w,tA);let n=null!=(i=e.storage)?i:t_;ti(this,A,(function(t,e){return ts(this,null,function*(){if("string"==typeof t)return tF(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tF(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(ti(this,w,Object.freeze(e)),function(t,e,i,n){return ts(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=to(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ts(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ts(this,null,function*(){if(e[s])return;let a=yield tl(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tt(this,w),n))))}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,A),this})}start(t){tn(this,k,G).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tG(){return Object.keys(tx)}w=new WeakMap,A=new WeakMap,k=new WeakSet,G=function(t){var e;let i=th(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tw(e.midi,n.lokey,n.hikey)&&tw(e.velocity,n.lovel,n.hivel)&&tw(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tw(e.midi,t.lokey,t.hikey)&&tw(e.velocity,t.lovel,t.hivel)&&tw(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tt(this,w),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(J(Z({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tx={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tC=class extends tk{constructor(t,e){var i;super(t,J(Z({},e),{instrument:null!=(i=tx[e.instrument])?i:e.instrument}));let n=tp(0);this.tremolo={level:t=>n.set(tc(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tE(){return Object.keys(tO)}var tj=class extends tk{constructor(t,e){let i=function(t){if(!tO[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tS+tO[t]+tB}}(e.instrument);super(t,J(Z({},e),{instrument:i}))}},tS="https://danigb.github.io/samples/vcsl/",tB=".websfz.json",tO={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tI=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tW=new WeakMap,tT=class{constructor(t){te(this,x,void 0),te(this,C,void 0),te(this,E,void 0),this.input=t.createGain(),ti(this,E,t.destination),ti(this,C,(function(t){return ts(this,null,function*(){let e=tW.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tW.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tt(this,E)),ti(this,x,t),this)))}get paramNames(){return tI}getParam(t){var e;return null==(e=tt(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tt(this,x)}ready(){return tt(this,C)}connect(t){tt(this,x)&&(tt(this,x).disconnect(tt(this,E)),tt(this,x).connect(t)),ti(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tN=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,te(this,j,void 0),te(this,S,void 0),ti(this,j,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tc}),this.player=new tP(t,tt(this,j));let o=null!=(l=e.storage)?l:t_,u="function"==typeof tt(this,j).buffers?tt(this,j).buffers:function(t,e){return(i,n)=>ts(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ts(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tl(i,a,e);t&&(n[s]=t)}}))])})}(tt(this,j).buffers,o);ti(this,S,u(t,this.player.buffers))}loaded(){return ts(this,null,function*(){return yield tt(this,S),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap,S=new WeakMap;var tR=["MusyngKite","FluidR3_GM"],tz=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tU(){return tR}function t$(){return tz}var tV=class{constructor(t,e){this.context=t,te(this,B,void 0),te(this,O,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:t_,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=to(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tP(t,e);let i=function(t,e){return(i,n)=>ts(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ts(this,null,function*(){var e;let s=th(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);ti(this,B,i(t,this.player.buffers)),ti(this,O,{status:"not-loaded"}),this.config.loopDataUrl&&(ti(this,O,{status:"loading"}),ti(this,B,Promise.all([tt(this,B),(function(t){return ts(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=th(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{ti(this,O,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,B),this})}get hasLoops(){return"loaded"===tt(this,O).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=th(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tt(this,O).status?tt(this,O).data[e]:void 0;return this.player.start(J(Z({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakMap;var tL=(a=null!=(s=ta())?N(H(s)):{},Y(s&&s.__esModule?a:R(a,"default",{value:s,enumerable:!0}),s)),tH=class{constructor(t,e){this.context=t,te(this,W),te(this,I,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tL.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tP(t,this.options);let i=function(t,e){var i;let n=null!=(i=to(["ogg","m4a"]))?i:"ogg";return(i,s)=>ts(this,null,function*(){for(let a of tq)yield Promise.all(a.samples.map(r=>ts(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tl(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);ti(this,I,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ts(this,null,function*(){return yield tt(this,I),this})}start(t){var e,i;let n="object"==typeof t?Z({},t):{note:t},s=tn(this,W,T).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};I=new WeakMap,W=new WeakSet,T=function(t){var e;let i=th(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tq.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tq[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tq=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[V(i)[0]])((n={exports:{}}).exports,n),n.exports}),tr={};function tl(t,e,i){return ts(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function to(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tu(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return console.log("disconnect",i,n),e})}}function th(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tc(t){return t*t/16129}function tp(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)R(t,i,{get:e[i],enumerable:!0})})(tr,{CacheStorage:()=>tb,DrumMachine:()=>tD,ElectricPiano:()=>tC,HttpStorage:()=>t_,LAYERS:()=>tq,Mallet:()=>tj,NAME_TO_PATH:()=>tO,Reverb:()=>tT,Sampler:()=>tN,Soundfont:()=>tV,SplendidGrandPiano:()=>tH,getDrumMachineNames:()=>tM,getElectricPianoNames:()=>tG,getMalletNames:()=>tE,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=Y(R({},"__esModule",{value:!0}),tr);var td=class{constructor(t,e){var i,n;this.context=t,te(this,r,void 0),te(this,l,void 0),te(this,o,void 0),te(this,u,void 0),te(this,h,void 0),te(this,c,void 0),te(this,p,!1),ti(this,c,Z({destination:t.destination,volume:100,volumeToGain:tc},e)),this.input=t.createGain(),ti(this,r,t.createGain()),ti(this,u,tu([this.input,tt(this,r),tt(this,c).destination]));let s=tp(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tc;ti(this,h,s.subscribe(t=>{tt(this,r).gain.value=a(t)}))}addInsert(t){if(tt(this,p))throw Error("Can't add insert to disconnected channel");null!=tt(this,o)||ti(this,o,[]),tt(this,o).push(t),tt(this,u).call(this),ti(this,u,tu([this.input,...tt(this,o),tt(this,r),tt(this,c).destination]))}addEffect(t,e,i){if(tt(this,p))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tu([tt(this,r),n,s]);null!=tt(this,l)||ti(this,l,[]),tt(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tt(this,p))throw Error("Can't send effect to disconnected channel");let n=null==(i=tt(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tt(this,p)||(ti(this,p,!0),tt(this,u).call(this),tt(this,h).call(this),null==(t=tt(this,l))||t.forEach(t=>t.disconnect()),ti(this,l,void 0))}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,p=new WeakMap;var tf=class{constructor(t,e){var i;this.destination=t,this.options=e,te(this,d,!1),te(this,f,void 0),this.context=t.context,this.buffers={},ti(this,f,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tc}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,m;let y;if(tt(this,d))throw Error("Can't start a sample on disconnected player");let{destination:P,context:_}=this,b=this.buffers[t.note];if(!b)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let g=_.createBufferSource();g.buffer=b,g.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let M=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,v=M?new BiquadFilterNode(_,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,D=_.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;D.gain.value=this.velocityToGain(F),t.loop&&(g.loop=!0,g.loopStart=null!=(r=t.loopStart)?r:0,g.loopEnd=null!=(l=t.loopEnd)?l:b.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(_,w);function G(t){if(null!=t||(t=_.currentTime),t<=E)g.stop(t);else{let e=k(t);g.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(m=[tu([g,v,D,A,P]),null==(h=t.stop)?void 0:h.call(t,G),tt(this,f).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],y=!1,()=>{y||(y=!0,m.forEach(t=>null==t?void 0:t()))});g.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,_.currentTime);g.start(t.time);let j=null!=(p=t.duration)?p:b.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tt(this,f).trigger(t)}disconnect(){tt(this,d)||(ti(this,d,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tt(this,d)}};d=new WeakMap,f=new WeakMap;var tm=class{constructor(t){this.compare=t,te(this,m,[])}push(t){let e=tt(this,m).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tt(this,m)[e])?(s=e,n=e-1):i=e+1}tt(this,m).splice(s,0,t)}pop(){return tt(this,m).shift()}peek(){return tt(this,m)[0]}removeAll(t){let e=tt(this,m).length;return ti(this,m,tt(this,m).filter(e=>!t(e))),tt(this,m).length!==e}clear(){ti(this,m,[])}size(){return tt(this,m).length}};m=new WeakMap;var ty=class{constructor(t,e){this.destination=t,te(this,y,void 0),te(this,P,void 0),ti(this,y,new tm((t,e)=>t.time-e.time)),this.player=new tf(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tt(this,P)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tt(this,y).push(J(Z({},t),{time:s})),tt(this,P)||ti(this,P,setInterval(()=>{let t=i.currentTime+1;for(;tt(this,y).size()&&tt(this,y).peek().time<=t;){let t=tt(this,y).pop();t&&this.player.start(t)}tt(this,y).size()||(clearInterval(tt(this,P)),ti(this,P,void 0))},200)),e=>{(!e||e<s)&&tt(this,y).removeAll(e=>e===t)||this.player.stop(J(Z({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tt(this,y).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tt(this,y).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tt(this,y).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};y=new WeakMap,P=new WeakMap;var tP=class{constructor(t,e){this.context=t;let i=new td(t,e);this.player=new ty(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},t_={fetch:t=>fetch(t)},tb=class{constructor(t="smplr"){te(this,b),te(this,M),te(this,_,void 0),"undefined"!=typeof window&&"caches"in window?ti(this,_,caches.open(t)):ti(this,_,Promise.reject("CacheStorage not supported"))}fetch(t){return ts(this,null,function*(){let e=new Request(t);try{return yield tn(this,b,g).call(this,e)}catch(i){let t=yield fetch(e);return yield tn(this,M,v).call(this,e,t),t}})}};_=new WeakMap,b=new WeakSet,g=function(t){return ts(this,null,function*(){let e=yield tt(this,_),i=yield e.match(t);if(i)return i;throw Error("Not found")})},M=new WeakSet,v=function(t,e){return ts(this,null,function*(){try{let i=yield tt(this,_);yield i.put(t,e.clone())}catch(t){}})};var tg={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tM(){return Object.keys(tv)}var tv={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tD=class{constructor(t,e){var i,n;te(this,D,tg),te(this,F,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:t_,a=tv[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ts(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tP(t,e),this.output=this.player.output,ti(this,F,function(t,e,i,n){var s;let a=null!=(s=to(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ts(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tl(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{ti(this,D,t)})}loaded(){return ts(this,null,function*(){return yield tt(this,F),this})}get sampleNames(){return tt(this,D).sampleNames}getVariations(t){var e;return null!=(e=tt(this,D).sampleNameVariations[t])?e:[]}start(t){var e;let i=tt(this,D).nameToSample[t.note];return this.player.start(J(Z({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tF(t,e){return ts(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tw(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}D=new WeakMap,F=new WeakMap;var tA=Object.freeze({meta:{},global:{},groups:[]}),tk=class{constructor(t,e){var i;this.context=t,te(this,k),te(this,w,void 0),te(this,A,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tP(t,e),ti(this,w,tA);let n=null!=(i=e.storage)?i:t_;ti(this,A,(function(t,e){return ts(this,null,function*(){if("string"==typeof t)return tF(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tF(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(ti(this,w,Object.freeze(e)),function(t,e,i,n){return ts(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=to(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ts(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ts(this,null,function*(){if(e[s])return;let a=yield tl(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tt(this,w),n))))}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,A),this})}start(t){tn(this,k,G).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tG(){return Object.keys(tx)}w=new WeakMap,A=new WeakMap,k=new WeakSet,G=function(t){var e;let i=th(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tw(e.midi,n.lokey,n.hikey)&&tw(e.velocity,n.lovel,n.hivel)&&tw(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tw(e.midi,t.lokey,t.hikey)&&tw(e.velocity,t.lovel,t.hivel)&&tw(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tt(this,w),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(J(Z({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tx={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tC=class extends tk{constructor(t,e){var i;super(t,J(Z({},e),{instrument:null!=(i=tx[e.instrument])?i:e.instrument}));let n=tp(0);this.tremolo={level:t=>n.set(tc(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tE(){return Object.keys(tO)}var tj=class extends tk{constructor(t,e){let i=function(t){if(!tO[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tS+tO[t]+tB}}(e.instrument);super(t,J(Z({},e),{instrument:i}))}},tS="https://danigb.github.io/samples/vcsl/",tB=".websfz.json",tO={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tI=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tW=new WeakMap,tT=class{constructor(t){te(this,x,void 0),te(this,C,void 0),te(this,E,void 0),this.input=t.createGain(),ti(this,E,t.destination),ti(this,C,(function(t){return ts(this,null,function*(){let e=tW.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tW.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tt(this,E)),ti(this,x,t),this)))}get paramNames(){return tI}getParam(t){var e;return null==(e=tt(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tt(this,x)}ready(){return tt(this,C)}connect(t){tt(this,x)&&(tt(this,x).disconnect(tt(this,E)),tt(this,x).connect(t)),ti(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tN=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,te(this,j,void 0),te(this,S,void 0),ti(this,j,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tc}),this.player=new tP(t,tt(this,j));let o=null!=(l=e.storage)?l:t_,u="function"==typeof tt(this,j).buffers?tt(this,j).buffers:function(t,e){return(i,n)=>ts(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ts(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tl(i,a,e);t&&(n[s]=t)}}))])})}(tt(this,j).buffers,o);ti(this,S,u(t,this.player.buffers))}loaded(){return ts(this,null,function*(){return yield tt(this,S),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap,S=new WeakMap;var tR=["MusyngKite","FluidR3_GM"],tz=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tU(){return tR}function t$(){return tz}var tV=class{constructor(t,e){this.context=t,te(this,B,void 0),te(this,O,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:t_,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=to(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tP(t,e);let i=function(t,e){return(i,n)=>ts(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ts(this,null,function*(){var e;let s=th(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);ti(this,B,i(t,this.player.buffers)),ti(this,O,{status:"not-loaded"}),this.config.loopDataUrl&&(ti(this,O,{status:"loading"}),ti(this,B,Promise.all([tt(this,B),(function(t){return ts(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=th(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{ti(this,O,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,B),this})}get hasLoops(){return"loaded"===tt(this,O).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=th(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tt(this,O).status?tt(this,O).data[e]:void 0;return this.player.start(J(Z({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakMap;var tL=(a=null!=(s=ta())?N(H(s)):{},Y(s&&s.__esModule?a:R(a,"default",{value:s,enumerable:!0}),s)),tH=class{constructor(t,e){this.context=t,te(this,W),te(this,I,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tL.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tP(t,this.options);let i=function(t,e){var i;let n=null!=(i=to(["ogg","m4a"]))?i:"ogg";return(i,s)=>ts(this,null,function*(){for(let a of tq)yield Promise.all(a.samples.map(r=>ts(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tl(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);ti(this,I,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ts(this,null,function*(){return yield tt(this,I),this})}start(t){var e,i;let n="object"==typeof t?Z({},t):{note:t},s=tn(this,W,T).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};I=new WeakMap,W=new WeakSet,T=function(t){var e;let i=th(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tq.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tq[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tq=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[V(i)[0]])((n={exports:{}}).exports,n),n.exports}),tr={};function tl(t,e,i){return ts(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function to(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tu(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>("output"in t&&t.output,"input"in e&&e.input,e)),()=>{e.reduce((t,e)=>("output"in t&&t.output,"input"in e&&e.input,e))}}function th(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tc(t){return t*t/16129}function tp(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)R(t,i,{get:e[i],enumerable:!0})})(tr,{CacheStorage:()=>tb,DrumMachine:()=>tD,ElectricPiano:()=>tC,HttpStorage:()=>t_,LAYERS:()=>tq,Mallet:()=>tj,NAME_TO_PATH:()=>tO,Reverb:()=>tT,Sampler:()=>tN,Soundfont:()=>tV,SplendidGrandPiano:()=>tH,getDrumMachineNames:()=>tM,getElectricPianoNames:()=>tG,getMalletNames:()=>tE,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=Y(R({},"__esModule",{value:!0}),tr);var td=class{constructor(t,e){var i,n;this.context=t,te(this,r,void 0),te(this,l,void 0),te(this,o,void 0),te(this,u,void 0),te(this,h,void 0),te(this,c,void 0),te(this,p,!1),ti(this,c,Z({destination:t.destination,volume:100,volumeToGain:tc},e)),this.input=t.createGain(),ti(this,r,t.createGain()),ti(this,u,tu([this.input,tt(this,r),tt(this,c).destination]));let s=tp(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tc;ti(this,h,s.subscribe(t=>{tt(this,r).gain.value=a(t)}))}addInsert(t){if(tt(this,p))throw Error("Can't add insert to disconnected channel");null!=tt(this,o)||ti(this,o,[]),tt(this,o).push(t),tt(this,u).call(this),ti(this,u,tu([this.input,...tt(this,o),tt(this,r),tt(this,c).destination]))}addEffect(t,e,i){if(tt(this,p))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tu([tt(this,r),n,s]);null!=tt(this,l)||ti(this,l,[]),tt(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tt(this,p))throw Error("Can't send effect to disconnected channel");let n=null==(i=tt(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tt(this,p)||(ti(this,p,!0),tt(this,u).call(this),tt(this,h).call(this),null==(t=tt(this,l))||t.forEach(t=>t.disconnect()),ti(this,l,void 0))}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,p=new WeakMap;var tf=class{constructor(t,e){var i;this.destination=t,this.options=e,te(this,d,!1),te(this,f,void 0),this.context=t.context,this.buffers={},ti(this,f,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tc}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,m;let y;if(tt(this,d))throw Error("Can't start a sample on disconnected player");let{destination:P,context:_}=this,b=this.buffers[t.note];if(!b)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let g=_.createBufferSource();g.buffer=b,g.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let M=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,v=M?new BiquadFilterNode(_,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,D=_.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;D.gain.value=this.velocityToGain(F),t.loop&&(g.loop=!0,g.loopStart=null!=(r=t.loopStart)?r:0,g.loopEnd=null!=(l=t.loopEnd)?l:b.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(_,w);function G(t){if(null!=t||(t=_.currentTime),t<=E)g.stop(t);else{let e=k(t);g.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(m=[tu([g,v,D,A,P]),null==(h=t.stop)?void 0:h.call(t,G),tt(this,f).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],y=!1,()=>{y||(y=!0,m.forEach(t=>null==t?void 0:t()))});g.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,_.currentTime);g.start(t.time);let j=null!=(p=t.duration)?p:b.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tt(this,f).trigger(t)}disconnect(){tt(this,d)||(ti(this,d,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tt(this,d)}};d=new WeakMap,f=new WeakMap;var tm=class{constructor(t){this.compare=t,te(this,m,[])}push(t){let e=tt(this,m).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tt(this,m)[e])?(s=e,n=e-1):i=e+1}tt(this,m).splice(s,0,t)}pop(){return tt(this,m).shift()}peek(){return tt(this,m)[0]}removeAll(t){let e=tt(this,m).length;return ti(this,m,tt(this,m).filter(e=>!t(e))),tt(this,m).length!==e}clear(){ti(this,m,[])}size(){return tt(this,m).length}};m=new WeakMap;var ty=class{constructor(t,e){this.destination=t,te(this,y,void 0),te(this,P,void 0),ti(this,y,new tm((t,e)=>t.time-e.time)),this.player=new tf(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tt(this,P)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tt(this,y).push(J(Z({},t),{time:s})),tt(this,P)||ti(this,P,setInterval(()=>{let t=i.currentTime+1;for(;tt(this,y).size()&&tt(this,y).peek().time<=t;){let t=tt(this,y).pop();t&&this.player.start(t)}tt(this,y).size()||(clearInterval(tt(this,P)),ti(this,P,void 0))},200)),e=>{(!e||e<s)&&tt(this,y).removeAll(e=>e===t)||this.player.stop(J(Z({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tt(this,y).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tt(this,y).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tt(this,y).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};y=new WeakMap,P=new WeakMap;var tP=class{constructor(t,e){this.context=t;let i=new td(t,e);this.player=new ty(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},t_={fetch:t=>fetch(t)},tb=class{constructor(t="smplr"){te(this,b),te(this,M),te(this,_,void 0),"undefined"!=typeof window&&"caches"in window?ti(this,_,caches.open(t)):ti(this,_,Promise.reject("CacheStorage not supported"))}fetch(t){return ts(this,null,function*(){let e=new Request(t);try{return yield tn(this,b,g).call(this,e)}catch(i){let t=yield fetch(e);return yield tn(this,M,v).call(this,e,t),t}})}};_=new WeakMap,b=new WeakSet,g=function(t){return ts(this,null,function*(){let e=yield tt(this,_),i=yield e.match(t);if(i)return i;throw Error("Not found")})},M=new WeakSet,v=function(t,e){return ts(this,null,function*(){try{let i=yield tt(this,_);yield i.put(t,e.clone())}catch(t){}})};var tg={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tM(){return Object.keys(tv)}var tv={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tD=class{constructor(t,e){var i,n;te(this,D,tg),te(this,F,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:t_,a=tv[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ts(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tP(t,e),this.output=this.player.output,ti(this,F,function(t,e,i,n){var s;let a=null!=(s=to(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ts(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tl(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{ti(this,D,t)})}loaded(){return ts(this,null,function*(){return yield tt(this,F),this})}get sampleNames(){return tt(this,D).sampleNames}getVariations(t){var e;return null!=(e=tt(this,D).sampleNameVariations[t])?e:[]}start(t){var e;let i=tt(this,D).nameToSample[t.note];return this.player.start(J(Z({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tF(t,e){return ts(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tw(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}D=new WeakMap,F=new WeakMap;var tA=Object.freeze({meta:{},global:{},groups:[]}),tk=class{constructor(t,e){var i;this.context=t,te(this,k),te(this,w,void 0),te(this,A,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tP(t,e),ti(this,w,tA);let n=null!=(i=e.storage)?i:t_;ti(this,A,(function(t,e){return ts(this,null,function*(){if("string"==typeof t)return tF(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tF(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(ti(this,w,Object.freeze(e)),function(t,e,i,n){return ts(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=to(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ts(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ts(this,null,function*(){if(e[s])return;let a=yield tl(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tt(this,w),n))))}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,A),this})}start(t){tn(this,k,G).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tG(){return Object.keys(tx)}w=new WeakMap,A=new WeakMap,k=new WeakSet,G=function(t){var e;let i=th(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tw(e.midi,n.lokey,n.hikey)&&tw(e.velocity,n.lovel,n.hivel)&&tw(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tw(e.midi,t.lokey,t.hikey)&&tw(e.velocity,t.lovel,t.hivel)&&tw(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tt(this,w),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(J(Z({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tx={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tC=class extends tk{constructor(t,e){var i;super(t,J(Z({},e),{instrument:null!=(i=tx[e.instrument])?i:e.instrument}));let n=tp(0);this.tremolo={level:t=>n.set(tc(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tE(){return Object.keys(tO)}var tj=class extends tk{constructor(t,e){let i=function(t){if(!tO[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tS+tO[t]+tB}}(e.instrument);super(t,J(Z({},e),{instrument:i}))}},tS="https://danigb.github.io/samples/vcsl/",tB=".websfz.json",tO={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tI=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tW=new WeakMap,tT=class{constructor(t){te(this,x,void 0),te(this,C,void 0),te(this,E,void 0),this.input=t.createGain(),ti(this,E,t.destination),ti(this,C,(function(t){return ts(this,null,function*(){let e=tW.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tW.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tt(this,E)),ti(this,x,t),this)))}get paramNames(){return tI}getParam(t){var e;return null==(e=tt(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tt(this,x)}ready(){return tt(this,C)}connect(t){tt(this,x)&&(tt(this,x).disconnect(tt(this,E)),tt(this,x).connect(t)),ti(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tN=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,te(this,j,void 0),te(this,S,void 0),ti(this,j,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tc}),this.player=new tP(t,tt(this,j));let o=null!=(l=e.storage)?l:t_,u="function"==typeof tt(this,j).buffers?tt(this,j).buffers:function(t,e){return(i,n)=>ts(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ts(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tl(i,a,e);t&&(n[s]=t)}}))])})}(tt(this,j).buffers,o);ti(this,S,u(t,this.player.buffers))}loaded(){return ts(this,null,function*(){return yield tt(this,S),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap,S=new WeakMap;var tR=["MusyngKite","FluidR3_GM"],tz=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tU(){return tR}function t$(){return tz}var tV=class{constructor(t,e){this.context=t,te(this,B,void 0),te(this,O,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:t_,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=to(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tP(t,e);let i=function(t,e){return(i,n)=>ts(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ts(this,null,function*(){var e;let s=th(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);ti(this,B,i(t,this.player.buffers)),ti(this,O,{status:"not-loaded"}),this.config.loopDataUrl&&(ti(this,O,{status:"loading"}),ti(this,B,Promise.all([tt(this,B),(function(t){return ts(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=th(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{ti(this,O,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,B),this})}get hasLoops(){return"loaded"===tt(this,O).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=th(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tt(this,O).status?tt(this,O).data[e]:void 0;return this.player.start(J(Z({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakMap;var tL=(a=null!=(s=ta())?N(H(s)):{},Y(s&&s.__esModule?a:R(a,"default",{value:s,enumerable:!0}),s)),tH=class{constructor(t,e){this.context=t,te(this,W),te(this,I,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tL.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tP(t,this.options);let i=function(t,e){var i;let n=null!=(i=to(["ogg","m4a"]))?i:"ogg";return(i,s)=>ts(this,null,function*(){for(let a of tq)yield Promise.all(a.samples.map(r=>ts(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tl(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);ti(this,I,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ts(this,null,function*(){return yield tt(this,I),this})}start(t){var e,i;let n="object"==typeof t?Z({},t):{note:t},s=tn(this,W,T).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};I=new WeakMap,W=new WeakSet,T=function(t){var e;let i=th(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tq.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tq[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tq=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[V(i)[0]])((n={exports:{}}).exports,n),n.exports}),tr={};function tl(t,e,i){return ts(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function to(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tu(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>("output"in t&&t.output,"input"in e&&e.input,e)),()=>{e.reduce((t,e)=>("output"in t&&t.output,"input"in e&&e.input,e))}}function th(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tc(t){return t*t/16129}function tp(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)R(t,i,{get:e[i],enumerable:!0})})(tr,{CacheStorage:()=>tb,DrumMachine:()=>tD,ElectricPiano:()=>tC,HttpStorage:()=>t_,LAYERS:()=>tq,Mallet:()=>tj,NAME_TO_PATH:()=>tO,Reverb:()=>tT,Sampler:()=>tN,Soundfont:()=>tV,SplendidGrandPiano:()=>tH,getDrumMachineNames:()=>tM,getElectricPianoNames:()=>tG,getMalletNames:()=>tE,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=Y(R({},"__esModule",{value:!0}),tr);var td=class{constructor(t,e){var i,n;this.context=t,te(this,r,void 0),te(this,l,void 0),te(this,o,void 0),te(this,u,void 0),te(this,h,void 0),te(this,c,void 0),te(this,p,!1),ti(this,c,Z({destination:t.destination,volume:100,volumeToGain:tc},e)),this.input=t.createGain(),ti(this,r,t.createGain()),ti(this,u,tu([this.input,tt(this,r),tt(this,c).destination]));let s=tp(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tc;ti(this,h,s.subscribe(t=>{tt(this,r).gain.value=a(t)}))}addInsert(t){if(tt(this,p))throw Error("Can't add insert to disconnected channel");null!=tt(this,o)||ti(this,o,[]),tt(this,o).push(t),tt(this,u).call(this),ti(this,u,tu([this.input,...tt(this,o),tt(this,r),tt(this,c).destination]))}addEffect(t,e,i){if(tt(this,p))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tu([tt(this,r),n,s]);null!=tt(this,l)||ti(this,l,[]),tt(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tt(this,p))throw Error("Can't send effect to disconnected channel");let n=null==(i=tt(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tt(this,p)||(ti(this,p,!0),tt(this,u).call(this),tt(this,h).call(this),null==(t=tt(this,l))||t.forEach(t=>t.disconnect()),ti(this,l,void 0))}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,p=new WeakMap;var tf=class{constructor(t,e){var i;this.destination=t,this.options=e,te(this,d,!1),te(this,f,void 0),this.context=t.context,this.buffers={},ti(this,f,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tc}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,m;let y;if(tt(this,d))throw Error("Can't start a sample on disconnected player");let{destination:P,context:_}=this,b=this.buffers[t.note];if(!b)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;console.log("START",{sample:t});let g=_.createBufferSource();g.buffer=b,g.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let M=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,v=M?new BiquadFilterNode(_,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,D=_.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;D.gain.value=this.velocityToGain(F),t.loop&&(g.loop=!0,g.loopStart=null!=(r=t.loopStart)?r:0,g.loopEnd=null!=(l=t.loopEnd)?l:b.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(_,w);function G(t){if(null!=t||(t=_.currentTime),t<=E)g.stop(t);else{let e=k(t);g.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(m=[tu([g,v,D,A,P]),null==(h=t.stop)?void 0:h.call(t,G),tt(this,f).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],y=!1,()=>{y||(y=!0,m.forEach(t=>null==t?void 0:t()))});g.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,_.currentTime);g.start(t.time);let j=null!=(p=t.duration)?p:b.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tt(this,f).trigger(t)}disconnect(){tt(this,d)||(ti(this,d,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tt(this,d)}};d=new WeakMap,f=new WeakMap;var tm=class{constructor(t){this.compare=t,te(this,m,[])}push(t){let e=tt(this,m).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tt(this,m)[e])?(s=e,n=e-1):i=e+1}tt(this,m).splice(s,0,t)}pop(){return tt(this,m).shift()}peek(){return tt(this,m)[0]}removeAll(t){let e=tt(this,m).length;return ti(this,m,tt(this,m).filter(e=>!t(e))),tt(this,m).length!==e}clear(){ti(this,m,[])}size(){return tt(this,m).length}};m=new WeakMap;var ty=class{constructor(t,e){this.destination=t,te(this,y,void 0),te(this,P,void 0),ti(this,y,new tm((t,e)=>t.time-e.time)),this.player=new tf(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tt(this,P)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tt(this,y).push(J(Z({},t),{time:s})),tt(this,P)||ti(this,P,setInterval(()=>{let t=i.currentTime+1;for(;tt(this,y).size()&&tt(this,y).peek().time<=t;){let t=tt(this,y).pop();t&&this.player.start(t)}tt(this,y).size()||(clearInterval(tt(this,P)),ti(this,P,void 0))},200)),e=>{(!e||e<s)&&tt(this,y).removeAll(e=>e===t)||this.player.stop(J(Z({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tt(this,y).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tt(this,y).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tt(this,y).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};y=new WeakMap,P=new WeakMap;var tP=class{constructor(t,e){this.context=t;let i=new td(t,e);this.player=new ty(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},t_={fetch:t=>fetch(t)},tb=class{constructor(t="smplr"){te(this,b),te(this,M),te(this,_,void 0),"undefined"!=typeof window&&"caches"in window?ti(this,_,caches.open(t)):ti(this,_,Promise.reject("CacheStorage not supported"))}fetch(t){return ts(this,null,function*(){let e=new Request(t);try{return yield tn(this,b,g).call(this,e)}catch(i){let t=yield fetch(e);return yield tn(this,M,v).call(this,e,t),t}})}};_=new WeakMap,b=new WeakSet,g=function(t){return ts(this,null,function*(){let e=yield tt(this,_),i=yield e.match(t);if(i)return i;throw Error("Not found")})},M=new WeakSet,v=function(t,e){return ts(this,null,function*(){try{let i=yield tt(this,_);yield i.put(t,e.clone())}catch(t){}})};var tg={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tM(){return Object.keys(tv)}var tv={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tD=class{constructor(t,e){var i,n;te(this,D,tg),te(this,F,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:t_,a=tv[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ts(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tP(t,e),this.output=this.player.output,ti(this,F,function(t,e,i,n){var s;let a=null!=(s=to(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ts(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tl(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{ti(this,D,t)})}loaded(){return ts(this,null,function*(){return yield tt(this,F),this})}get sampleNames(){return tt(this,D).sampleNames}getVariations(t){var e;return null!=(e=tt(this,D).sampleNameVariations[t])?e:[]}start(t){var e;let i=tt(this,D).nameToSample[t.note];return this.player.start(J(Z({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tF(t,e){return ts(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tw(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}D=new WeakMap,F=new WeakMap;var tA=Object.freeze({meta:{},global:{},groups:[]}),tk=class{constructor(t,e){var i;this.context=t,te(this,k),te(this,w,void 0),te(this,A,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tP(t,e),ti(this,w,tA);let n=null!=(i=e.storage)?i:t_;ti(this,A,(function(t,e){return ts(this,null,function*(){if("string"==typeof t)return tF(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tF(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(ti(this,w,Object.freeze(e)),function(t,e,i,n){return ts(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=to(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ts(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ts(this,null,function*(){if(e[s])return;let a=yield tl(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tt(this,w),n))))}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,A),this})}start(t){tn(this,k,G).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tG(){return Object.keys(tx)}w=new WeakMap,A=new WeakMap,k=new WeakSet,G=function(t){var e;let i=th(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tw(e.midi,n.lokey,n.hikey)&&tw(e.velocity,n.lovel,n.hivel)&&tw(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tw(e.midi,t.lokey,t.hikey)&&tw(e.velocity,t.lovel,t.hivel)&&tw(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tt(this,w),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(J(Z({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tx={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tC=class extends tk{constructor(t,e){var i;super(t,J(Z({},e),{instrument:null!=(i=tx[e.instrument])?i:e.instrument}));let n=tp(0);this.tremolo={level:t=>n.set(tc(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tE(){return Object.keys(tO)}var tj=class extends tk{constructor(t,e){let i=function(t){if(!tO[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tS+tO[t]+tB}}(e.instrument);super(t,J(Z({},e),{instrument:i}))}},tS="https://danigb.github.io/samples/vcsl/",tB=".websfz.json",tO={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tI=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tW=new WeakMap,tT=class{constructor(t){te(this,x,void 0),te(this,C,void 0),te(this,E,void 0),this.input=t.createGain(),ti(this,E,t.destination),ti(this,C,(function(t){return ts(this,null,function*(){let e=tW.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tW.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tt(this,E)),ti(this,x,t),this)))}get paramNames(){return tI}getParam(t){var e;return null==(e=tt(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tt(this,x)}ready(){return tt(this,C)}connect(t){tt(this,x)&&(tt(this,x).disconnect(tt(this,E)),tt(this,x).connect(t)),ti(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tN=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,te(this,j,void 0),te(this,S,void 0),ti(this,j,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tc}),this.player=new tP(t,tt(this,j));let o=null!=(l=e.storage)?l:t_,u="function"==typeof tt(this,j).buffers?tt(this,j).buffers:function(t,e){return(i,n)=>ts(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ts(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tl(i,a,e);t&&(n[s]=t)}}))])})}(tt(this,j).buffers,o);ti(this,S,u(t,this.player.buffers))}loaded(){return ts(this,null,function*(){return yield tt(this,S),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap,S=new WeakMap;var tR=["MusyngKite","FluidR3_GM"],tz=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tU(){return tR}function t$(){return tz}var tV=class{constructor(t,e){this.context=t,te(this,B,void 0),te(this,O,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:t_,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=to(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tP(t,e);let i=function(t,e){return(i,n)=>ts(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ts(this,null,function*(){var e;let s=th(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);ti(this,B,i(t,this.player.buffers)),ti(this,O,{status:"not-loaded"}),this.config.loopDataUrl&&(ti(this,O,{status:"loading"}),ti(this,B,Promise.all([tt(this,B),(function(t){return ts(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=th(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{ti(this,O,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,B),this})}get hasLoops(){return"loaded"===tt(this,O).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=th(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tt(this,O).status?tt(this,O).data[e]:void 0;return this.player.start(J(Z({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakMap;var tL=(a=null!=(s=ta())?N(H(s)):{},Y(s&&s.__esModule?a:R(a,"default",{value:s,enumerable:!0}),s)),tH=class{constructor(t,e){this.context=t,te(this,W),te(this,I,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tL.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tP(t,this.options);let i=function(t,e){var i;let n=null!=(i=to(["ogg","m4a"]))?i:"ogg";return(i,s)=>ts(this,null,function*(){for(let a of tq)yield Promise.all(a.samples.map(r=>ts(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tl(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);ti(this,I,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ts(this,null,function*(){return yield tt(this,I),this})}start(t){var e,i;let n="object"==typeof t?Z({},t):{note:t},s=tn(this,W,T).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};I=new WeakMap,W=new WeakSet,T=function(t){var e;let i=th(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tq.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tq[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tq=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[V(i)[0]])((n={exports:{}}).exports,n),n.exports}),tr={};function tl(t,e,i){return ts(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function to(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tu(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>("output"in t&&t.output,"input"in e&&e.input,e)),()=>{e.reduce((t,e)=>("output"in t&&t.output,"input"in e&&e.input,e))}}function th(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tc(t){return t*t/16129}function tp(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)R(t,i,{get:e[i],enumerable:!0})})(tr,{CacheStorage:()=>tb,DrumMachine:()=>tD,ElectricPiano:()=>tC,HttpStorage:()=>t_,LAYERS:()=>tq,Mallet:()=>tj,NAME_TO_PATH:()=>tO,Reverb:()=>tT,Sampler:()=>tN,Soundfont:()=>tV,SplendidGrandPiano:()=>tH,getDrumMachineNames:()=>tM,getElectricPianoNames:()=>tG,getMalletNames:()=>tE,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=Y(R({},"__esModule",{value:!0}),tr);var td=class{constructor(t,e){var i,n;this.context=t,te(this,r,void 0),te(this,l,void 0),te(this,o,void 0),te(this,u,void 0),te(this,h,void 0),te(this,c,void 0),te(this,p,!1),ti(this,c,Z({destination:t.destination,volume:100,volumeToGain:tc},e)),this.input=t.createGain(),ti(this,r,t.createGain()),ti(this,u,tu([this.input,tt(this,r),tt(this,c).destination]));let s=tp(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tc;ti(this,h,s.subscribe(t=>{tt(this,r).gain.value=a(t)}))}addInsert(t){if(tt(this,p))throw Error("Can't add insert to disconnected channel");null!=tt(this,o)||ti(this,o,[]),tt(this,o).push(t),tt(this,u).call(this),ti(this,u,tu([this.input,...tt(this,o),tt(this,r),tt(this,c).destination]))}addEffect(t,e,i){if(tt(this,p))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tu([tt(this,r),n,s]);null!=tt(this,l)||ti(this,l,[]),tt(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tt(this,p))throw Error("Can't send effect to disconnected channel");let n=null==(i=tt(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tt(this,p)||(ti(this,p,!0),tt(this,u).call(this),tt(this,h).call(this),null==(t=tt(this,l))||t.forEach(t=>t.disconnect()),ti(this,l,void 0))}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,p=new WeakMap;var tf=class{constructor(t,e){var i;this.destination=t,this.options=e,te(this,d,!1),te(this,f,void 0),this.context=t.context,this.buffers={},ti(this,f,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tc}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,m;let y;if(tt(this,d))throw Error("Can't start a sample on disconnected player");let{destination:P,context:_}=this,b=this.buffers[t.note];if(!b)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;console.log("START",{sample:t,buffer:b});let g=_.createBufferSource();g.buffer=b,g.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let M=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,v=M?new BiquadFilterNode(_,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,D=_.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;D.gain.value=this.velocityToGain(F),t.loop&&(g.loop=!0,g.loopStart=null!=(r=t.loopStart)?r:0,g.loopEnd=null!=(l=t.loopEnd)?l:b.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(_,w);function G(t){if(null!=t||(t=_.currentTime),t<=E)g.stop(t);else{let e=k(t);g.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(m=[tu([g,v,D,A,P]),null==(h=t.stop)?void 0:h.call(t,G),tt(this,f).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],y=!1,()=>{y||(y=!0,m.forEach(t=>null==t?void 0:t()))});g.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,_.currentTime);g.start(t.time);let j=null!=(p=t.duration)?p:b.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tt(this,f).trigger(t)}disconnect(){tt(this,d)||(ti(this,d,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tt(this,d)}};d=new WeakMap,f=new WeakMap;var tm=class{constructor(t){this.compare=t,te(this,m,[])}push(t){let e=tt(this,m).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tt(this,m)[e])?(s=e,n=e-1):i=e+1}tt(this,m).splice(s,0,t)}pop(){return tt(this,m).shift()}peek(){return tt(this,m)[0]}removeAll(t){let e=tt(this,m).length;return ti(this,m,tt(this,m).filter(e=>!t(e))),tt(this,m).length!==e}clear(){ti(this,m,[])}size(){return tt(this,m).length}};m=new WeakMap;var ty=class{constructor(t,e){this.destination=t,te(this,y,void 0),te(this,P,void 0),ti(this,y,new tm((t,e)=>t.time-e.time)),this.player=new tf(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tt(this,P)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tt(this,y).push(J(Z({},t),{time:s})),tt(this,P)||ti(this,P,setInterval(()=>{let t=i.currentTime+1;for(;tt(this,y).size()&&tt(this,y).peek().time<=t;){let t=tt(this,y).pop();t&&this.player.start(t)}tt(this,y).size()||(clearInterval(tt(this,P)),ti(this,P,void 0))},200)),e=>{(!e||e<s)&&tt(this,y).removeAll(e=>e===t)||this.player.stop(J(Z({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tt(this,y).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tt(this,y).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tt(this,y).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};y=new WeakMap,P=new WeakMap;var tP=class{constructor(t,e){this.context=t;let i=new td(t,e);this.player=new ty(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},t_={fetch:t=>fetch(t)},tb=class{constructor(t="smplr"){te(this,b),te(this,M),te(this,_,void 0),"undefined"!=typeof window&&"caches"in window?ti(this,_,caches.open(t)):ti(this,_,Promise.reject("CacheStorage not supported"))}fetch(t){return ts(this,null,function*(){let e=new Request(t);try{return yield tn(this,b,g).call(this,e)}catch(i){let t=yield fetch(e);return yield tn(this,M,v).call(this,e,t),t}})}};_=new WeakMap,b=new WeakSet,g=function(t){return ts(this,null,function*(){let e=yield tt(this,_),i=yield e.match(t);if(i)return i;throw Error("Not found")})},M=new WeakSet,v=function(t,e){return ts(this,null,function*(){try{let i=yield tt(this,_);yield i.put(t,e.clone())}catch(t){}})};var tg={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tM(){return Object.keys(tv)}var tv={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tD=class{constructor(t,e){var i,n;te(this,D,tg),te(this,F,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:t_,a=tv[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ts(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tP(t,e),this.output=this.player.output,ti(this,F,function(t,e,i,n){var s;let a=null!=(s=to(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ts(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tl(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{ti(this,D,t)})}loaded(){return ts(this,null,function*(){return yield tt(this,F),this})}get sampleNames(){return tt(this,D).sampleNames}getVariations(t){var e;return null!=(e=tt(this,D).sampleNameVariations[t])?e:[]}start(t){var e;let i=tt(this,D).nameToSample[t.note];return this.player.start(J(Z({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tF(t,e){return ts(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tw(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}D=new WeakMap,F=new WeakMap;var tA=Object.freeze({meta:{},global:{},groups:[]}),tk=class{constructor(t,e){var i;this.context=t,te(this,k),te(this,w,void 0),te(this,A,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tP(t,e),ti(this,w,tA);let n=null!=(i=e.storage)?i:t_;ti(this,A,(function(t,e){return ts(this,null,function*(){if("string"==typeof t)return tF(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tF(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(ti(this,w,Object.freeze(e)),function(t,e,i,n){return ts(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=to(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ts(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ts(this,null,function*(){if(e[s])return;let a=yield tl(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tt(this,w),n))))}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,A),this})}start(t){tn(this,k,G).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tG(){return Object.keys(tx)}w=new WeakMap,A=new WeakMap,k=new WeakSet,G=function(t){var e;let i=th(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tw(e.midi,n.lokey,n.hikey)&&tw(e.velocity,n.lovel,n.hivel)&&tw(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tw(e.midi,t.lokey,t.hikey)&&tw(e.velocity,t.lovel,t.hivel)&&tw(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tt(this,w),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(J(Z({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tx={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tC=class extends tk{constructor(t,e){var i;super(t,J(Z({},e),{instrument:null!=(i=tx[e.instrument])?i:e.instrument}));let n=tp(0);this.tremolo={level:t=>n.set(tc(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tE(){return Object.keys(tO)}var tj=class extends tk{constructor(t,e){let i=function(t){if(!tO[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tS+tO[t]+tB}}(e.instrument);super(t,J(Z({},e),{instrument:i}))}},tS="https://danigb.github.io/samples/vcsl/",tB=".websfz.json",tO={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tI=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tW=new WeakMap,tT=class{constructor(t){te(this,x,void 0),te(this,C,void 0),te(this,E,void 0),this.input=t.createGain(),ti(this,E,t.destination),ti(this,C,(function(t){return ts(this,null,function*(){let e=tW.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tW.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tt(this,E)),ti(this,x,t),this)))}get paramNames(){return tI}getParam(t){var e;return null==(e=tt(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tt(this,x)}ready(){return tt(this,C)}connect(t){tt(this,x)&&(tt(this,x).disconnect(tt(this,E)),tt(this,x).connect(t)),ti(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tN=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,te(this,j,void 0),te(this,S,void 0),ti(this,j,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tc}),this.player=new tP(t,tt(this,j));let o=null!=(l=e.storage)?l:t_,u="function"==typeof tt(this,j).buffers?tt(this,j).buffers:function(t,e){return(i,n)=>ts(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ts(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tl(i,a,e);t&&(n[s]=t)}}))])})}(tt(this,j).buffers,o);ti(this,S,u(t,this.player.buffers))}loaded(){return ts(this,null,function*(){return yield tt(this,S),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap,S=new WeakMap;var tR=["MusyngKite","FluidR3_GM"],tz=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tU(){return tR}function t$(){return tz}var tV=class{constructor(t,e){this.context=t,te(this,B,void 0),te(this,O,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:t_,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=to(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tP(t,e);let i=function(t,e){return(i,n)=>ts(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ts(this,null,function*(){var e;let s=th(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);ti(this,B,i(t,this.player.buffers)),ti(this,O,{status:"not-loaded"}),this.config.loopDataUrl&&(ti(this,O,{status:"loading"}),ti(this,B,Promise.all([tt(this,B),(function(t){return ts(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=th(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{ti(this,O,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,B),this})}get hasLoops(){return"loaded"===tt(this,O).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=th(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tt(this,O).status?tt(this,O).data[e]:void 0;return this.player.start(J(Z({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakMap;var tL=(a=null!=(s=ta())?N(H(s)):{},Y(s&&s.__esModule?a:R(a,"default",{value:s,enumerable:!0}),s)),tH=class{constructor(t,e){this.context=t,te(this,W),te(this,I,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tL.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tP(t,this.options);let i=function(t,e){var i;let n=null!=(i=to(["ogg","m4a"]))?i:"ogg";return(i,s)=>ts(this,null,function*(){for(let a of tq)yield Promise.all(a.samples.map(r=>ts(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tl(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);ti(this,I,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ts(this,null,function*(){return yield tt(this,I),this})}start(t){var e,i;let n="object"==typeof t?Z({},t):{note:t},s=tn(this,W,T).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};I=new WeakMap,W=new WeakSet,T=function(t){var e;let i=th(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tq.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tq[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tq=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[V(i)[0]])((n={exports:{}}).exports,n),n.exports}),tr={};function tl(t,e,i){return ts(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function to(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tu(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function th(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tc(t){return t*t/16129}function tp(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)R(t,i,{get:e[i],enumerable:!0})})(tr,{CacheStorage:()=>tb,DrumMachine:()=>tD,ElectricPiano:()=>tC,HttpStorage:()=>t_,LAYERS:()=>tq,Mallet:()=>tj,NAME_TO_PATH:()=>tO,Reverb:()=>tT,Sampler:()=>tN,Soundfont:()=>tV,SplendidGrandPiano:()=>tH,getDrumMachineNames:()=>tM,getElectricPianoNames:()=>tG,getMalletNames:()=>tE,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=Y(R({},"__esModule",{value:!0}),tr);var td=class{constructor(t,e){var i,n;this.context=t,te(this,r,void 0),te(this,l,void 0),te(this,o,void 0),te(this,u,void 0),te(this,h,void 0),te(this,c,void 0),te(this,p,!1),ti(this,c,Z({destination:t.destination,volume:100,volumeToGain:tc},e)),this.input=t.createGain(),ti(this,r,t.createGain()),ti(this,u,tu([this.input,tt(this,r),tt(this,c).destination]));let s=tp(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tc;ti(this,h,s.subscribe(t=>{tt(this,r).gain.value=a(t)}))}addInsert(t){if(tt(this,p))throw Error("Can't add insert to disconnected channel");null!=tt(this,o)||ti(this,o,[]),tt(this,o).push(t),tt(this,u).call(this),ti(this,u,tu([this.input,...tt(this,o),tt(this,r),tt(this,c).destination]))}addEffect(t,e,i){if(tt(this,p))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tu([tt(this,r),n,s]);null!=tt(this,l)||ti(this,l,[]),tt(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tt(this,p))throw Error("Can't send effect to disconnected channel");let n=null==(i=tt(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tt(this,p)||(ti(this,p,!0),tt(this,u).call(this),tt(this,h).call(this),null==(t=tt(this,l))||t.forEach(t=>t.disconnect()),ti(this,l,void 0))}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,p=new WeakMap;var tf=class{constructor(t,e){var i;this.destination=t,this.options=e,te(this,d,!1),te(this,f,void 0),this.context=t.context,this.buffers={},ti(this,f,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tc}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,m;let y;if(tt(this,d))throw Error("Can't start a sample on disconnected player");let{destination:P,context:_}=this,b=this.buffers[t.note];if(!b)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;console.log("START",{sample:t,buffer:b});let g=_.createBufferSource();g.buffer=b,g.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let M=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,v=M?new BiquadFilterNode(_,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,D=_.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;D.gain.value=this.velocityToGain(F),t.loop&&(g.loop=!0,g.loopStart=null!=(r=t.loopStart)?r:0,g.loopEnd=null!=(l=t.loopEnd)?l:b.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(_,w);function G(t){if(null!=t||(t=_.currentTime),t<=E)g.stop(t);else{let e=k(t);g.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(m=[tu([g,v,D,A,P]),null==(h=t.stop)?void 0:h.call(t,G),tt(this,f).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],y=!1,()=>{y||(y=!0,m.forEach(t=>null==t?void 0:t()))});g.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,_.currentTime);g.start(t.time);let j=null!=(p=t.duration)?p:b.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tt(this,f).trigger(t)}disconnect(){tt(this,d)||(ti(this,d,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tt(this,d)}};d=new WeakMap,f=new WeakMap;var tm=class{constructor(t){this.compare=t,te(this,m,[])}push(t){let e=tt(this,m).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tt(this,m)[e])?(s=e,n=e-1):i=e+1}tt(this,m).splice(s,0,t)}pop(){return tt(this,m).shift()}peek(){return tt(this,m)[0]}removeAll(t){let e=tt(this,m).length;return ti(this,m,tt(this,m).filter(e=>!t(e))),tt(this,m).length!==e}clear(){ti(this,m,[])}size(){return tt(this,m).length}};m=new WeakMap;var ty=class{constructor(t,e){this.destination=t,te(this,y,void 0),te(this,P,void 0),ti(this,y,new tm((t,e)=>t.time-e.time)),this.player=new tf(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tt(this,P)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tt(this,y).push(J(Z({},t),{time:s})),tt(this,P)||ti(this,P,setInterval(()=>{let t=i.currentTime+1;for(;tt(this,y).size()&&tt(this,y).peek().time<=t;){let t=tt(this,y).pop();t&&this.player.start(t)}tt(this,y).size()||(clearInterval(tt(this,P)),ti(this,P,void 0))},200)),e=>{(!e||e<s)&&tt(this,y).removeAll(e=>e===t)||this.player.stop(J(Z({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tt(this,y).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tt(this,y).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tt(this,y).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};y=new WeakMap,P=new WeakMap;var tP=class{constructor(t,e){this.context=t;let i=new td(t,e);this.player=new ty(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},t_={fetch:t=>fetch(t)},tb=class{constructor(t="smplr"){te(this,b),te(this,M),te(this,_,void 0),"undefined"!=typeof window&&"caches"in window?ti(this,_,caches.open(t)):ti(this,_,Promise.reject("CacheStorage not supported"))}fetch(t){return ts(this,null,function*(){let e=new Request(t);try{return yield tn(this,b,g).call(this,e)}catch(i){let t=yield fetch(e);return yield tn(this,M,v).call(this,e,t),t}})}};_=new WeakMap,b=new WeakSet,g=function(t){return ts(this,null,function*(){let e=yield tt(this,_),i=yield e.match(t);if(i)return i;throw Error("Not found")})},M=new WeakSet,v=function(t,e){return ts(this,null,function*(){try{let i=yield tt(this,_);yield i.put(t,e.clone())}catch(t){}})};var tg={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tM(){return Object.keys(tv)}var tv={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tD=class{constructor(t,e){var i,n;te(this,D,tg),te(this,F,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:t_,a=tv[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ts(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tP(t,e),this.output=this.player.output,ti(this,F,function(t,e,i,n){var s;let a=null!=(s=to(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ts(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tl(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{ti(this,D,t)})}loaded(){return ts(this,null,function*(){return yield tt(this,F),this})}get sampleNames(){return tt(this,D).sampleNames}getVariations(t){var e;return null!=(e=tt(this,D).sampleNameVariations[t])?e:[]}start(t){var e;let i=tt(this,D).nameToSample[t.note];return this.player.start(J(Z({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tF(t,e){return ts(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tw(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}D=new WeakMap,F=new WeakMap;var tA=Object.freeze({meta:{},global:{},groups:[]}),tk=class{constructor(t,e){var i;this.context=t,te(this,k),te(this,w,void 0),te(this,A,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tP(t,e),ti(this,w,tA);let n=null!=(i=e.storage)?i:t_;ti(this,A,(function(t,e){return ts(this,null,function*(){if("string"==typeof t)return tF(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tF(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(ti(this,w,Object.freeze(e)),function(t,e,i,n){return ts(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=to(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ts(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ts(this,null,function*(){if(e[s])return;let a=yield tl(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tt(this,w),n))))}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,A),this})}start(t){tn(this,k,G).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tG(){return Object.keys(tx)}w=new WeakMap,A=new WeakMap,k=new WeakSet,G=function(t){var e;let i=th(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tw(e.midi,n.lokey,n.hikey)&&tw(e.velocity,n.lovel,n.hivel)&&tw(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tw(e.midi,t.lokey,t.hikey)&&tw(e.velocity,t.lovel,t.hivel)&&tw(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tt(this,w),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(J(Z({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tx={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tC=class extends tk{constructor(t,e){var i;super(t,J(Z({},e),{instrument:null!=(i=tx[e.instrument])?i:e.instrument}));let n=tp(0);this.tremolo={level:t=>n.set(tc(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tE(){return Object.keys(tO)}var tj=class extends tk{constructor(t,e){let i=function(t){if(!tO[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tS+tO[t]+tB}}(e.instrument);super(t,J(Z({},e),{instrument:i}))}},tS="https://danigb.github.io/samples/vcsl/",tB=".websfz.json",tO={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tI=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tW=new WeakMap,tT=class{constructor(t){te(this,x,void 0),te(this,C,void 0),te(this,E,void 0),this.input=t.createGain(),ti(this,E,t.destination),ti(this,C,(function(t){return ts(this,null,function*(){let e=tW.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tW.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tt(this,E)),ti(this,x,t),this)))}get paramNames(){return tI}getParam(t){var e;return null==(e=tt(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tt(this,x)}ready(){return tt(this,C)}connect(t){tt(this,x)&&(tt(this,x).disconnect(tt(this,E)),tt(this,x).connect(t)),ti(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tN=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,te(this,j,void 0),te(this,S,void 0),ti(this,j,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tc}),this.player=new tP(t,tt(this,j));let o=null!=(l=e.storage)?l:t_,u="function"==typeof tt(this,j).buffers?tt(this,j).buffers:function(t,e){return(i,n)=>ts(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ts(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tl(i,a,e);t&&(n[s]=t)}}))])})}(tt(this,j).buffers,o);ti(this,S,u(t,this.player.buffers))}loaded(){return ts(this,null,function*(){return yield tt(this,S),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap,S=new WeakMap;var tR=["MusyngKite","FluidR3_GM"],tz=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tU(){return tR}function t$(){return tz}var tV=class{constructor(t,e){this.context=t,te(this,B,void 0),te(this,O,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:t_,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=to(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tP(t,e);let i=function(t,e){return(i,n)=>ts(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ts(this,null,function*(){var e;let s=th(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);ti(this,B,i(t,this.player.buffers)),ti(this,O,{status:"not-loaded"}),this.config.loopDataUrl&&(ti(this,O,{status:"loading"}),ti(this,B,Promise.all([tt(this,B),(function(t){return ts(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=th(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{ti(this,O,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,B),this})}get hasLoops(){return"loaded"===tt(this,O).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=th(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tt(this,O).status?tt(this,O).data[e]:void 0;return this.player.start(J(Z({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakMap;var tL=(a=null!=(s=ta())?N(H(s)):{},Y(s&&s.__esModule?a:R(a,"default",{value:s,enumerable:!0}),s)),tH=class{constructor(t,e){this.context=t,te(this,W),te(this,I,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tL.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tP(t,this.options);let i=function(t,e){var i;let n=null!=(i=to(["ogg","m4a"]))?i:"ogg";return(i,s)=>ts(this,null,function*(){for(let a of tq)yield Promise.all(a.samples.map(r=>ts(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tl(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);ti(this,I,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ts(this,null,function*(){return yield tt(this,I),this})}start(t){var e,i;let n="object"==typeof t?Z({},t):{note:t},s=tn(this,W,T).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};I=new WeakMap,W=new WeakSet,T=function(t){var e;let i=th(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tq.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tq[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tq=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return n||(0,i[V(i)[0]])((n={exports:{}}).exports,n),n.exports}),tr={};function tl(t,e,i){return ts(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function to(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tu(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function th(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tc(t){return t*t/16129}function tp(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}((t,e)=>{for(var i in e)R(t,i,{get:e[i],enumerable:!0})})(tr,{CacheStorage:()=>tb,DrumMachine:()=>tD,ElectricPiano:()=>tC,HttpStorage:()=>t_,LAYERS:()=>tq,Mallet:()=>tj,NAME_TO_PATH:()=>tO,Reverb:()=>tT,Sampler:()=>tN,Soundfont:()=>tV,SplendidGrandPiano:()=>tH,getDrumMachineNames:()=>tM,getElectricPianoNames:()=>tG,getMalletNames:()=>tE,getSoundfontKits:()=>tU,getSoundfontNames:()=>t$}),e.exports=Y(R({},"__esModule",{value:!0}),tr);var td=class{constructor(t,e){var i,n;this.context=t,te(this,r,void 0),te(this,l,void 0),te(this,o,void 0),te(this,u,void 0),te(this,h,void 0),te(this,c,void 0),te(this,p,!1),ti(this,c,Z({destination:t.destination,volume:100,volumeToGain:tc},e)),this.input=t.createGain(),ti(this,r,t.createGain()),ti(this,u,tu([this.input,tt(this,r),tt(this,c).destination]));let s=tp(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tc;ti(this,h,s.subscribe(t=>{tt(this,r).gain.value=a(t)}))}addInsert(t){if(tt(this,p))throw Error("Can't add insert to disconnected channel");null!=tt(this,o)||ti(this,o,[]),tt(this,o).push(t),tt(this,u).call(this),ti(this,u,tu([this.input,...tt(this,o),tt(this,r),tt(this,c).destination]))}addEffect(t,e,i){if(tt(this,p))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tu([tt(this,r),n,s]);null!=tt(this,l)||ti(this,l,[]),tt(this,l).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tt(this,p))throw Error("Can't send effect to disconnected channel");let n=null==(i=tt(this,l))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tt(this,p)||(ti(this,p,!0),tt(this,u).call(this),tt(this,h).call(this),null==(t=tt(this,l))||t.forEach(t=>t.disconnect()),ti(this,l,void 0))}};r=new WeakMap,l=new WeakMap,o=new WeakMap,u=new WeakMap,h=new WeakMap,c=new WeakMap,p=new WeakMap;var tf=class{constructor(t,e){var i;this.destination=t,this.options=e,te(this,d,!1),te(this,f,void 0),this.context=t.context,this.buffers={},ti(this,f,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tc}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,m;let y;if(tt(this,d))throw Error("Can't start a sample on disconnected player");let{destination:P,context:_}=this,b=this.buffers[t.note];if(!b)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let g=_.createBufferSource();g.buffer=b,g.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let M=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,v=M?new BiquadFilterNode(_,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,D=_.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;D.gain.value=this.velocityToGain(F),t.loop&&(g.loop=!0,g.loopStart=null!=(r=t.loopStart)?r:0,g.loopEnd=null!=(l=t.loopEnd)?l:b.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(_,w);function G(t){if(null!=t||(t=_.currentTime),t<=E)g.stop(t);else{let e=k(t);g.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(m=[tu([g,v,D,A,P]),null==(h=t.stop)?void 0:h.call(t,G),tt(this,f).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],y=!1,()=>{y||(y=!0,m.forEach(t=>null==t?void 0:t()))});g.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,_.currentTime);g.start(t.time);let j=null!=(p=t.duration)?p:b.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tt(this,f).trigger(t)}disconnect(){tt(this,d)||(ti(this,d,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tt(this,d)}};d=new WeakMap,f=new WeakMap;var tm=class{constructor(t){this.compare=t,te(this,m,[])}push(t){let e=tt(this,m).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tt(this,m)[e])?(s=e,n=e-1):i=e+1}tt(this,m).splice(s,0,t)}pop(){return tt(this,m).shift()}peek(){return tt(this,m)[0]}removeAll(t){let e=tt(this,m).length;return ti(this,m,tt(this,m).filter(e=>!t(e))),tt(this,m).length!==e}clear(){ti(this,m,[])}size(){return tt(this,m).length}};m=new WeakMap;var ty=class{constructor(t,e){this.destination=t,te(this,y,void 0),te(this,P,void 0),ti(this,y,new tm((t,e)=>t.time-e.time)),this.player=new tf(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tt(this,P)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tt(this,y).push(J(Z({},t),{time:s})),tt(this,P)||ti(this,P,setInterval(()=>{let t=i.currentTime+1;for(;tt(this,y).size()&&tt(this,y).peek().time<=t;){let t=tt(this,y).pop();t&&this.player.start(t)}tt(this,y).size()||(clearInterval(tt(this,P)),ti(this,P,void 0))},200)),e=>{(!e||e<s)&&tt(this,y).removeAll(e=>e===t)||this.player.stop(J(Z({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tt(this,y).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tt(this,y).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tt(this,y).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};y=new WeakMap,P=new WeakMap;var tP=class{constructor(t,e){this.context=t;let i=new td(t,e);this.player=new ty(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},t_={fetch:t=>fetch(t)},tb=class{constructor(t="smplr"){te(this,b),te(this,M),te(this,_,void 0),"undefined"!=typeof window&&"caches"in window?ti(this,_,caches.open(t)):ti(this,_,Promise.reject("CacheStorage not supported"))}fetch(t){return ts(this,null,function*(){let e=new Request(t);try{return yield tn(this,b,g).call(this,e)}catch(i){let t=yield fetch(e);return yield tn(this,M,v).call(this,e,t),t}})}};_=new WeakMap,b=new WeakSet,g=function(t){return ts(this,null,function*(){let e=yield tt(this,_),i=yield e.match(t);if(i)return i;throw Error("Not found")})},M=new WeakSet,v=function(t,e){return ts(this,null,function*(){try{let i=yield tt(this,_);yield i.put(t,e.clone())}catch(t){}})};var tg={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tM(){return Object.keys(tv)}var tv={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tD=class{constructor(t,e){var i,n;te(this,D,tg),te(this,F,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:t_,a=tv[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ts(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tP(t,e),this.output=this.player.output,ti(this,F,function(t,e,i,n){var s;let a=null!=(s=to(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ts(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield tl(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{ti(this,D,t)})}loaded(){return ts(this,null,function*(){return yield tt(this,F),this})}get sampleNames(){return tt(this,D).sampleNames}getVariations(t){var e;return null!=(e=tt(this,D).sampleNameVariations[t])?e:[]}start(t){var e;let i=tt(this,D).nameToSample[t.note];return this.player.start(J(Z({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tF(t,e){return ts(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tw(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}D=new WeakMap,F=new WeakMap;var tA=Object.freeze({meta:{},global:{},groups:[]}),tk=class{constructor(t,e){var i;this.context=t,te(this,k),te(this,w,void 0),te(this,A,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tP(t,e),ti(this,w,tA);let n=null!=(i=e.storage)?i:t_;ti(this,A,(function(t,e){return ts(this,null,function*(){if("string"==typeof t)return tF(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tF(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(ti(this,w,Object.freeze(e)),function(t,e,i,n){return ts(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=to(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ts(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ts(this,null,function*(){if(e[s])return;let a=yield tl(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tt(this,w),n))))}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,A),this})}start(t){tn(this,k,G).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};function tG(){return Object.keys(tx)}w=new WeakMap,A=new WeakMap,k=new WeakSet,G=function(t){var e;let i=th(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tw(e.midi,n.lokey,n.hikey)&&tw(e.velocity,n.lovel,n.hivel)&&tw(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tw(e.midi,t.lokey,t.hikey)&&tw(e.velocity,t.lovel,t.hivel)&&tw(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tt(this,w),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(J(Z({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tx={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tC=class extends tk{constructor(t,e){var i;super(t,J(Z({},e),{instrument:null!=(i=tx[e.instrument])?i:e.instrument}));let n=tp(0);this.tremolo={level:t=>n.set(tc(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}};function tE(){return Object.keys(tO)}var tj=class extends tk{constructor(t,e){let i=function(t){if(!tO[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tS+tO[t]+tB}}(e.instrument);super(t,J(Z({},e),{instrument:i}))}},tS="https://danigb.github.io/samples/vcsl/",tB=".websfz.json",tO={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tI=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tW=new WeakMap,tT=class{constructor(t){te(this,x,void 0),te(this,C,void 0),te(this,E,void 0),this.input=t.createGain(),ti(this,E,t.destination),ti(this,C,(function(t){return ts(this,null,function*(){let e=tW.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tW.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tt(this,E)),ti(this,x,t),this)))}get paramNames(){return tI}getParam(t){var e;return null==(e=tt(this,x))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tt(this,x)}ready(){return tt(this,C)}connect(t){tt(this,x)&&(tt(this,x).disconnect(tt(this,E)),tt(this,x).connect(t)),ti(this,E,t)}};x=new WeakMap,C=new WeakMap,E=new WeakMap;var tN=class{constructor(t,e={}){var i,n,s,a,r,l;this.context=t,te(this,j,void 0),te(this,S,void 0),ti(this,j,{destination:null!=(i=e.destination)?i:t.destination,detune:0,volume:null!=(n=e.volume)?n:100,velocity:null!=(s=e.velocity)?s:100,buffers:null!=(a=e.buffers)?a:{},volumeToGain:null!=(r=e.volumeToGain)?r:tc}),this.player=new tP(t,tt(this,j));let o=null!=(l=e.storage)?l:t_,u="function"==typeof tt(this,j).buffers?tt(this,j).buffers:function(t,e){return(i,n)=>ts(this,null,function*(){yield Promise.all([Object.keys(t).map(s=>ts(this,null,function*(){let a=t[s];if(a instanceof AudioBuffer)n[s]=a;else if("string"==typeof a){let t=yield tl(i,a,e);t&&(n[s]=t)}}))])})}(tt(this,j).buffers,o);ti(this,S,u(t,this.player.buffers))}loaded(){return ts(this,null,function*(){return yield tt(this,S),this})}get output(){return this.player.output}start(t){return this.player.start("object"==typeof t?t:{note:t})}stop(t){return this.player.stop("object"==typeof t?t:void 0===t?void 0:{stopId:t})}disconnect(){return this.player.disconnect()}};j=new WeakMap,S=new WeakMap;var tR=["MusyngKite","FluidR3_GM"],tz=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function tU(){return tR}function t$(){return tz}var tV=class{constructor(t,e){this.context=t,te(this,B,void 0),te(this,O,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:t_,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=to(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tP(t,e);let i=function(t,e){return(i,n)=>ts(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ts(this,null,function*(){var e;let s=th(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);ti(this,B,i(t,this.player.buffers)),ti(this,O,{status:"not-loaded"}),this.config.loopDataUrl&&(ti(this,O,{status:"loading"}),ti(this,B,Promise.all([tt(this,B),(function(t){return ts(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=th(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{ti(this,O,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ts(this,null,function*(){return yield tt(this,B),this})}get hasLoops(){return"loaded"===tt(this,O).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=th(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tt(this,O).status?tt(this,O).data[e]:void 0;return this.player.start(J(Z({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};B=new WeakMap,O=new WeakMap;var tL=(a=null!=(s=ta())?N(H(s)):{},Y(s&&s.__esModule?a:R(a,"default",{value:s,enumerable:!0}),s)),tH=class{constructor(t,e){this.context=t,te(this,W),te(this,I,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tL.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tP(t,this.options);let i=function(t,e){var i;let n=null!=(i=to(["ogg","m4a"]))?i:"ogg";return(i,s)=>ts(this,null,function*(){for(let a of tq)yield Promise.all(a.samples.map(r=>ts(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield tl(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);ti(this,I,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ts(this,null,function*(){return yield tt(this,I),this})}start(t){var e,i;let n="object"==typeof t?Z({},t):{note:t},s=tn(this,W,T).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};I=new WeakMap,W=new WeakSet,T=function(t){var e;let i=th(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tq.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tq[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tq=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}]}},function(){return p||(0,c[tn(c)[0]])((p={exports:{}}).exports,p),p.exports});function t_(t,e,i){return ty(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");let n=yield i.fetch(e);if(200!==n.status){console.warn("Error loading buffer. Invalid status: ",n.status,e);return}try{let e=yield n.arrayBuffer(),i=yield t.decodeAudioData(e);return i}catch(t){console.warn("Error loading buffer",t,e)}})}function tb(t){if("undefined"==typeof document)return null;let e=document.createElement("audio");for(let i=0;i<t.length;i++){let n=t[i],s=e.canPlayType(`audio/${n}`);if("probably"===s||"maybe"===s)return n;if("m4a"===n){let t=e.canPlayType("audio/aac");if("probably"===t||"maybe"===t)return n}}return null}function tg(t){let e=t.filter(t=>!!t);return e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.connect(n),e}),()=>{e.reduce((t,e)=>{let i="output"in t?t.output:t,n="input"in e?e.input:e;return i.disconnect(n),e})}}function tM(t){return void 0===t?void 0:"number"==typeof t?t:function(t){let e=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!e)return;let i=e[1].toUpperCase();if(!i)return;let n=e[2],s="b"===n[0]?-n.length:n.length,a=e[3]?+e[3]:4,r=(i.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][r]+s+12*(a+1)}(t)}function tv(t){return t*t/16129}function tD(t){let e=t,i=new Set;return{subscribe:function(t){return i.add(t),t(e),()=>{i.delete(t)}},set:function(t){e=t,i.forEach(t=>t(e))},get:function(){return e}}}var tF=class{constructor(t,e){var i,n;this.context=t,td(this,m,void 0),td(this,y,void 0),td(this,P,void 0),td(this,_,void 0),td(this,b,void 0),td(this,g,void 0),td(this,M,!1),tf(this,g,tu({destination:t.destination,volume:100,volumeToGain:tv},e)),this.input=t.createGain(),tf(this,m,t.createGain()),tf(this,_,tg([this.input,tp(this,m),tp(this,g).destination]));let s=tD(null!=(i=e.volume)?i:100);this.setVolume=s.set;let a=null!=(n=e.volumeToGain)?n:tv;tf(this,b,s.subscribe(t=>{tp(this,m).gain.value=a(t)}))}addInsert(t){if(tp(this,M))throw Error("Can't add insert to disconnected channel");null!=tp(this,P)||tf(this,P,[]),tp(this,P).push(t),tp(this,_).call(this),tf(this,_,tg([this.input,...tp(this,P),tp(this,m),tp(this,g).destination]))}addEffect(t,e,i){if(tp(this,M))throw Error("Can't add effect to disconnected channel");let n=new GainNode(this.context);n.gain.value=i;let s="input"in e?e.input:e,a=tg([tp(this,m),n,s]);null!=tp(this,y)||tf(this,y,[]),tp(this,y).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(tp(this,M))throw Error("Can't send effect to disconnected channel");let n=null==(i=tp(this,y))?void 0:i.find(e=>e.name===t);n?n.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;tp(this,M)||(tf(this,M,!0),tp(this,_).call(this),tp(this,b).call(this),null==(t=tp(this,y))||t.forEach(t=>t.disconnect()),tf(this,y,void 0))}};m=new WeakMap,y=new WeakMap,P=new WeakMap,_=new WeakMap,b=new WeakMap,g=new WeakMap,M=new WeakMap;var tw=class{constructor(t,e){var i;this.destination=t,this.options=e,td(this,v,!1),td(this,D,void 0),this.context=t.context,this.buffers={},tf(this,D,function(){let t=new Set;return{subscribe:function(e){return t.add(e),()=>{t.delete(e)}},trigger:function(e){t.forEach(t=>t(e))}}}()),this.velocityToGain=null!=(i=e.velocityToGain)?i:tv}start(t){var e,i,n,s,a,r,l,o,u,h,c,p,d;let f;if(tp(this,v))throw Error("Can't start a sample on disconnected player");let{destination:m,context:y}=this,P=this.buffers[t.note];if(!P)return console.warn(`Sample not found: '${t.note}'`),()=>void 0;let _=y.createBufferSource();_.buffer=P,_.detune.value=null!=(i=null!=(e=t.detune)?e:this.options.detune)?i:0;let b=null!=(n=t.lpfCutoffHz)?n:this.options.lpfCutoffHz,g=b?new BiquadFilterNode(y,{type:"lowpass",frequency:t.lpfCutoffHz}):void 0,M=y.createGain(),F=null!=(a=null!=(s=t.velocity)?s:this.options.velocity)?a:100;M.gain.value=this.velocityToGain(F),t.loop&&(_.loop=!0,_.loopStart=null!=(r=t.loopStart)?r:0,_.loopEnd=null!=(l=t.loopEnd)?l:P.duration);let w=null!=(o=t.decayTime)?o:this.options.decayTime,[A,k]=function(t,e=.2){let i=0,n=new GainNode(t,{gain:1});return[n,function(s){if(i)return i;n.gain.cancelScheduledValues(s);let a=s||t.currentTime;return i=a+e,n.gain.setValueAtTime(1,a),n.gain.linearRampToValueAtTime(0,i),i}]}(y,w);function G(t){if(null!=t||(t=y.currentTime),t<=E)_.stop(t);else{let e=k(t);_.stop(e)}}let x=null!=(u=t.stopId)?u:t.note,C=(d=[tg([_,g,M,A,m]),null==(h=t.stop)?void 0:h.call(t,G),tp(this,D).subscribe(t=>{t&&void 0!==t.stopId&&t.stopId!==x||G(null==t?void 0:t.time)})],f=!1,()=>{f||(f=!0,d.forEach(t=>null==t?void 0:t()))});_.onended=()=>{var e;C(),null==(e=t.onEnded)||e.call(t,t)};let E=Math.max(null!=(c=t.time)?c:0,y.currentTime);_.start(t.time);let j=null!=(p=t.duration)?p:P.duration;return"number"==typeof t.duration&&G(E+j),G}stop(t){tp(this,D).trigger(t)}disconnect(){tp(this,v)||(tf(this,v,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!tp(this,v)}};v=new WeakMap,D=new WeakMap;var tA=class{constructor(t){this.compare=t,td(this,F,[])}push(t){let e=tp(this,F).length,i=0,n=e-1,s=e;for(;i<=n;){let e=Math.floor((i+n)/2);0>this.compare(t,tp(this,F)[e])?(s=e,n=e-1):i=e+1}tp(this,F).splice(s,0,t)}pop(){return tp(this,F).shift()}peek(){return tp(this,F)[0]}removeAll(t){let e=tp(this,F).length;return tf(this,F,tp(this,F).filter(e=>!t(e))),tp(this,F).length!==e}clear(){tf(this,F,[])}size(){return tp(this,F).length}};F=new WeakMap;var tk=class{constructor(t,e){this.destination=t,td(this,w,void 0),td(this,A,void 0),tf(this,w,new tA((t,e)=>t.time-e.time)),this.player=new tw(t,e)}get buffers(){return this.player.buffers}get isRunning(){return void 0!==tp(this,A)}start(t){var e;let i=this.player.context,n=i.currentTime,s=null!=(e=t.time)?e:n;return s<n+1?this.player.start(t):(tp(this,w).push(th(tu({},t),{time:s})),tp(this,A)||tf(this,A,setInterval(()=>{let t=i.currentTime+1;for(;tp(this,w).size()&&tp(this,w).peek().time<=t;){let t=tp(this,w).pop();t&&this.player.start(t)}tp(this,w).size()||(clearInterval(tp(this,A)),tf(this,A,void 0))},200)),e=>{(!e||e<s)&&tp(this,w).removeAll(e=>e===t)||this.player.stop(th(tu({},t),{time:e}))})}stop(t){var e;if(this.player.stop(t),!t){tp(this,w).clear();return}let i=null!=(e=null==t?void 0:t.time)?e:0,n=null==t?void 0:t.stopId;n?tp(this,w).removeAll(t=>t.time>=i&&t.stopId?t.stopId===n:t.note===n):tp(this,w).removeAll(t=>t.time>=i)}disconnect(){this.player.disconnect()}};w=new WeakMap,A=new WeakMap;var tG=class{constructor(t,e){this.context=t;let i=new tF(t,e);this.player=new tk(i.input,e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop("object"==typeof t?t:void 0!==t?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}},tx={fetch:t=>fetch(t)},tC=class{constructor(t="smplr"){td(this,G),td(this,C),td(this,k,void 0),"undefined"!=typeof window&&"caches"in window?tf(this,k,caches.open(t)):tf(this,k,Promise.reject("CacheStorage not supported"))}fetch(t){return ty(this,null,function*(){let e=new Request(t);try{return yield tm(this,G,x).call(this,e)}catch(i){let t=yield fetch(e);return yield tm(this,C,E).call(this,e,t),t}})}};k=new WeakMap,G=new WeakSet,x=function(t){return ty(this,null,function*(){let e=yield tp(this,k),i=yield e.match(t);if(i)return i;throw Error("Not found")})},C=new WeakSet,E=function(t,e){return ty(this,null,function*(){try{let i=yield tp(this,k);yield i.put(t,e.clone())}catch(t){}})};var tE={baseUrl:"",name:"",samples:[],sampleNames:[],nameToSample:{},sampleNameVariations:{}};function tj(){return Object.keys(tS)}var tS={"TR-808":"https://danigb.github.io/samples/drum-machines/TR-808/dm.json","Casio-RZ1":"https://danigb.github.io/samples/drum-machines/Casio-RZ1/dm.json","LM-2":"https://danigb.github.io/samples/drum-machines/LM-2/dm.json","MFB-512":"https://danigb.github.io/samples/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://danigb.github.io/samples/drum-machines/Roland-CR-8000/dm.json"},tB=class{constructor(t,e){var i,n;td(this,j,tE),td(this,S,void 0),e=Object.assign({},e);let s=null!=(i=e.storage)?i:tx,a=tS[null!=(n=e.instrument)?n:"TR-808"];if(!a)throw Error("Invalid instrument: "+e.instrument);let r=function(t,e){return ty(this,null,function*(){var i,n;let s=yield e.fetch(t),a=yield s.json();for(let e of(a.baseUrl=t.replace("/dm.json",""),a.sampleNames=[],a.nameToSample={},a.sampleNameVariations={},a.samples)){let t=-1!==e.indexOf("/")?e:e.replace("-","/");a.nameToSample[t]=t;let[s,r]=t.split("/");a.sampleNames.includes(s)||a.sampleNames.push(s),null!=(i=a.nameToSample)[s]||(i[s]=t),null!=(n=a.sampleNameVariations)[s]||(n[s]=[]),r&&a.sampleNameVariations[s].push(`${s}/${r}`)}return a})}(a,s);this.player=new tG(t,e),this.output=this.player.output,tf(this,S,function(t,e,i,n){var s;let a=null!=(s=tb(["ogg","m4a"]))?s:"ogg";return i.then(i=>Promise.all(i.samples.map(s=>ty(this,null,function*(){let r=`${i.baseUrl}/${s}.${a}`,l=-1!==s.indexOf("/")?s:s.replace("-","/"),o=yield t_(t,r,n);o&&(e[l]=o)}))))}(t,this.player.buffers,r,s)),r.then(t=>{tf(this,j,t)})}loaded(){return ty(this,null,function*(){return yield tp(this,S),this})}get sampleNames(){return tp(this,j).sampleNames}getVariations(t){var e;return null!=(e=tp(this,j).sampleNameVariations[t])?e:[]}start(t){var e;let i=tp(this,j).nameToSample[t.note];return this.player.start(th(tu({},t),{note:i||t.note,stopId:null!=(e=t.stopId)?e:t.note}))}stop(t){return this.player.stop(t)}};function tO(t,e){return ty(this,null,function*(){try{let e=yield fetch(t),i=yield e.json();return i}catch(e){throw console.warn(`Can't load SFZ file ${t}`,e),Error(`Can't load SFZ file ${t}`)}})}function tI(t,e,i){return(void 0===e||void 0!==t&&t>=e)&&(void 0===i||void 0!==t&&t<=i)}j=new WeakMap,S=new WeakMap;var tW=Object.freeze({meta:{},global:{},groups:[]}),tT=class{constructor(t,e){var i;this.context=t,td(this,I),td(this,B,void 0),td(this,O,void 0),this.options=Object.freeze(Object.assign({},e)),this.player=new tG(t,e),tf(this,B,tW);let n=null!=(i=e.storage)?i:tx;tf(this,O,(function(t,e){return ty(this,null,function*(){if("string"==typeof t)return tO(t,e);if("global"in t)return t;if("websfzUrl"in t){let i=yield tO(t.websfzUrl,e);return null!=i.meta||(i.meta={}),t.name&&(i.meta.name=t.name),t.baseUrl&&(i.meta.baseUrl=t.baseUrl),t.formats&&(i.meta.formats=t.formats),i}throw Error("Invalid instrument: "+JSON.stringify(t))})})(e.instrument,n).then(e=>(tf(this,B,Object.freeze(e)),function(t,e,i,n){return ty(this,null,function*(){i.groups.forEach(s=>{let a=function(t,e){var i,n,s,a;let r={},l=null!=(i=t.meta.baseUrl)?i:"",o=null!=(s=tb(null!=(n=t.meta.formats)?n:[]))?s:"ogg",u=null!=(a=t.global.default_path)?a:"";return e?e.regions.reduce((t,e)=>(e.sample&&(t[e.sample]=`${l}/${u}${e.sample}.${o}`),t),r):r}(i,s);return function(t,e,i,n){return ty(this,null,function*(){yield Promise.all(Object.keys(i).map(s=>ty(this,null,function*(){if(e[s])return;let a=yield t_(t,i[s],n);return a&&(e[s]=a),e})))})}(t,e,a,n)})})}(t,this.player.buffers,tp(this,B),n))))}get output(){return this.player.output}loaded(){return ty(this,null,function*(){return yield tp(this,O),this})}start(t){tm(this,I,W).call(this,"object"==typeof t?t:{note:t})}stop(t){this.player.stop(t)}disconnect(){this.player.disconnect()}};B=new WeakMap,O=new WeakMap,I=new WeakSet,W=function(t){var e;let i=tM(t.note);if(void 0===i)return()=>void 0;let n=null!=(e=t.velocity)?e:this.options.velocity,s=function(t,e){let i=[];for(let n of t.groups)if(tI(e.midi,n.lokey,n.hikey)&&tI(e.velocity,n.lovel,n.hivel)&&tI(e.cc64,n.locc64,n.hicc64))for(let t of n.regions)tI(e.midi,t.lokey,t.hikey)&&tI(e.velocity,t.lovel,t.hivel)&&tI(e.cc64,n.locc64,n.hicc64)&&i.push([n,t]);return i}(tp(this,B),{midi:i,velocity:n}),a=()=>{var e;null==(e=t.onEnded)||e.call(t,t)},r=s.map(([e,n])=>{var s,r,l,o;let u=null!=(r=null!=(s=n.pitch_keycenter)?s:n.key)?r:i,h=(i-u)*100;return this.player.start(th(tu({},t),{note:n.sample,decayTime:t.decayTime,detune:h+(null!=(o=null!=(l=t.detune)?l:this.options.detune)?o:0),onEnded:a,stopId:i}))});switch(r.length){case 0:return()=>void 0;case 1:return r[0];default:return t=>r.forEach(e=>e(t))}};var tN={CP80:"https://danigb.github.io/samples/gs-e-pianos/CP80/cp80.websfz.json",PianetT:"https://danigb.github.io/samples/gs-e-pianos/Pianet T/pianet-t.websfz.json",WurlitzerEP200:"https://danigb.github.io/samples/gs-e-pianos/Wurlitzer EP200/wurlitzer-ep200.websfz.json",TX81Z:"https://danigb.github.io/samples/vcsl/TX81Z/tx81z-fm-piano.websfz.json"},tR=class extends tT{constructor(t,e){var i;super(t,th(tu({},e),{instrument:null!=(i=tN[e.instrument])?i:e.instrument}));let n=tD(0);this.tremolo={level:t=>n.set(tv(t))};let s=function(t,e){let i=new GainNode(t),n=new GainNode(t);i.channelCount=2,i.channelCountMode="explicit";let s=new ChannelSplitterNode(t,{numberOfOutputs:2}),a=new GainNode(t),r=new GainNode(t),l=new ChannelMergerNode(t,{numberOfInputs:2}),o=new OscillatorNode(t,{type:"sine",frequency:1});o.start();let u=new GainNode(t),h=new OscillatorNode(t,{type:"sine",frequency:1.1});h.start();let c=new GainNode(t);i.connect(s),s.connect(a,0),s.connect(r,1),a.connect(l,0,0),r.connect(l,0,1),o.connect(u),u.connect(a.gain),h.connect(c),c.connect(r.gain),l.connect(n);let p=e(t=>{u.gain.value=t,c.gain.value=t});return i.disconnect=()=>{p(),o.stop(),h.stop(),i.disconnect(s),s.disconnect(a,0),s.disconnect(r,1),a.disconnect(l,0,0),r.disconnect(l,0,1),o.disconnect(a),h.disconnect(r),l.disconnect(n)},{input:i,output:n}}(t,n.subscribe);this.output.addInsert(s)}},tz=class extends tT{constructor(t,e){let i=function(t){if(!tV[t])throw Error(`Mallet instrument "${t}" not valid`);return{name:t,websfzUrl:tU+tV[t]+t$}}(e.instrument);super(t,th(tu({},e),{instrument:i}))}},tU="https://danigb.github.io/samples/vcsl/",t$=".websfz.json",tV={"Balafon - Hard Mallet":"Struck Idiophones/balafon-hard-mallet","Balafon - Keyswitch":"Struck Idiophones/balafon-keyswitch","Balafon - Soft Mallet":"Struck Idiophones/balafon-soft-mallet","Balafon - Traditional Mallet":"Struck Idiophones/balafon-traditional-mallet","Tubular Bells 1":"Struck Idiophones/tubular-bells-1","Tubular Bells 2":"Struck Idiophones/tubular-bells-2","Vibraphone - Hard Mallets":"Struck Idiophones/vibraphone-hard-mallets","Vibraphone - Keyswitch":"Struck Idiophones/vibraphone-keyswitch","Vibraphone - Soft Mallets":"Struck Idiophones/vibraphone-soft-mallets","Xylophone - Hard Mallets":"Struck Idiophones/xylophone-hard-mallets","Xylophone - Keyswitch":"Struck Idiophones/xylophone-keyswitch","Xylophone - Medium Mallets":"Struck Idiophones/xylophone-medium-mallets","Xylophone - Soft Mallets":"Struck Idiophones/xylophone-soft-mallets"},tL=["preDelay","bandwidth","inputDiffusion1","inputDiffusion2","decay","decayDiffusion1","decayDiffusion2","damping","excursionRate","excursionDepth","wet","dry"],tH=new WeakMap,tq=class{constructor(t){td(this,T,void 0),td(this,N,void 0),td(this,R,void 0),this.input=t.createGain(),tf(this,R,t.destination),tf(this,N,(function(t){return ty(this,null,function*(){let e=tH.get(t);if(!e){let i=new Blob(['"use strict";(()=>{var f=class extends AudioWorkletProcessor{_pDLength;_preDelay;_pDWrite;_lp1;_lp2;_lp3;_excPhase;_taps;_Delays;sampleRate;static get parameterDescriptors(){return[["preDelay",0,0,sampleRate-1,"k-rate"],["bandwidth",.9999,0,1,"k-rate"],["inputDiffusion1",.75,0,1,"k-rate"],["inputDiffusion2",.625,0,1,"k-rate"],["decay",.5,0,1,"k-rate"],["decayDiffusion1",.7,0,.999999,"k-rate"],["decayDiffusion2",.5,0,.999999,"k-rate"],["damping",.005,0,1,"k-rate"],["excursionRate",.5,0,2,"k-rate"],["excursionDepth",.7,0,2,"k-rate"],["wet",1,0,1,"k-rate"],["dry",0,0,1,"k-rate"]].map(e=>new Object({name:e[0],defaultValue:e[1],minValue:e[2],maxValue:e[3],automationRate:e[4]}))}constructor(e){super(),this.sampleRate=sampleRate,this._Delays=[],this._pDLength=sampleRate+(128-sampleRate%128),this._preDelay=new Float32Array(this._pDLength),this._pDWrite=0,this._lp1=0,this._lp2=0,this._lp3=0,this._excPhase=0,[.004771345,.003595309,.012734787,.009307483,.022579886,.149625349,.060481839,.1249958,.030509727,.141695508,.089244313,.106280031].forEach(a=>this.makeDelay(a,sampleRate)),this._taps=Int16Array.from([.008937872,.099929438,.064278754,.067067639,.066866033,.006283391,.035818689,.011861161,.121870905,.041262054,.08981553,.070931756,.011256342,.004065724],a=>Math.round(a*sampleRate))}makeDelay(e,a){let t=Math.round(e*a),s=2**Math.ceil(Math.log2(t));this._Delays.push([new Float32Array(s),t-1,0,s-1])}writeDelay(e,a){return this._Delays[e][0][this._Delays[e][1]]=a}readDelay(e){return this._Delays[e][0][this._Delays[e][2]]}readDelayAt(e,a){let t=this._Delays[e];return t[0][t[2]+a&t[3]]}readDelayCAt(e,a){let t=this._Delays[e],s=a-~~a,d=~~a+t[2]-1,r=t[3],D=t[0][d++&r],l=t[0][d++&r],h=t[0][d++&r],y=t[0][d&r],u=(3*(l-h)-D+y)/2,m=2*h+D-(5*l+y)/2,c=(h-D)/2;return((u*s+m)*s+c)*s+l}process(e,a,t){let s=~~t.preDelay[0],d=t.bandwidth[0],r=t.inputDiffusion1[0],D=t.inputDiffusion2[0],l=t.decay[0],h=t.decayDiffusion1[0],y=t.decayDiffusion2[0],u=1-t.damping[0],m=t.excursionRate[0]/sampleRate,c=t.excursionDepth[0]*sampleRate/1e3,w=t.wet[0]*.6,A=t.dry[0];if(e[0].length==2)for(let i=127;i>=0;i--)this._preDelay[this._pDWrite+i]=(e[0][0][i]+e[0][1][i])*.5,a[0][0][i]=e[0][0][i]*A,a[0][1][i]=e[0][1][i]*A;else if(e[0].length>0){this._preDelay.set(e[0][0],this._pDWrite);for(let i=127;i>=0;i--)a[0][0][i]=a[0][1][i]=e[0][0][i]*A}else this._preDelay.set(new Float32Array(128),this._pDWrite);let o=0;for(;o<128;){let i=0,b=0;this._lp1+=d*(this._preDelay[(this._pDLength+this._pDWrite-s+o)%this._pDLength]-this._lp1);let p=this.writeDelay(0,this._lp1-r*this.readDelay(0));p=this.writeDelay(1,r*(p-this.readDelay(1))+this.readDelay(0)),p=this.writeDelay(2,r*p+this.readDelay(1)-D*this.readDelay(2)),p=this.writeDelay(3,D*(p-this.readDelay(3))+this.readDelay(2));let k=D*p+this.readDelay(3),g=c*(1+Math.cos(this._excPhase*6.28)),x=c*(1+Math.sin(this._excPhase*6.2847)),_=this.writeDelay(4,k+l*this.readDelay(11)+h*this.readDelayCAt(4,g));this.writeDelay(5,this.readDelayCAt(4,g)-h*_),this._lp2+=u*(this.readDelay(5)-this._lp2),_=this.writeDelay(6,l*this._lp2-y*this.readDelay(6)),this.writeDelay(7,this.readDelay(6)+y*_),_=this.writeDelay(8,k+l*this.readDelay(7)+h*this.readDelayCAt(8,x)),this.writeDelay(9,this.readDelayCAt(8,x)-h*_),this._lp3+=u*(this.readDelay(9)-this._lp3),_=this.writeDelay(10,l*this._lp3-y*this.readDelay(10)),this.writeDelay(11,this.readDelay(10)+y*_),i=this.readDelayAt(9,this._taps[0])+this.readDelayAt(9,this._taps[1])-this.readDelayAt(10,this._taps[2])+this.readDelayAt(11,this._taps[3])-this.readDelayAt(5,this._taps[4])-this.readDelayAt(6,this._taps[5])-this.readDelayAt(7,this._taps[6]),b=this.readDelayAt(5,this._taps[7])+this.readDelayAt(5,this._taps[8])-this.readDelayAt(6,this._taps[9])+this.readDelayAt(7,this._taps[10])-this.readDelayAt(9,this._taps[11])-this.readDelayAt(10,this._taps[12])-this.readDelayAt(11,this._taps[13]),a[0][0][o]+=i*w,a[0][1][o]+=b*w,this._excPhase+=m,o++;for(let R=0,n=this._Delays[0];R<this._Delays.length;n=this._Delays[++R])n[1]=n[1]+1&n[3],n[2]=n[2]+1&n[3]}return this._pDWrite=(this._pDWrite+128)%this._pDLength,!0}};registerProcessor("DattorroReverb",f);})();'],{type:"application/javascript"}),n=URL.createObjectURL(i);e=t.audioWorklet.addModule(n),tH.set(t,e)}yield e;let i=new AudioWorkletNode(t,"DattorroReverb",{outputChannelCount:[2]});return i})})(t).then(t=>(this.input.connect(t),t.connect(tp(this,R)),tf(this,T,t),this)))}get paramNames(){return tL}getParam(t){var e;return null==(e=tp(this,T))?void 0:e.parameters.get("preDelay")}get isReady(){return void 0!==tp(this,T)}ready(){return tp(this,N)}connect(t){tp(this,T)&&(tp(this,T).disconnect(tp(this,R)),tp(this,T).connect(t)),tf(this,R,t)}};T=new WeakMap,N=new WeakMap,R=new WeakMap,new WeakMap,new WeakMap;var tK=["MusyngKite","FluidR3_GM"],tX=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"],tZ=class{constructor(t,e){this.context=t,td(this,z,void 0),td(this,U,void 0),this.config=function(t){var e,i,n,s;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");let a={kit:"MusyngKite",instrument:t.instrument,storage:null!=(e=t.storage)?e:tx,extraGain:null!=(i=t.extraGain)?i:5,loadLoopData:null!=(n=t.loadLoopData)&&n,loopDataUrl:t.loopDataUrl,instrumentUrl:null!=(s=t.instrumentUrl)?s:""};return a.instrument&&a.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),a.instrumentUrl=a.instrument,a.instrument=void 0),a.instrument&&!a.instrumentUrl&&(a.instrumentUrl=function(t,e){var i;let n=null!=(i=tb(["ogg","mp3"]))?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${n}.js`}(a.instrument,a.kit)),a.loadLoopData&&a.instrument&&!a.loopDataUrl&&(a.loopDataUrl=function(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}(a.instrument,a.kit)),a}(e),this.player=new tG(t,e);let i=function(t,e){return(i,n)=>ty(this,null,function*(){let s=yield(yield e.fetch(t)).text(),a=function(t){let e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");let i=t.indexOf("=",e)+2,n=t.lastIndexOf(",");return JSON.parse(t.slice(i,n)+"}")}(s),r=Object.keys(a);yield Promise.all(r.map(t=>ty(this,null,function*(){var e;let s=tM(t);if(!s)return;let r=function(t){let e=window.atob(t),i=e.length,n=new Uint8Array(i);for(let t=0;t<i;t++)n[t]=e.charCodeAt(t);return n.buffer}((e=a[t]).slice(e.indexOf(",")+1)),l=yield i.decodeAudioData(r);n[s]=l})))})}(this.config.instrumentUrl,this.config.storage);tf(this,z,i(t,this.player.buffers)),tf(this,U,{status:"not-loaded"}),this.config.loopDataUrl&&(tf(this,U,{status:"loading"}),tf(this,z,Promise.all([tp(this,z),(function(t){return ty(this,null,function*(){try{let e=yield fetch(t);if(200!==e.status)return{status:"error",code:e.status};let i=yield e.json(),n={status:"loaded",data:{}};return Object.keys(i).forEach(t=>{let e=tM(t);if(e){let s=i[t];n.data[e]=[s[0]/41e3,s[1]/41e3]}}),n}catch(t){return{status:"error",code:0}}})})(this.config.loopDataUrl).then(t=>{tf(this,U,t)})])));let n=new GainNode(t,{gain:this.config.extraGain});this.player.output.addInsert(n)}get output(){return this.player.output}loaded(){return ty(this,null,function*(){return yield tp(this,z),this})}get hasLoops(){return"loaded"===tp(this,U).status}disconnect(){console.log("disconnecting"),this.player.disconnect()}start(t){let e=tM(t.note),[i,n]=void 0===e?["",0]:function(t,e){let i=0;for(;void 0===e[t+i]&&i<128;)i=i>0?-i:-i+1;return 127===i?[t,0]:[t+i,-(100*i)]}(e,this.player.buffers),s="number"==typeof e&&"loaded"===tp(this,U).status?tp(this,U).data[e]:void 0;return this.player.start(th(tu({},t),{note:i,detune:n,loop:void 0!==s,loopStart:null==s?void 0:s[0],loopEnd:null==s?void 0:s[1]}))}stop(t){return this.player.stop(t)}};z=new WeakMap,U=new WeakMap;var tJ=(f=null!=(d=tP())?Y(ta(d)):{},((t,e,i,n)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let i of tn(e))tr.call(t,i)||void 0===i||Q(t,i,{get:()=>e[i],enumerable:!(n=te(e,i))||n.enumerable});return t})(d&&d.__esModule?f:Q(f,"default",{value:d,enumerable:!0}),d)),tY=class{constructor(t,e){this.context=t,td(this,V),td(this,$,void 0),this.options=Object.assign({baseUrl:"https://danigb.github.io/samples/splendid-grand-piano",destination:t.destination,storage:tJ.HttpStorage,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new tG(t,this.options);let i=function(t,e){var i;let n=null!=(i=tb(["ogg","m4a"]))?i:"ogg";return(i,s)=>ty(this,null,function*(){for(let a of tQ)yield Promise.all(a.samples.map(r=>ty(this,[r],function*([r,l]){let o=`${t}/${l}.${n}`,u=yield t_(i,o,e);u&&(s[a.name+r]=u)})))})}(this.options.baseUrl,this.options.storage);tf(this,$,i(t,this.player.buffers))}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return ty(this,null,function*(){return yield tp(this,$),this})}start(t){var e,i;let n="object"==typeof t?tu({},t):{note:t},s=tm(this,V,L).call(this,n);return s?(n.note=s[0],n.stopId=null!=(e=n.stopId)?e:s[1],n.detune=s[2]+(null!=(i=n.detune)?i:this.options.detune),this.player.start(n)):()=>void 0}stop(t){return this.player.stop(t)}};$=new WeakMap,V=new WeakSet,L=function(t){var e;let i=tM(t.note);if(!i)return;let n=null!=(e=t.velocity)?e:this.options.velocity,s=tQ.findIndex(t=>n>=t.vel_range[0]&&n<=t.vel_range[1]),a=tQ[s];if(a)return function(t,e,i){let n=0;for(;void 0===i[t+(e+n)]&&n<128;)n=n>0?-n:-n+1;return 127===n?[t+e,e,0]:[t+(e+n),e,-(100*n)]}(a.name,i,this.player.buffers)};var tQ=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}];function t0(){return(0,J.useState)("init")}function t1(t){let{status:e,onClick:i}=t;return"init"===e?(0,H.jsx)("button",{className:"text-rose-700 bg-zinc-900 px-2 rounded",onClick:i,children:"Load"}):"ready"===e?(0,H.jsx)("div",{className:"text-teal-600",children:"Ready"}):"loading"===e?(0,H.jsx)("div",{className:"text-gray-500",children:"Loading..."}):(0,H.jsx)("div",{className:"text-red-700",children:"Error loading"})}function t2(t){let{className:e}=t,[i,a]=t0(),[r,l]=(0,J.useState)(tj()[0]),[o,u]=(0,J.useState)(void 0),[h,c]=(0,J.useState)(0),[p,d]=(0,J.useState)(100);function f(t){a("loading"),null!=n||(n=new window.AudioContext),null!=s||(s=new tq(n));let e=new tB(n,{instrument:t});e.output.addEffect("reverb",s,h),e.loaded().then(()=>{a("ready"),u(e)}).catch(t=>{a("error"),console.log("Instrument error",t)})}return(0,H.jsxs)("div",{className:e,children:[(0,H.jsxs)("div",{className:"flex gap-2 items-end mb-2",children:[(0,H.jsx)("h1",{className:"text-3xl",children:"DrumMachine"}),(0,H.jsx)(t1,{status:i,onClick:()=>{f(r)}})]}),(0,H.jsxs)("div",{className:"ready"!==i?"opacity-30 no-select":"no-select",children:[(0,H.jsxs)("div",{className:"flex gap-4 mb-2",children:[(0,H.jsx)("select",{className:"appearance-none bg-zinc-700 text-zinc-200 rounded border border-gray-400 py-2 px-3 leading-tight focus:outline-none focus:border-blue-500",value:r,onChange:t=>{let e=t.target.value;e!==r&&(l(e),f(e))},children:tj().map(t=>(0,H.jsx)("option",{value:t,children:t},t))}),(0,H.jsx)("div",{children:"Vol:"}),(0,H.jsx)("input",{type:"range",min:0,max:127,step:1,value:p,onChange:t=>{let e=t.target.valueAsNumber;null==o||o.output.setVolume(e),d(e)}}),(0,H.jsx)("div",{children:"Reverb:"}),(0,H.jsx)("input",{type:"range",min:0,max:1,step:.001,value:h,onChange:t=>{let e=t.target.valueAsNumber;null==o||o.output.sendEffect("reverb",e),c(e)}})]}),(0,H.jsx)("div",{className:"grid grid-cols-6 gap-1",children:null==o?void 0:o.sampleNames.map(t=>(0,H.jsxs)("div",{className:"bg-zinc-900 rounded px-2 pb-2",children:[(0,H.jsx)("div",{className:"flex",children:(0,H.jsx)("button",{className:"text-left flex-grow",onClick:()=>{null==o||o.start({note:t,detune:50*(Math.random()-.5)})},children:t})}),(0,H.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:null==o?void 0:o.getVariations(t).map(t=>(0,H.jsx)("button",{className:"bg-zinc-600 w-4 h-4 rounded",onMouseDown:()=>{null==o||o.start({note:t})}},t))})]},t))})]})]})}function t5(){return null!=a||(a=new AudioContext),a}var t6=i(2209);function t3(t){let{instrument:e}=t,i=(0,J.useRef)(null),[n,s]=(0,J.useState)([]),[a,r]=(0,J.useState)(""),[l,o]=(0,J.useState)(),[u,h]=(0,J.useState)("");(0,J.useEffect)(()=>{void 0!==window.navigator&&void 0!==navigator.requestMIDIAccess&&t6.u5.enable().then(()=>{let t=t6.u5.inputs.map(t=>t.name);s(t)})},[]),i.current=null!=e?e:null;let c=void 0!==l;function p(){null==l||l.forEach(t=>t.remove()),o(void 0)}function d(t){let e=t6.u5.inputs.find(e=>e.name===t);if(!e){r("");return}r(t);let n=e.addListener("noteon",t=>{var e;let n={note:t.note.number,velocity:t.rawVelocity};null===(e=i.current)||void 0===e||e.start(n),h("".concat(n.note," (").concat(n.velocity,")"))}),s=e.addListener("noteoff",t=>{var e;null===(e=i.current)||void 0===e||e.stop({stopId:t.note.number}),h("")});o([...Array.isArray(n)?n:[n],...Array.isArray(s)?s:[s]])}return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)("button",{className:"px-1 rounded "+(c?"bg-emerald-600":"bg-zinc-700"),onClick:()=>{c?p():d(a)},children:"MIDI"}),(0,H.jsxs)("select",{className:"appearance-none bg-zinc-700 text-zinc-200 rounded border border-gray-400 py-2 px-3 leading-tight focus:outline-none focus:border-blue-500 py-[2px]",value:a,onChange:t=>{let e=t.target.value;c&&p(),e&&(console.log("Connecting to MIDI device",e),d(e))},children:[(0,H.jsx)("option",{value:"",children:"Select MIDI device"}),n.map(t=>(0,H.jsx)("option",{value:t,children:t},t))]}),(0,H.jsx)("div",{className:"opacity-50",children:u})]})}var t4=i(9792);let t8=t=>[0,1,2,3,4,5,6,7,8,9,10,11].map(e=>e+t),t9=t=>[1,3,6,8,10].includes(t%12);function t7(t){let{className:e,borderColor:i="border-blue-700",onPress:n,onRelease:s}=t,[a,r]=(0,J.useState)(100),[l,o]=(0,J.useState)(60),[u,h]=(0,J.useState)(!1),c=t=>!1;return(0,H.jsxs)("div",{className:e,children:[(0,H.jsx)("div",{className:"piano-container border-t-8 ".concat(i),children:[...t8(l),...t8(l+12)].map(t=>t9(t)?(0,H.jsx)("div",{className:"accidental-key__wrapper",children:(0,H.jsx)("button",{className:"accidental-key ".concat(c(t)?"accidental-key--playing":""),onMouseDown:()=>n({note:t,velocity:a}),onMouseUp:()=>{!u&&s&&s(t)},children:(0,H.jsx)("div",{className:"text"})})},t):(0,H.jsx)("button",{className:"natural-key ".concat(c(t)?"natural-key--playing":""),onMouseDown:()=>n({note:t,velocity:a}),onMouseUp:()=>{!u&&s&&s(t)},children:(0,H.jsx)("div",{className:"text"})},t))}),(0,H.jsxs)("div",{className:"flex gap-1 items-center mt-1",children:[(0,H.jsxs)("div",{children:["Octave: ",l,"-",l+12+11]}),(0,H.jsx)("button",{className:"bg-zinc-900 px-1 rounded",onClick:()=>{o(l-12)},children:"-"}),(0,H.jsx)("button",{className:"bg-zinc-900 px-1 rounded",onClick:()=>{o(l+12)},children:"+"}),(0,H.jsxs)("div",{className:"ml-3",children:["Velocity: ",a]}),(0,H.jsx)("input",{type:"range",min:0,max:127,value:a,onChange:t=>r(t.target.valueAsNumber)}),(0,H.jsx)("input",{className:"ml-3",type:"checkbox",checked:u,onChange:t=>h(t.target.checked)}),(0,H.jsx)("div",{className:"",children:"Sustain"}),(0,H.jsx)("button",{className:"bg-zinc-900 px-1 rounded",onClick:()=>{let t=t4.Ci.degrees("C4 major"),e=t4.e6.numeric([1,8,1]).map(t).map(t4.jC.midi);e.map((t,e)=>n({note:null!=t?t:0,velocity:Math.floor(60+40*Math.random()),time:.25*e,duration:.05}))},children:"Test"})]})]})}let et=Object.keys(tN);function ee(t){let{className:e}=t,[i,n]=(0,J.useState)(void 0),[s,a]=(0,J.useState)("CP80"),[l,o]=t0(),[u,h]=(0,J.useState)(0),[c,p]=(0,J.useState)(0),[d,f]=(0,J.useState)(100);function m(t){i&&i.disconnect(),o("loading");let e=t5();null!=r||(r=new tq(e));let s=new tR(e,{instrument:t,volume:d});s.output.addEffect("reverb",r,u),n(s),s.loaded().then(()=>{o("ready")})}return(0,H.jsxs)("div",{className:e,children:[(0,H.jsxs)("div",{className:"flex gap-2 items-end mb-2",children:[(0,H.jsx)("h1",{className:"text-3xl",children:"Electric Piano"}),(0,H.jsx)(t1,{status:l,onClick:()=>m(s)}),(0,H.jsx)(t3,{instrument:i})]}),(0,H.jsx)("div",{}),(0,H.jsxs)("div",{className:"ready"!==l?"opacity-30":"",children:[(0,H.jsxs)("div",{className:"flex gap-4 mb-2 no-select",children:[(0,H.jsx)("select",{className:"appearance-none bg-zinc-700 text-zinc-200 rounded border border-gray-400 py-2 px-3 leading-tight focus:outline-none focus:border-blue-500",value:s,onChange:t=>{let e=t.target.value;m(e),a(e)},children:et.map(t=>(0,H.jsx)("option",{value:t,children:t},t))}),(0,H.jsx)("button",{className:"bg-zinc-700 rounded px-3 py-0.5 shadow",onClick:()=>{null==i||i.stop()},children:"Stop all"})]}),(0,H.jsxs)("div",{className:"flex gap-4 mb-2 no-select",children:[(0,H.jsx)("div",{children:"Volume:"}),(0,H.jsx)("input",{type:"range",min:0,max:127,step:1,value:d,onChange:t=>{let e=t.target.valueAsNumber;null==i||i.output.setVolume(e),f(e)}}),(0,H.jsx)("div",{children:"Tremolo:"}),(0,H.jsx)("input",{type:"range",min:0,max:127,step:1,value:c,onChange:t=>{let e=t.target.valueAsNumber;null==i||i.tremolo.level(e),p(e)}}),(0,H.jsx)("div",{children:"Reverb:"}),(0,H.jsx)("input",{type:"range",min:0,max:1,step:.001,value:u,onChange:t=>{let e=t.target.valueAsNumber;null==i||i.output.sendEffect("reverb",e),h(e)}})]}),(0,H.jsx)(t7,{borderColor:"border-rose-700",onPress:t=>{var e;i&&(t.time=(null!==(e=t.time)&&void 0!==e?e:0)+i.context.currentTime,i.start(t))},onRelease:t=>{null==i||i.stop({stopId:t})}})]})]})}let ei=Object.keys(tV);function en(t){let{className:e}=t,[i,n]=(0,J.useState)(void 0),[s,a]=(0,J.useState)(ei[0]),[r,o]=t0(),[u,h]=(0,J.useState)(0),[c,p]=(0,J.useState)(100);function d(t){i&&i.disconnect(),o("loading");let e=t5();null!=l||(l=new tq(e));let s=new tz(e,{instrument:t,volume:c});s.output.addEffect("reverb",l,u),n(s),s.loaded().then(()=>{o("ready")})}return(0,H.jsxs)("div",{className:e,children:[(0,H.jsxs)("div",{className:"flex gap-2 items-end mb-2",children:[(0,H.jsx)("h1",{className:"text-3xl",children:"Mallet"}),(0,H.jsx)(t1,{status:r,onClick:()=>d(s)}),(0,H.jsx)(t3,{instrument:i})]}),(0,H.jsx)("div",{}),(0,H.jsxs)("div",{className:"ready"!==r?"opacity-30":"",children:[(0,H.jsxs)("div",{className:"flex gap-4 mb-2 no-select",children:[(0,H.jsx)("select",{className:"appearance-none bg-zinc-700 text-zinc-200 rounded border border-gray-400 py-2 px-3 leading-tight focus:outline-none focus:border-blue-500",value:s,onChange:t=>{let e=t.target.value;d(e),a(e)},children:ei.map(t=>(0,H.jsx)("option",{value:t,children:t},t))}),(0,H.jsx)("button",{className:"bg-zinc-700 rounded px-3 py-0.5 shadow",onClick:()=>{null==i||i.stop()},children:"Stop all"})]}),(0,H.jsxs)("div",{className:"flex gap-4 mb-2 no-select",children:[(0,H.jsx)("div",{children:"Volume:"}),(0,H.jsx)("input",{type:"range",min:0,max:127,step:1,value:c,onChange:t=>{let e=t.target.valueAsNumber;null==i||i.output.setVolume(e),p(e)}}),(0,H.jsx)("div",{children:"Reverb:"}),(0,H.jsx)("input",{type:"range",min:0,max:1,step:.001,value:u,onChange:t=>{let e=t.target.valueAsNumber;null==i||i.output.sendEffect("reverb",e),h(e)}})]}),(0,H.jsx)(t7,{borderColor:"border-rose-700",onPress:t=>{var e;i&&(t.time=(null!==(e=t.time)&&void 0!==e?e:0)+i.context.currentTime,i.start(t))},onRelease:t=>{null==i||i.stop({stopId:t})}})]})]})}function es(t){let{className:e}=t,[i,n]=t0(),[s,a]=(0,J.useState)("disabled"),[r,l]=(0,J.useState)("MusyngKite"),[u,h]=(0,J.useState)("marimba"),[c,p]=(0,J.useState)(void 0),[d,f]=(0,J.useState)(0),[m,y]=(0,J.useState)(100);function P(t,e){let i=t5();null!=o||(o=new tq(i));let s=new tZ(i,{kit:t,instrument:e,loadLoopData:!0});s.output.addEffect("reverb",o,0),s.loaded().then(t=>{n("ready"),p(e=>(e&&(console.log({prevInstrument:e}),e.disconnect()),t)),t.hasLoops&&a("loop")}).catch(t=>{n("error"),console.log("Instrument error",t)})}return(0,H.jsxs)("div",{className:e,children:[(0,H.jsxs)("div",{className:"flex gap-2 items-end mb-2",children:[(0,H.jsx)("h1",{className:"text-3xl",children:"Soundfont"}),(0,H.jsx)(t1,{status:i,onClick:()=>{P(r,u)}}),(0,H.jsx)(t3,{instrument:c})]}),(0,H.jsxs)("div",{className:"ready"!==i?"opacity-30 no-select":"no-select",children:[(0,H.jsxs)("div",{className:"flex items-center gap-4 mb-2",children:[(0,H.jsx)("select",{className:"appearance-none bg-zinc-700 text-zinc-200 rounded border border-gray-400 py-2 px-3 leading-tight focus:outline-none focus:border-blue-500",value:r,onChange:t=>{let e=t.target.value;P(e,u),l(e)},children:tK.map(t=>(0,H.jsx)("option",{value:t,children:t},t))}),(0,H.jsx)("select",{className:"appearance-none bg-zinc-700 text-zinc-200 rounded border border-gray-400 py-2 px-3 leading-tight focus:outline-none focus:border-blue-500",value:u,onChange:t=>{let e=t.target.value;P(r,e),h(e)},children:tX.map(t=>(0,H.jsx)("option",{value:t,children:t},t))}),(0,H.jsx)("button",{className:"bg-zinc-700 rounded px-3 py-0.5 shadow",onClick:()=>{null==c||c.stop()},children:"Stop all"}),(0,H.jsxs)("label",{"aria-disabled":"disabled"===s,className:"flex gap-2 ".concat("disabled"===s?"opacity-50":""),htmlFor:"loop",children:[(0,H.jsx)("input",{disabled:"disabled"===s,checked:"loop"===s,onChange:()=>{a(t=>"no-loop"===t?"loop":"no-loop")},type:"checkbox",id:"loop"}),"Loop"]})]}),(0,H.jsxs)("div",{className:"flex gap-4 mb-2",children:[(0,H.jsx)("div",{children:"Volume:"}),(0,H.jsx)("input",{type:"range",min:0,max:127,step:1,value:m,onChange:t=>{let e=t.target.valueAsNumber;null==c||c.output.setVolume(e),y(e)}}),(0,H.jsx)("div",{children:"Reverb:"}),(0,H.jsx)("input",{type:"range",min:0,max:1,step:.001,value:d,onChange:t=>{let e=t.target.valueAsNumber;null==c||c.output.sendEffect("reverb",e),f(e)}})]}),(0,H.jsx)(t7,{borderColor:"border-teal-600",onPress:t=>{var e;c&&c.start({...t,time:(null!==(e=t.time)&&void 0!==e?e:0)+c.context.currentTime,loop:"loop"===s})},onRelease:t=>{null==c||c.stop({stopId:t})}})]})]})}function ea(t){let{className:e}=t,[i,n]=(0,J.useState)(void 0),[s,a]=t0(),[r,l]=(0,J.useState)(0),[o,c]=(0,J.useState)(100);return(0,H.jsxs)("div",{className:e,children:[(0,H.jsxs)("div",{className:"flex gap-2 items-end mb-2",children:[(0,H.jsx)("h1",{className:"text-3xl",children:"Piano"}),(0,H.jsx)(t1,{status:s,onClick:function(){if(i)return;a("loading");let t=t5();null!=u||(u=new tq(t)),null!=h||(h=new tC);let e=new tY(t,{volume:o,storage:h});e.output.addEffect("reverb",u,r),n(e),e.loaded().then(()=>{a("ready")})}}),(0,H.jsx)(t3,{instrument:i})]}),(0,H.jsx)("div",{}),(0,H.jsxs)("div",{className:"ready"!==s?"opacity-30":"",children:[(0,H.jsx)("div",{className:"flex gap-4 mb-2 no-select",children:(0,H.jsx)("button",{className:"bg-zinc-700 rounded px-3 py-0.5 shadow",onClick:()=>{null==i||i.stop()},children:"Stop all"})}),(0,H.jsxs)("div",{className:"flex gap-4 mb-2 no-select",children:[(0,H.jsx)("div",{children:"Volume:"}),(0,H.jsx)("input",{type:"range",min:0,max:128,step:1,value:o,onChange:t=>{let e=t.target.valueAsNumber;null==i||i.output.setVolume(e),c(e)}}),(0,H.jsx)("div",{children:"Reverb:"}),(0,H.jsx)("input",{type:"range",min:0,max:1,step:.001,value:r,onChange:t=>{let e=t.target.valueAsNumber;null==i||i.output.sendEffect("reverb",e),l(e)}})]}),(0,H.jsx)(t7,{borderColor:"border-rose-700",onPress:t=>{var e;i&&(t.time=(null!==(e=t.time)&&void 0!==e?e:0)+i.context.currentTime,i.start(t))},onRelease:t=>{null==i||i.stop({stopId:t})}})]})]})}function er(){return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsxs)(Z(),{children:[(0,H.jsx)("title",{children:"smplr"}),(0,H.jsx)("meta",{name:"description",content:"Plug and play web instruments"}),(0,H.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,H.jsxs)("main",{className:"max-w-4xl mx-auto my-20 p-4"+K().className,children:[(0,H.jsxs)("div",{className:"flex items-end mb-16",children:[(0,H.jsx)("h1",{className:"text-6xl font-bold",children:"smplr"}),(0,H.jsx)("div",{children:"0.7.0"})]}),(0,H.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,H.jsx)(ea,{}),(0,H.jsx)(es,{}),(0,H.jsx)(ee,{}),(0,H.jsx)(en,{}),(0,H.jsx)(t2,{})]})]})]})}}},function(t){t.O(0,[643,958,774,888,179],function(){return t(t.s=8312)}),_N_E=t.O()}]);